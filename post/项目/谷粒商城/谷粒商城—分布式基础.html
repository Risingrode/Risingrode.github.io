<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"><title>谷粒商城-基础篇 | 代码有点萌</title><meta name="author" content="fcw,3185087246@protonmail.com"><meta name="copyright" content="fcw"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="1. 整体介绍 1）安装vagrant2）安装Centos7$ vagrant init centos/7A `Vagrantfile` has been placed in this directory. You are nowready to `vagrant up` your first virtual environment! Please readthe comments in the">
<meta property="og:type" content="article">
<meta property="og:title" content="谷粒商城-基础篇">
<meta property="og:url" content="https://risingrode.github.io/post/%E9%A1%B9%E7%9B%AE/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E2%80%94%E5%88%86%E5%B8%83%E5%BC%8F%E5%9F%BA%E7%A1%80.html">
<meta property="og:site_name" content="代码有点萌">
<meta property="og:description" content="1. 整体介绍 1）安装vagrant2）安装Centos7$ vagrant init centos/7A `Vagrantfile` has been placed in this directory. You are nowready to `vagrant up` your first virtual environment! Please readthe comments in the">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://i0.hippopx.com/photos/356/657/107/beach-beverage-caribbean-cocktail-thumb.jpg">
<meta property="article:published_time" content="2023-08-08T09:16:26.000Z">
<meta property="article:modified_time" content="2023-12-23T12:35:32.897Z">
<meta property="article:author" content="fcw">
<meta property="article:tag" content="谷粒商城-基础篇">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i0.hippopx.com/photos/356/657/107/beach-beverage-caribbean-cocktail-thumb.jpg"><link rel="shortcut icon" href="/img/favicon.jpg"><link rel="canonical" href="https://risingrode.github.io/post/%E9%A1%B9%E7%9B%AE/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E2%80%94%E5%88%86%E5%B8%83%E5%BC%8F%E5%9F%BA%E7%A1%80.html"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//busuanzi.ibruce.info"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '谷粒商城-基础篇',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-12-23 20:35:32'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = url => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      link.onload = () => resolve()
      link.onerror = () => reject()
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><script src="/live2d-widget-master/autoload.js"></script><link rel="stylesheet" href="/css/mouse.css"><link rel="stylesheet" href="/css/custom.css"><meta name="generator" content="Hexo 6.3.0"></head><body><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pace-js/themes/blue/pace-theme-minimal.min.css"><script src="https://cdn.jsdelivr.net/npm/pace-js/pace.min.js"></script><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/girl.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">93</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">75</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">41</div></a></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 优质网站链接</span></a></div><div class="menus_item"><a class="site-page group hide" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 媒体</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/movies/"><i class="fa-fw fa fa-film"></i><span> 电影</span></a></li><li><a class="site-page child" href="/books/"><i class="fa-fw fas fa-book"></i><span> 书单</span></a></li><li><a class="site-page child" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/talk/"><i class="fa-fw far fa-comment"></i><span> 微语</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://i0.hippopx.com/photos/356/657/107/beach-beverage-caribbean-cocktail-thumb.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="代码有点萌"><span class="site-name">代码有点萌</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 优质网站链接</span></a></div><div class="menus_item"><a class="site-page group hide" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 媒体</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/movies/"><i class="fa-fw fa fa-film"></i><span> 电影</span></a></li><li><a class="site-page child" href="/books/"><i class="fa-fw fas fa-book"></i><span> 书单</span></a></li><li><a class="site-page child" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/talk/"><i class="fa-fw far fa-comment"></i><span> 微语</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">谷粒商城-基础篇</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-08-08T09:16:26.000Z" title="发表于 2023-08-08 17:16:26">2023-08-08</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-12-23T12:35:32.897Z" title="更新于 2023-12-23 20:35:32">2023-12-23</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/">谷粒商城</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">23.3k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>107分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="谷粒商城-基础篇"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><div class="top-img" style="background-image: url('https://i0.hippopx.com/photos/356/657/107/beach-beverage-caribbean-cocktail-thumb.jpg');"></div><article class="post-content" id="article-container"><h2 id="1-整体介绍"><a href="#1-整体介绍" class="headerlink" title="1. 整体介绍"></a>1. 整体介绍</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/image-20200422211607028.png"></p>
<h3 id="1）安装vagrant"><a href="#1）安装vagrant" class="headerlink" title="1）安装vagrant"></a>1）安装vagrant</h3><h3 id="2）安装Centos7"><a href="#2）安装Centos7" class="headerlink" title="2）安装Centos7"></a>2）安装Centos7</h3><figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">vagrant init centos/7</span></span><br><span class="line">A `Vagrantfile` has been placed in this directory. You are now</span><br><span class="line">ready to `vagrant up` your first virtual environment! Please read</span><br><span class="line">the comments in the Vagrantfile as well as documentation on</span><br><span class="line">`vagrantup.com` for more information on using Vagrant.</span><br></pre></td></tr></tbody></table></figure>

<p>执行完上面的命令后，会在用户的家目录下生成Vagrantfile文件。</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">vagrant up</span></span><br><span class="line">Bringing machine 'default' up with 'virtualbox' provider...</span><br><span class="line">==&gt; default: Box 'centos/7' could not be found. Attempting to find and install...</span><br><span class="line">    default: Box Provider: virtualbox</span><br><span class="line">    default: Box Version: &gt;= 0</span><br><span class="line">==&gt; default: Loading metadata for box 'centos/7'</span><br><span class="line">    default: URL: https://vagrantcloud.com/centos/7</span><br><span class="line">==&gt; default: Adding box 'centos/7' (v1905.1) for provider: virtualbox</span><br><span class="line">    default: Downloading: https://vagrantcloud.com/centos/boxes/7/versions/1905.1/providers/virtualbox.box</span><br><span class="line">    default: Download redirected to host: cloud.centos.org</span><br><span class="line">    default: Progress: 0% (Rate: 6717/s, Estimated time remaining: 7:33:42)</span><br></pre></td></tr></tbody></table></figure>

<p>下载镜像过程比较漫长，也可以采用先用下载工具下载到本地后，然后使用“ vagrant box add ”添加，再“vagrant up”即可</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">将下载的镜像添加到virtualBox中</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">vagrant box add centos/7 E:\迅雷下载\CentOS-7-x86_64-Vagrant-1905_01.VirtualBox.box</span></span><br><span class="line">==&gt; box: Box file was not detected as metadata. Adding it directly...</span><br><span class="line">==&gt; box: Adding box 'centos/7' (v0) for provider:</span><br><span class="line">    box: Unpacking necessary files from: file:///E:/%D1%B8%C0%D7%CF%C2%D4%D8/CentOS-7-x86_64-Vagrant-1905_01.VirtualBox.box</span><br><span class="line">    box:</span><br><span class="line">==&gt; box: Successfully added box 'centos/7' (v0) for 'virtualbox'!</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">启动</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">vagrant up</span></span><br><span class="line">Bringing machine 'default' up with 'virtualbox' provider...</span><br><span class="line">==&gt; default: Importing base box 'centos/7'...</span><br><span class="line">==&gt; default: Matching MAC address for NAT networking...</span><br><span class="line">==&gt; default: Setting the name of the VM: Administrator_default_1588497928070_24634</span><br><span class="line">==&gt; default: Clearing any previously set network interfaces...</span><br><span class="line">==&gt; default: Preparing network interfaces based on configuration...</span><br><span class="line">    default: Adapter 1: nat</span><br><span class="line">    default: Adapter 2: hostonly</span><br><span class="line">==&gt; default: Forwarding ports...</span><br><span class="line">    default: 22 (guest) =&gt; 2222 (host) (adapter 1)</span><br><span class="line">==&gt; default: Booting VM...</span><br><span class="line">==&gt; default: Waiting for machine to boot. This may take a few minutes...</span><br><span class="line">    default: SSH address: 127.0.0.1:2222</span><br><span class="line">    default: SSH username: vagrant</span><br><span class="line">    default: SSH auth method: private key</span><br><span class="line">    default:</span><br><span class="line">    default: Vagrant insecure key detected. Vagrant will automatically replace</span><br><span class="line">    default: this with a newly generated keypair for better security.</span><br><span class="line">    default:</span><br><span class="line">    default: Inserting generated public key within guest...</span><br><span class="line">    default: Removing insecure key from the guest if it's present...</span><br><span class="line">    default: Key inserted! Disconnecting and reconnecting using new SSH key...</span><br><span class="line">==&gt; default: Machine booted and ready!</span><br><span class="line">==&gt; default: Checking for guest additions in VM...</span><br><span class="line">    default: No guest additions were detected on the base box for this VM! Guest</span><br><span class="line">    default: additions are required for forwarded ports, shared folders, host only</span><br><span class="line">    default: networking, and more. If SSH fails on this machine, please install</span><br><span class="line">    default: the guest additions and repackage the box to continue.</span><br><span class="line">    default:</span><br><span class="line">    default: This is not an error message; everything may continue to work properly,</span><br><span class="line">    default: in which case you may ignore this message.</span><br><span class="line">==&gt; default: Configuring and enabling network interfaces...</span><br><span class="line">==&gt; default: Rsyncing folder: /cygdrive/c/Users/Administrator/ =&gt; /vagrant</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>vagrant ssh 开启SSH，并登陆到centos7</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">vagrant ssh</span></span><br><span class="line">[vagrant@localhost ~]$ ip addr</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1/128 scope host</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000</span><br><span class="line">    link/ether 52:54:00:8a:fe:e6 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 10.0.2.15/24 brd 10.0.2.255 scope global noprefixroute dynamic eth0</span><br><span class="line">       valid_lft 86091sec preferred_lft 86091sec</span><br><span class="line">    inet6 fe80::5054:ff:fe8a:fee6/64 scope link</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">3: eth1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000</span><br><span class="line">    link/ether 08:00:27:d1:76:f6 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 192.168.56.102/24 brd 192.168.56.255 scope global noprefixroute dynamic eth1</span><br><span class="line">       valid_lft 892sec preferred_lft 892sec</span><br><span class="line">    inet6 fe80::8c94:1942:ba09:2458/64 scope link noprefixroute</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">[vagrant@localhost ~]$</span><br></pre></td></tr></tbody></table></figure>



<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">C:\Users\Administrator&gt;ipconfig</span><br><span class="line"></span><br><span class="line">Windows IP 配置</span><br><span class="line"></span><br><span class="line">以太网适配器 VirtualBox Host-Only Network:</span><br><span class="line"></span><br><span class="line">   连接特定的 DNS 后缀 . . . . . . . :</span><br><span class="line">   本地链接 IPv6 地址. . . . . . . . : fe80::a00c:1ffa:a39a:c8c2%16</span><br><span class="line">   IPv4 地址 . . . . . . . . . . . . : 192.168.56.1</span><br><span class="line">   子网掩码  . . . . . . . . . . . . : 255.255.255.0</span><br><span class="line">   默认网关. . . . . . . . . . . . . :</span><br></pre></td></tr></tbody></table></figure>


<p>配置网络信息，打开”Vagrantfile”文件：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">config.vm.network "private_network", ip: "192.168.56.10"</span><br></pre></td></tr></tbody></table></figure>



<p>修改完成后，重启启动vagrant</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">vagrant reload</span><br></pre></td></tr></tbody></table></figure>

<p>检查宿主机和virtualBox之间的通信是否正常</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">[vagrant@localhost ~]$ ping 192.168.43.43                                                                                                         PING 192.168.43.43 (192.168.43.43) 56(84) bytes of data.</span><br><span class="line">64 bytes from 192.168.43.43: icmp_seq=1 ttl=127 time=0.533 ms</span><br><span class="line">64 bytes from 192.168.43.43: icmp_seq=2 ttl=127 time=0.659 ms</span><br><span class="line"></span><br><span class="line">--- 192.168.43.43 ping statistics ---</span><br><span class="line">2 packets transmitted, 2 received, 0% packet loss, time 999ms</span><br><span class="line">rtt min/avg/max/mdev = 0.533/0.596/0.659/0.063 ms</span><br><span class="line">[vagrant@localhost ~]$</span><br><span class="line">[vagrant@localhost ~]$</span><br><span class="line">[vagrant@localhost ~]$ ping www.baidu.com</span><br><span class="line">PING www.a.shifen.com (112.80.248.76) 56(84) bytes of data.</span><br><span class="line">64 bytes from 112.80.248.76 (112.80.248.76): icmp_seq=1 ttl=53 time=56.1 ms</span><br><span class="line">64 bytes from 112.80.248.76 (112.80.248.76): icmp_seq=2 ttl=53 time=58.5 ms</span><br><span class="line">64 bytes from 112.80.248.76 (112.80.248.76): icmp_seq=3 ttl=53 time=53.4 ms</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>开启远程登陆，修改“/etc/ssh/sshd_config”</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">PermitRootLogin yes </span><br><span class="line">PasswordAuthentication yes</span><br></pre></td></tr></tbody></table></figure>

<p>然后重启SSHD</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">systemctl restart sshd</span><br></pre></td></tr></tbody></table></figure>

<p>使用Xshell或SecureCRT进行远程连接。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/image-20200503174735162.png" alt="image-20200503174735162"></p>
<h2 id="2-docker中安装mysql"><a href="#2-docker中安装mysql" class="headerlink" title="2. docker中安装mysql"></a>2. docker中安装mysql</h2><figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">[root@hadoop-104 module]# docker pull mysql:5.7</span><br><span class="line">5.7: Pulling from library/mysql</span><br><span class="line">123275d6e508: Already exists </span><br><span class="line">27cddf5c7140: Pull complete </span><br><span class="line">c17d442e14c9: Pull complete </span><br><span class="line">2eb72ffed068: Pull complete </span><br><span class="line">d4aa125eb616: Pull complete </span><br><span class="line">52560afb169c: Pull complete </span><br><span class="line">68190f37a1d2: Pull complete </span><br><span class="line">3fd1dc6e2990: Pull complete </span><br><span class="line">85a79b83df29: Pull complete </span><br><span class="line">35e0b437fe88: Pull complete </span><br><span class="line">992f6a10268c: Pull complete </span><br><span class="line">Digest: sha256:82b72085b2fcff073a6616b84c7c3bcbb36e2d13af838cec11a9ed1d0b183f5e</span><br><span class="line">Status: Downloaded newer image for mysql:5.7</span><br><span class="line">docker.io/library/mysql:5.7</span><br></pre></td></tr></tbody></table></figure>

<p>查看镜像</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">[root@hadoop-104 module]# docker images</span><br><span class="line">REPOSITORY  TAG    IMAGE ID     CREATED       SIZE</span><br><span class="line">mysql       5.7    f5829c0eee9e 2 hours ago   455MB</span><br><span class="line">[root@hadoop-104 module]# </span><br></pre></td></tr></tbody></table></figure>

<p>启动mysql</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">sudo docker run -p 3306:3306 --name mysql \</span><br><span class="line">-v /mydata/mysql/log:/var/log/mysql \</span><br><span class="line">-v /mydata/mysql/data:/var/lib/mysql \</span><br><span class="line">-v /mydata/mysql/conf:/etc/mysql \</span><br><span class="line">-e MYSQL_ROOT_PASSWORD=root \</span><br><span class="line">-d mysql:5.7</span><br></pre></td></tr></tbody></table></figure>

<p>修改配置</p>
<figure class="highlight properties"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">[root@hadoop-104</span> <span class="string">conf]# pwd</span></span><br><span class="line"><span class="attr">/mydata/mysql/conf</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">[root@hadoop-104</span> <span class="string">conf]# cat my.cnf</span></span><br><span class="line"><span class="attr">[client]</span></span><br><span class="line"><span class="attr">default-character-set</span>=<span class="string">utf8</span></span><br><span class="line"><span class="attr">[mysql]</span></span><br><span class="line"><span class="attr">default-character-set</span>=<span class="string">utf8</span></span><br><span class="line"><span class="attr">[mysqld]</span></span><br><span class="line"><span class="attr">init_connect</span>=<span class="string">'SET collation_connection = utf8_unicode_ci'</span></span><br><span class="line"><span class="attr">init_connect</span>=<span class="string">'SET NAMES utf8'</span></span><br><span class="line"><span class="attr">character-set-server</span>=<span class="string">utf8</span></span><br><span class="line"><span class="attr">collation-server</span>=<span class="string">utf8_unicode_ci</span></span><br><span class="line"><span class="attr">skip-character-set-client-handshake</span></span><br><span class="line"><span class="attr">skip-name-resolve</span></span><br><span class="line"><span class="attr">[root@hadoop-104</span> <span class="string">conf]# </span></span><br><span class="line"></span><br><span class="line"><span class="attr">[root@hadoop-104</span> <span class="string">conf]# docker restart mysql</span></span><br><span class="line"><span class="attr">mysql</span></span><br><span class="line"><span class="attr">[root@hadoop-104</span> <span class="string">conf]# </span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>



<p>进入容器查看配置：</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">[root@hadoop-104 conf]# docker exec -it mysql /bin/bash</span><br><span class="line">root@b3a74e031bd7:/# whereis mysql</span><br><span class="line">mysql: /usr/bin/mysql /usr/lib/mysql /etc/mysql /usr/share/mysql</span><br><span class="line"></span><br><span class="line">root@b3a74e031bd7:/# ls /etc/mysql </span><br><span class="line">my.cnf</span><br><span class="line">root@b3a74e031bd7:/# cat /etc/mysql/my.cnf </span><br><span class="line">[client]</span><br><span class="line">default-character-set=utf8</span><br><span class="line">[mysql]</span><br><span class="line">default-character-set=utf8</span><br><span class="line">[mysqld]</span><br><span class="line">init_connect='SET collation_connection = utf8_unicode_ci'</span><br><span class="line">init_connect='SET NAMES utf8'</span><br><span class="line">character-set-server=utf8</span><br><span class="line">collation-server=utf8_unicode_ci</span><br><span class="line">skip-character-set-client-handshake</span><br><span class="line">skip-name-resolve</span><br><span class="line">root@b3a74e031bd7:/# </span><br></pre></td></tr></tbody></table></figure>



<p>设置启动docker时，即运行mysql</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">[root@hadoop-104 ~]# docker update mysql --restart=always</span><br><span class="line">mysql</span><br><span class="line">[root@hadoop-104 ~]# </span><br></pre></td></tr></tbody></table></figure>


<h2 id="3-docker中安装redis"><a href="#3-docker中安装redis" class="headerlink" title="3. docker中安装redis"></a>3. docker中安装redis</h2><p>下载docker</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">[root@hadoop-104 ~]# docker pull redis</span><br><span class="line">Using default tag: latest</span><br><span class="line">latest: Pulling from library/redis</span><br><span class="line">123275d6e508: Already exists </span><br><span class="line">f2edbd6a658e: Pull complete </span><br><span class="line">66960bede47c: Pull complete </span><br><span class="line">79dc0b596c90: Pull complete </span><br><span class="line">de36df38e0b6: Pull complete </span><br><span class="line">602cd484ff92: Pull complete </span><br><span class="line">Digest: sha256:1d0b903e3770c2c3c79961b73a53e963f4fd4b2674c2c4911472e8a054cb5728</span><br><span class="line">Status: Downloaded newer image for redis:latest</span><br><span class="line">docker.io/library/redis:latest</span><br></pre></td></tr></tbody></table></figure>



<p>启动docker</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">[root@hadoop-104 ~]# mkdir -p /mydata/redis/conf</span><br><span class="line">[root@hadoop-104 ~]# touch /mydata/redis/conf/redis.conf</span><br><span class="line">[root@hadoop-104 ~]# echo "appendonly yes"  &gt;&gt; /mydata/redis/conf/redis.conf</span><br><span class="line">[root@hadoop-104 ~]# docker run -p 6379:6379 --name redis -v /mydata/redis/data:/data \</span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">-v /mydata/redis/conf/redis.conf:/etc/redis/redis.conf \</span></span><br><span class="line"><span class="language-bash">&gt; -d redis redis-server /etc/redis/redis.conf</span></span><br><span class="line">ce7ae709711986e3f90c9278b284fe6f51f1c1102ba05f3692f0e934ceca1565</span><br><span class="line">[root@hadoop-104 ~]# </span><br></pre></td></tr></tbody></table></figure>

<p> 连接到docker的redis</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">[root@hadoop-104 ~]# docker exec -it redis redis-cli</span><br><span class="line">127.0.0.1:6379&gt; set key1 v1</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; get key1</span><br><span class="line">"v1"</span><br><span class="line">127.0.0.1:6379&gt; </span><br></pre></td></tr></tbody></table></figure>

<p>设置redis容器在docker启动的时候启动</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">[root@hadoop-104 ~]# docker update redis --restart=always</span><br><span class="line">redis</span><br><span class="line">[root@hadoop-104 ~]# </span><br></pre></td></tr></tbody></table></figure>



<h2 id="4-创建maven工程"><a href="#4-创建maven工程" class="headerlink" title="4. 创建maven工程"></a>4. 创建maven工程</h2><h2 id="5-执行sql脚本"><a href="#5-执行sql脚本" class="headerlink" title="5. 执行sql脚本"></a>5. 执行sql脚本</h2><p>gulimall_oms.sql<br>gulimall_pms.sql<br>gulimall_sms.sql<br>gulimall_ums.sql<br>gulimall_wms.sql<br>pms_catelog.sql<br>sys_menus.sql</p>
<h2 id="6-clone-人人开源"><a href="#6-clone-人人开源" class="headerlink" title="6. clone 人人开源"></a>6. clone 人人开源</h2><p><a target="_blank" rel="noopener" href="https://gitee.com/renrenio">https://gitee.com/renrenio</a></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/1587609877028.png" alt="1587609877028"></p>
<p>克隆到本地：</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">git clone https://gitee.com/renrenio/renren-fast-vue.git</span><br><span class="line"></span><br><span class="line">git clone https://gitee.com/renrenio/renren-fast.git</span><br></pre></td></tr></tbody></table></figure>



<p>将拷贝下来的“renren-fast”删除“.git”后，拷贝到“gulimall”工程根目录下，然后将它作为gulimall的一个module</p>
<p>创建“gulimall_admin”的数据库，然后执行“renren-fast/db/mysql.sql”中的SQl脚本</p>
<p>修改“application-dev.yml”文件，默认为dev环境，修改连接mysql的url和用户名密码</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">spring:</span><br><span class="line">    datasource:</span><br><span class="line">        <span class="built_in">type</span>: com.alibaba.druid.pool.DruidDataSource</span><br><span class="line">        druid:</span><br><span class="line">            driver-class-name: com.mysql.cj.jdbc.Driver</span><br><span class="line">            url: jdbc:mysql://192.168.137.14:3306/gulimall_admin?useUnicode=<span class="literal">true</span>&amp;characterEncoding=UTF-8&amp;serverTimezone=Asia/Shanghai</span><br><span class="line">            username: root</span><br><span class="line">            password: root</span><br></pre></td></tr></tbody></table></figure>





<p>启动“gulimall_admin”，然后访问“<a target="_blank" rel="noopener" href="http://localhost:8080/renren-fast/">http://localhost:8080/renren-fast/</a>”</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/1587616296253.png" alt="1587616296253"></p>
<p>安装node.js，并且安装仓库</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">npm config <span class="built_in">set</span> registry http://registry.npm.taobao.org/</span><br></pre></td></tr></tbody></table></figure>



<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">PS D:\tmp\renren-fast-vue&gt; npm config set registry http://registry.npm.taobao.org/</span><br><span class="line">PS D:\tmp\renren-fast-vue&gt; npm install</span><br><span class="line">npm WARN ajv-keywords@1.5.1 requires a peer of ajv@&gt;=4.10.0 but none is installed. You must install peer dependencies yourself.</span><br><span class="line">npm WARN sass-loader@6.0.6 requires a peer of node-sass@^4.0.0 but none is installed. You must install peer dependencies yourself.</span><br><span class="line">npm WARN optional SKIPPING OPTIONAL DEPENDENCY: fsevents@1.2.9 (node_modules\fsevents):</span><br><span class="line">npm WARN notsup SKIPPING OPTIONAL DEPENDENCY: Unsupported platform for fsevents@1.2.9: wanted {"os":"darwin","arch":"any"} (current: {"os":"win32","arch":"x64"})</span><br><span class="line"></span><br><span class="line">up to date in 17.227s</span><br><span class="line">PS D:\tmp\renren-fast-vue&gt; </span><br></pre></td></tr></tbody></table></figure>



<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">PS D:\tmp\renren-fast-vue&gt; npm run dev</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">renren-fast-vue@1.2.2 dev D:\tmp\renren-fast-vue</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">webpack-dev-server --inline --progress --config build/webpack.dev.conf.js</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"> 10% </span><span class="language-bash">building modules 5/10 modules 5 active ...-0!D:\tmp\renren-fast-vue\src\main.js(node:19864) Warning: Accessing non-existent property <span class="string">'cat'</span> of module exports inside circular dependency</span></span><br><span class="line">(Use `node --trace-warnings ...` to show where the warning was created)</span><br><span class="line">(node:19864) Warning: Accessing non-existent property 'cd' of module exports inside circular dependency</span><br><span class="line">(node:19864) Warning: Accessing non-existent property 'chmod' of module exports inside circular dependency</span><br><span class="line">(node:19864) Warning: Accessing non-existent property 'cp' of module exports inside circular dependency</span><br><span class="line">(node:19864) Warning: Accessing non-existent property 'dirs' of module exports inside circular dependency</span><br><span class="line">(node:19864) Warning: Accessing non-existent property 'pushd' of module exports inside circular dependency</span><br><span class="line">(node:19864) Warning: Accessing non-existent property 'popd' of module exports inside circular dependency</span><br><span class="line">(node:19864) Warning: Accessing non-existent property 'echo' of module exports inside circular dependency</span><br><span class="line">(node:19864) Warning: Accessing non-existent property 'tempdir' of module exports inside circular dependency</span><br><span class="line">(node:19864) Warning: Accessing non-existent property 'pwd' of module exports inside circular dependency</span><br></pre></td></tr></tbody></table></figure>



<p>常见问题1：“Module build failed: Error: Cannot find module ‘node-sass”</p>
<p>运行过程中，出现“Module build failed: Error: Cannot find module ‘node-sass’报错问题”，解决方法</p>
<blockquote>
<p>用npm install -g cnpm –registry=<a target="_blank" rel="noopener" href="https://registry.npm.taobao.org/">https://registry.npm.taobao.org</a> ，从淘宝镜像那下载，然后cnpm下载成功。</p>
<p>最后输入cnpm install node-sass –save。npm run dev终于能跑起来了！！！<br>————————————————<br>版权声明：本文为CSDN博主「夕阳下美了剪影」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。<br>原文链接：<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_38401285/article/details/86483278">https://blog.csdn.net/qq_38401285/article/details/86483278</a></p>
</blockquote>
<p>常见问题2：cnpm - 解决 “ cnpm : 无法加载文件 C:\Users\93457\AppData\Roaming\npm\cnpm.ps1，因为在此系统上禁止运行脚本。有关详细信息 。。。 “</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/500m/p/11634969.html">https://www.cnblogs.com/500m/p/11634969.html</a></p>
<p>所有问题的根源都在“node_modules”，npm install之前，应该将这个文件夹删除，然后再进行安装和运行。</p>
<p>再次运行npm run dev恢复正常：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/1587637858665.png" alt="1587637858665"></p>
<h2 id="7-clone-renren-generator"><a href="#7-clone-renren-generator" class="headerlink" title="7. clone renren-generator"></a>7. clone renren-generator</h2><h3 id="clone"><a href="#clone" class="headerlink" title="clone"></a>clone</h3><p><a target="_blank" rel="noopener" href="https://gitee.com/renrenio/renren-generator.git">https://gitee.com/renrenio/renren-generator.git</a></p>
<p>然后将该项目放置到“gulimall”的跟路径下，然后添加该Module，并且提交到github上</p>
<h3 id="修改配置"><a href="#修改配置" class="headerlink" title="修改配置"></a>修改配置</h3><p>renren-generator/src/main/resources/generator.properties</p>
<figure class="highlight properties"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">#代码生成器，配置信息</span></span><br><span class="line"></span><br><span class="line"><span class="attr">mainPath</span>=<span class="string">com.bigdata</span></span><br><span class="line"><span class="comment">#包名</span></span><br><span class="line"><span class="attr">package</span>=<span class="string">com.bigdata.gulimall</span></span><br><span class="line"><span class="attr">moduleName</span>=<span class="string">product</span></span><br><span class="line"><span class="comment">#作者</span></span><br><span class="line"><span class="attr">author</span>=<span class="string">cosmoswong</span></span><br><span class="line"><span class="comment">#Email</span></span><br><span class="line"><span class="attr">email</span>=<span class="string">cosmoswong@sina.com</span></span><br><span class="line"><span class="comment">#表前缀(类名不会包含表前缀)</span></span><br><span class="line"><span class="attr">tablePrefix</span>=<span class="string">pms_</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="运行“renren-generator”"><a href="#运行“renren-generator”" class="headerlink" title="运行“renren-generator”"></a>运行“renren-generator”</h3><p>访问：&lt;<a target="_blank" rel="noopener" href="http://localhost/">http://localhost:80/</a></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/1587638853416.png" alt="1587638853416"></p>
<p>点击“renren-fast”，能够看到它将“renren-fast”的所有表都列举了出来：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/1587638968519.png" alt="1587638968519"></p>
<p>选择所有的表，然后点击“生成代码”，将下载的“renren.zip”，解压后取出main文件夹，放置到“gulimall-product”项目的main目录中。</p>
<p>下面的几个module，也采用同样的方式来操作。</p>
<p>但是针对于“undo_log”，存在一个问题</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/1587657745923.png" alt="1587657745923"></p>
<p>它的数据类型是“longblob”类型，逆向工程后，对应的数据类型未知：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/1587657812283.png" alt="1587657812283"></p>
<p>这个问题该要怎么解决？</p>
<h2 id="8-微服务注册中心"><a href="#8-微服务注册中心" class="headerlink" title="8. 微服务注册中心"></a>8. 微服务注册中心</h2><p>要注意nacos集群所在的server，一定要关闭防火墙，否则容易出现各种问题。</p>
<p>搭建nacos集群，然后分别启动各个微服务，将它们注册到Nacos中。</p>
<figure class="highlight yaml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">application:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">gulimall-coupon</span></span><br><span class="line"><span class="attr">cloud:</span></span><br><span class="line">  <span class="attr">nacos:</span></span><br><span class="line">    <span class="attr">discovery:</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="number">192.168</span><span class="number">.137</span><span class="number">.14</span></span><br></pre></td></tr></tbody></table></figure>



<p>查看注册情况：</p>
<p><a target="_blank" rel="noopener" href="http://192.168.137.14:8848/nacos/#/serviceManagement?dataId=&amp;group=&amp;appName=&amp;namespace=">http://192.168.137.14:8848/nacos/#/serviceManagement?dataId=&amp;group=&amp;appName=&amp;namespace=</a></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/1587694451601.png" alt="1587694451601"></p>
<h2 id="9-使用openfen"><a href="#9-使用openfen" class="headerlink" title="9. 使用openfen"></a>9. 使用openfen</h2><p>1)、引入open-feign</p>
<figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>



<p>2)、编写一个接口，告诉SpringCLoud这个接口需要调用远程服务</p>
<p>修改“com.bigdata.gulimall.coupon.controller.CouponController”，添加以下controller方法：</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping("/member/list")</span></span><br><span class="line"><span class="keyword">public</span> R <span class="title function_">memberCoupons</span><span class="params">()</span>{</span><br><span class="line">    <span class="type">CouponEntity</span> <span class="variable">couponEntity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CouponEntity</span>();</span><br><span class="line">    couponEntity.setCouponName(<span class="string">"discount 20%"</span>);</span><br><span class="line">    <span class="keyword">return</span> R.ok().put(<span class="string">"coupons"</span>,Arrays.asList(couponEntity));</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>



<p>新建“com.bigdata.gulimall.member.feign.CouponFeignService”接口</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@FeignClient("gulimall_coupon")</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CouponFeignService</span> {</span><br><span class="line">    <span class="meta">@RequestMapping("/coupon/coupon/member/list")</span></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">memberCoupons</span><span class="params">()</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>



<p>修改“com.bigdata.gulimall.member.GulimallMemberApplication”类，添加上”@EnableFeignClients”：</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="meta">@EnableFeignClients(basePackages = "com.bigdata.gulimall.member.feign")</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GulimallMemberApplication</span> {</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        SpringApplication.run(GulimallMemberApplication.class, args);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>



<p>​	声明接口的每一个方法都是调用哪个远程服务的那个请求</p>
<p>3)、开启远程调用功能</p>
<p>com.bigdata.gulimall.member.controller.MemberController</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping("/coupons")</span></span><br><span class="line"><span class="keyword">public</span> R <span class="title function_">test</span><span class="params">()</span>{</span><br><span class="line">    MemberEntity memberEntity=<span class="keyword">new</span> <span class="title class_">MemberEntity</span>();</span><br><span class="line">    memberEntity.setNickname(<span class="string">"zhangsan"</span>);</span><br><span class="line">    <span class="type">R</span> <span class="variable">memberCoupons</span> <span class="operator">=</span> couponFeignService.memberCoupons();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> memberCoupons.put(<span class="string">"member"</span>,memberEntity).put(<span class="string">"coupons"</span>,memberCoupons.get(<span class="string">"coupons"</span>));</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>





<p>(4)、访问<a target="_blank" rel="noopener" href="http://localhost:8000/member/member/coupons">http://localhost:8000/member/member/coupons</a></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/1587701348764.png" alt="1587701348764"></p>
<p>停止“gulimall-coupon”服务，能够看到注册中心显示该服务的健康值为0：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/1587701521184.png" alt="1587701521184"></p>
<p>再次访问：<a target="_blank" rel="noopener" href="http://localhost:8000/member/member/coupons">http://localhost:8000/member/member/coupons</a></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/1587701587456.png" alt="1587701587456"></p>
<p>启动“gulimall-coupon”服务，再次访问，又恢复了正常。</p>
<h2 id="10-配置中心"><a href="#10-配置中心" class="headerlink" title="10. 配置中心"></a>10. 配置中心</h2><h3 id="1）修改“gulimall-coupon”模块"><a href="#1）修改“gulimall-coupon”模块" class="headerlink" title="1）修改“gulimall-coupon”模块"></a>1）修改“gulimall-coupon”模块</h3><p>添加pom依赖：</p>
<figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>



<p>创建bootstrap.properties文件，该配置文件会优先于“application.yml”加载。</p>
<figure class="highlight properties"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">spring.application.name</span>=<span class="string">gulimall-coupon</span></span><br><span class="line"><span class="attr">spring.cloud.nacos.config.server-addr</span>=<span class="string">192.168.137.14:8848</span></span><br></pre></td></tr></tbody></table></figure>



<h3 id="2）传统方式"><a href="#2）传统方式" class="headerlink" title="2）传统方式"></a>2）传统方式</h3><p>为了详细说明config的使用方法，先来看原始的方式</p>
<p>创建“application.properties”配置文件，添加如下配置内容：</p>
<figure class="highlight properties"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">coupon.user.name</span>=<span class="string">"zhangsan"</span></span><br><span class="line"><span class="attr">coupon.user.age</span>=<span class="string">30</span></span><br></pre></td></tr></tbody></table></figure>

<p>修改“com.bigdata.gulimall.coupon.controller.CouponController”文件，添加如下内容：</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Value("${coupon.user.name}")</span></span><br><span class="line"><span class="keyword">private</span> String name;</span><br><span class="line"><span class="meta">@Value("${coupon.user.age}")</span></span><br><span class="line"><span class="keyword">private</span> Integer age;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping("/test")</span></span><br><span class="line"><span class="keyword">public</span> R <span class="title function_">getConfigInfo</span><span class="params">()</span>{</span><br><span class="line">   <span class="keyword">return</span> R.ok().put(<span class="string">"name"</span>,name).put(<span class="string">"age"</span>,age);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>



<p>启动“gulimall-coupon”服务：</p>
<p>访问：<a target="_blank" rel="noopener" href="http://localhost:7000/coupon/coupon/test%3E">http://localhost:7000/coupon/coupon/test&gt;</a></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/1587716583668.png" alt="1587716583668"></p>
<p>这样做存在的一个问题，如果频繁的修改application.properties，在需要频繁重新打包部署。下面我们将采用Nacos的配置中心来解决这个问题。</p>
<h3 id="3）nacos-config"><a href="#3）nacos-config" class="headerlink" title="3）nacos config"></a>3）nacos config</h3><p>1、在Nacos注册中心中，点击“配置列表”，添加配置规则：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/1587716911435.png" alt="1587716911435"></p>
<p>DataID：gulimall-coupon</p>
<p>配置格式：properties</p>
<p>文件的命名规则为：${spring.application.name}-${spring.profiles.active}.${spring.cloud.nacos.config.file-extension}</p>
<p>${spring.application.name}：为微服务名</p>
<p>${spring.profiles.active}：指明是哪种环境下的配置，如dev、test或info</p>
<p>${spring.cloud.nacos.config.file-extension}：配置文件的扩展名，可以为properties、yml等</p>
<p>2、查看配置：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/1587717125580.png" alt="1587717125580"></p>
<p>3、修改“com.bigdata.gulimall.coupon.controller.CouponController”类，添加“@RefreshScope”注解</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping("coupon/coupon")</span></span><br><span class="line"><span class="meta">@RefreshScope</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CouponController</span> {</span><br></pre></td></tr></tbody></table></figure>

<p>这样都会动态的从配置中心读取配置.</p>
<p>4、访问：<a target="_blank" rel="noopener" href="http://localhost:7000/coupon/coupon/test">http://localhost:7000/coupon/coupon/test</a></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/1587717485283.png" alt="1587717485283"></p>
<p>能够看到读取到了nacos 中的最新的配置信息，并且在指明了相同的配置信息时，配置中心中设置的值优先于本地配置。</p>
<h3 id="4）Nacos支持三种配置加载方方案"><a href="#4）Nacos支持三种配置加载方方案" class="headerlink" title="4）Nacos支持三种配置加载方方案"></a>4）Nacos支持三种配置加载方方案</h3><p>Nacos支持“Namespace+group+data ID”的配置解决方案。</p>
<p>详情见：<a target="_blank" rel="noopener" href="https://github.com/alibaba/spring-cloud-alibaba/blob/master/spring-cloud-alibaba-docs/src/main/asciidoc-zh/nacos-config.adoc">https://github.com/alibaba/spring-cloud-alibaba/blob/master/spring-cloud-alibaba-docs/src/main/asciidoc-zh/nacos-config.adoc</a></p>
<h5 id="Namespace方案"><a href="#Namespace方案" class="headerlink" title="Namespace方案"></a>Namespace方案</h5><p>通过命名空间实现环境区分</p>
<p>下面是配置实例：</p>
<p>1、创建命名空间：</p>
<p>“命名空间”—&gt;“创建命名空间”：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/1587718802109.png" alt="1587718802109"></p>
<p> 创建三个命名空间，分别为dev，test和prop</p>
<p>2、回到配置列表中，能够看到所创建的三个命名空间</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/1587718889316.png" alt="1587718889316"></p>
<p>下面我们需要在dev命名空间下，创建“gulimall-coupon.properties”配置规则：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/1587719108947.png" alt="1587719108947"></p>
<p>3、访问：<a target="_blank" rel="noopener" href="http://localhost:7000/coupon/coupon/test">http://localhost:7000/coupon/coupon/test</a></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/1587721184218.png" alt="1587721184218"></p>
<p>并没有使用我们在dev命名空间下所配置的规则，而是使用的是public命名空间下所配置的规则，这是怎么回事呢？</p>
<p>查看“gulimall-coupon”服务的启动日志：</p>
<figure class="highlight verilog"><table><tbody><tr><td class="code"><pre><span class="line"><span class="number">2020</span>-<span class="number">04</span>-<span class="number">24</span> <span class="number">16</span>:<span class="number">37</span>:<span class="number">24</span><span class="variable">.158</span>  WARN <span class="number">32792</span> --- [           main] c<span class="variable">.a</span><span class="variable">.c</span><span class="variable">.n</span><span class="variable">.c</span><span class="variable">.NacosPropertySourceBuilder</span>     : Ignore the empty nacos configuration <span class="keyword">and</span> get it based on dataId[gulimall-coupon] &amp; group[DEFAULT_GROUP]</span><br><span class="line"><span class="number">2020</span>-<span class="number">04</span>-<span class="number">24</span> <span class="number">16</span>:<span class="number">37</span>:<span class="number">24</span><span class="variable">.163</span>  INFO <span class="number">32792</span> --- [           main] c<span class="variable">.a</span><span class="variable">.nacos</span><span class="variable">.client</span><span class="variable">.config</span><span class="variable">.utils</span><span class="variable">.JVMUtil</span>    : isMultiInstance:false</span><br><span class="line"><span class="number">2020</span>-<span class="number">04</span>-<span class="number">24</span> <span class="number">16</span>:<span class="number">37</span>:<span class="number">24</span><span class="variable">.169</span>  INFO <span class="number">32792</span> --- [           main] b<span class="variable">.c</span><span class="variable">.PropertySourceBootstrapConfiguration</span> : Located <span class="keyword">property</span> source: [BootstrapPropertySource {name='bootstrapProperties-gulimall-coupon<span class="variable">.properties</span>,DEFAULT_GROUP'}, BootstrapPropertySource {name='bootstrapProperties-gulimall-coupon,DEFAULT_GROUP'}]</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>**”gulimall-coupon.properties”**，默认就是public命名空间中的内容中所配置的规则。</p>
<p>4、指定命名空间</p>
<p>如果想要使得我们自定义的命名空间生效，需要在“bootstrap.properties”文件中，指定使用哪个命名空间：</p>
<figure class="highlight properties"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">spring.cloud.nacos.config.namespace</span>=<span class="string">a2c83f0b-e0a8-40fb-9b26-1e9d61be7d6d</span></span><br></pre></td></tr></tbody></table></figure>

<p>这个命名空间ID来源于我们在第一步所创建的命名空间</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/1587718802109.png" alt="1587718802109"></p>
<p>5、重启“gulimall-coupon”，再次访问：<a target="_blank" rel="noopener" href="http://localhost:7000/coupon/coupon/test">http://localhost:7000/coupon/coupon/test</a></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/1587720311349.png" alt="1587720311349"></p>
<p>但是这种命名空间的粒度还是不够细化，对此我们可以为项目的每个微服务module创建一个命名空间。</p>
<p>6、为所有微服务创建命名空间</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/1587720714101.png" alt="1587720714101"></p>
<p>7、回到配置列表选项卡，克隆pulic的配置规则到coupon命名空间下</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/1587720883244.png" alt="1587720883244"></p>
<p>切换到coupon命名空间下，查看所克隆的规则：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/1587720963699.png" alt="1587720963699"></p>
<p>8、修改“gulimall-coupon”下的bootstrap.properties文件，添加如下配置信息</p>
<figure class="highlight properties"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">spring.cloud.nacos.config.namespace</span>=<span class="string">7905c915-64ad-4066-8ea9-ef63918e5f79</span></span><br></pre></td></tr></tbody></table></figure>

<p>这里指明的是，读取时使用coupon命名空间下的配置。</p>
<p>9、重启“gulimall-coupon”，访问：<a target="_blank" rel="noopener" href="http://localhost:7000/coupon/coupon/test">http://localhost:7000/coupon/coupon/test</a></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/1587721184218.png" alt="1587721184218"></p>
<h5 id="DataID方案"><a href="#DataID方案" class="headerlink" title="DataID方案"></a>DataID方案</h5><p>通过指定spring.profile.active和配置文件的DataID，来使不同环境下读取不同的配置，读取配置时，使用的是默认命名空间public，默认分组（default_group）下的DataID。</p>
<p>默认情况，Namespace=public，Group=DEFAULT GROUP，默认Cluster是DEFAULT</p>
<h5 id="Group方案"><a href="#Group方案" class="headerlink" title="Group方案"></a>Group方案</h5><p>通过Group实现环境区分</p>
<p>实例：通过使用不同的组，来读取不同的配置，还是以上面的gulimall-coupon微服务为例</p>
<p>1、新建“gulimall-coupon.properties”，将它置于“tmp”组下</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/1587721616021.png" alt="1587721616021"></p>
<p>2、修改“bootstrap.properties”配置，添加如下的配置</p>
<figure class="highlight properties"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">spring.cloud.nacos.config.group</span>=<span class="string">tmp</span></span><br></pre></td></tr></tbody></table></figure>

<p>3、重启“gulimall-coupon”，访问：<a target="_blank" rel="noopener" href="http://localhost:7000/coupon/coupon/test">http://localhost:7000/coupon/coupon/test</a></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/1587721844449.png" alt="1587721844449"></p>
<h3 id="5）同时加载多个配置集"><a href="#5）同时加载多个配置集" class="headerlink" title="5）同时加载多个配置集"></a>5）同时加载多个配置集</h3><p>当微服务数量很庞大时，将所有配置都书写到一个配置文件中，显然不是太合适。对此我们可以将配置按照功能的不同，拆分为不同的配置文件。</p>
<p>如下面的配置文件：</p>
<figure class="highlight yaml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">7000</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="comment">#MySQL配置</span></span><br><span class="line">    <span class="attr">driverClassName:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://192.168.137.14:3306/gulimall_sms?useUnicode=true&amp;characterEncoding=UTF-8&amp;useSSL=false</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">root</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">gulimall-coupon</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="number">192.168</span><span class="number">.137</span><span class="number">.14</span><span class="string">:8848</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="attr">global-config:</span></span><br><span class="line">    <span class="attr">db-config:</span></span><br><span class="line">      <span class="attr">id-type:</span> <span class="string">auto</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:/mapper/**/*.xml</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>



<p>我们可以将，</p>
<p>数据源有关的配置写到一个配置文件中：</p>
<figure class="highlight yaml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="comment">#MySQL配置</span></span><br><span class="line">    <span class="attr">driverClassName:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://192.168.137.14:3306/gulimall_sms?useUnicode=true&amp;characterEncoding=UTF-8&amp;useSSL=false</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">root</span></span><br></pre></td></tr></tbody></table></figure>

<p>和框架有关的写到另外一个配置文件中：</p>
<figure class="highlight yaml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="attr">global-config:</span></span><br><span class="line">    <span class="attr">db-config:</span></span><br><span class="line">      <span class="attr">id-type:</span> <span class="string">auto</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:/mapper/**/*.xml</span></span><br></pre></td></tr></tbody></table></figure>



<p>也可以将上面的这些配置交给nacos来进行管理。</p>
<p>实例：将“gulimall-coupon”的“application.yml”文件拆分为多个配置，并放置到nacos配置中心</p>
<p>1、创建“datasource.yml”，用于存储和数据源有关的配置</p>
<figure class="highlight yml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="comment">#MySQL配置</span></span><br><span class="line">    <span class="attr">driverClassName:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://192.168.137.14:3306/gulimall_sms?useUnicode=true&amp;characterEncoding=UTF-8&amp;useSSL=false</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">root</span></span><br></pre></td></tr></tbody></table></figure>

<p>在coupon命名空间中，创建“datasource.yml”配置</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/1587722798375.png" alt="1587722798375"></p>
<p>2、将和mybatis相关的配置，放置到“mybatis.yml”中</p>
<figure class="highlight yaml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="attr">global-config:</span></span><br><span class="line">    <span class="attr">db-config:</span></span><br><span class="line">      <span class="attr">id-type:</span> <span class="string">auto</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:/mapper/**/*.xml</span></span><br></pre></td></tr></tbody></table></figure>



<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/1587722710432.png" alt="1587722710432"></p>
<p>3、创建“other.yml”配置，保存其他的配置信息</p>
<figure class="highlight yaml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">7000</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">gulimall-coupon</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="number">192.168</span><span class="number">.137</span><span class="number">.14</span><span class="string">:8848</span></span><br></pre></td></tr></tbody></table></figure>



<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/1587722998265.png" alt="1587722998265"></p>
<p>现在“mybatis.yml”、“datasource.yml”和“other.yml”共同构成了微服务的配置。</p>
<p>4、修改“gulimall-coupon”的“bootstrap.properties”文件，加载“mybatis.yml”、“datasource.yml”和“other.yml”配置</p>
<figure class="highlight properties"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">spring.cloud.nacos.config.extension-configs[0].data-id</span>=<span class="string">mybatis.yml</span></span><br><span class="line"><span class="attr">spring.cloud.nacos.config.extension-configs[0].group</span>=<span class="string">dev</span></span><br><span class="line"><span class="attr">spring.cloud.nacos.config.extension-configs[0].refresh</span>=<span class="string">true</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring.cloud.nacos.config.extension-configs[1].data-id</span>=<span class="string">datasource.yml</span></span><br><span class="line"><span class="attr">spring.cloud.nacos.config.extension-configs[1].group</span>=<span class="string">dev</span></span><br><span class="line"><span class="attr">spring.cloud.nacos.config.extension-configs[1].refresh</span>=<span class="string">true</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">spring.cloud.nacos.config.extension-configs[2].data-id</span>=<span class="string">other.yml</span></span><br><span class="line"><span class="attr">spring.cloud.nacos.config.extension-configs[2].group</span>=<span class="string">dev</span></span><br><span class="line"><span class="attr">spring.cloud.nacos.config.extension-configs[2].refresh</span>=<span class="string">true</span></span><br></pre></td></tr></tbody></table></figure>

<p>“spring.cloud.nacos.config.ext-config”已经被废弃，建议使用“spring.cloud.nacos.config.extension-configs”</p>
<p>5、注释“application.yml”文件中的所有配置</p>
<p>6、重启“gulimall-coupon”服务，然后访问：<a target="_blank" rel="noopener" href="http://localhost:7000/coupon/coupon/test">http://localhost:7000/coupon/coupon/test</a></p>
<p> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/1587724212905.png" alt="1587724212905"></p>
<p>7、访问：<a target="_blank" rel="noopener" href="http://localhost:7000/coupon/coupon/list">http://localhost:7000/coupon/coupon/list</a>，查看是否能够正常的访问数据库</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/1587724350548.png" alt="1587724350548"></p>
<p>小结：</p>
<p>1)、微服务任何配置信息，任何配置文件都可以放在配置中心；</p>
<p>2)、只需要在bootstrap.properties中，说明加载配置中心的哪些配置文件即可；</p>
<p>3)、@Value, @ConfigurationProperties。都可以用来获取配置中心中所配置的信息；</p>
<p>4)、配置中心有的优先使用配置中心中的，没有则使用本地的配置。</p>
<h2 id="11-网关"><a href="#11-网关" class="headerlink" title="11. 网关"></a>11. 网关</h2><h3 id="1、注册“gulimall-gateway”到Nacos"><a href="#1、注册“gulimall-gateway”到Nacos" class="headerlink" title="1、注册“gulimall-gateway”到Nacos"></a>1、注册“gulimall-gateway”到Nacos</h3><h4 id="1）创建“gulimall-gateway”"><a href="#1）创建“gulimall-gateway”" class="headerlink" title="1）创建“gulimall-gateway”"></a>1）创建“gulimall-gateway”</h4><p>SpringCloud gateway</p>
<h4 id="2）添加“gulimall-common”依赖和“spring-cloud-starter-gateway”依赖"><a href="#2）添加“gulimall-common”依赖和“spring-cloud-starter-gateway”依赖" class="headerlink" title="2）添加“gulimall-common”依赖和“spring-cloud-starter-gateway”依赖"></a>2）添加“gulimall-common”依赖和“spring-cloud-starter-gateway”依赖</h4><figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.bigdata.gulimall<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>gulimall-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-gateway<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<h4 id="3）“com-bigdata-gulimall-gulimallgateway-GulimallGatewayApplication”类上加上“-EnableDiscoveryClient”注解"><a href="#3）“com-bigdata-gulimall-gulimallgateway-GulimallGatewayApplication”类上加上“-EnableDiscoveryClient”注解" class="headerlink" title="3）“com.bigdata.gulimall.gulimallgateway.GulimallGatewayApplication”类上加上“@EnableDiscoveryClient”注解"></a>3）“com.bigdata.gulimall.gulimallgateway.GulimallGatewayApplication”类上加上“@EnableDiscoveryClient”注解</h4><h4 id="4）在Nacos中创建“gateway”命名空间，同时在该命名空间中创建“gulimall-gateway-yml”"><a href="#4）在Nacos中创建“gateway”命名空间，同时在该命名空间中创建“gulimall-gateway-yml”" class="headerlink" title="4）在Nacos中创建“gateway”命名空间，同时在该命名空间中创建“gulimall-gateway.yml”"></a>4）在Nacos中创建“gateway”命名空间，同时在该命名空间中创建“gulimall-gateway.yml”</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/1587729576178.png" alt="1587729576178"></p>
<h4 id="5）创建“bootstrap-properties”文件，添加如下配置，指明配置中心地址和所属命名空间"><a href="#5）创建“bootstrap-properties”文件，添加如下配置，指明配置中心地址和所属命名空间" class="headerlink" title="5）创建“bootstrap.properties”文件，添加如下配置，指明配置中心地址和所属命名空间"></a>5）创建“bootstrap.properties”文件，添加如下配置，指明配置中心地址和所属命名空间</h4><figure class="highlight properties"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">spring.application.name</span>=<span class="string">gulimall-gateway</span></span><br><span class="line"><span class="attr">spring.cloud.nacos.config.server-addr</span>=<span class="string">192.168.137.14:8848</span></span><br><span class="line"><span class="attr">spring.cloud.nacos.config.namespace</span>=<span class="string">1c82552e-1af0-4ced-9a48-26f19c2d315f</span></span><br></pre></td></tr></tbody></table></figure>



<h4 id="6）创建“application-properties”文件，指定服务名和注册中心地址"><a href="#6）创建“application-properties”文件，指定服务名和注册中心地址" class="headerlink" title="6）创建“application.properties”文件，指定服务名和注册中心地址"></a>6）创建“application.properties”文件，指定服务名和注册中心地址</h4><figure class="highlight properties"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">spring.application.name</span>=<span class="string">gulimall-gateway</span></span><br><span class="line"><span class="attr">spring.cloud.nacos.discovery.server-addr</span>=<span class="string">192.168.137.14:8848</span></span><br><span class="line"><span class="attr">server.port</span>=<span class="string">88</span></span><br></pre></td></tr></tbody></table></figure>

<h4 id="7）启动“gulimall-gateway”"><a href="#7）启动“gulimall-gateway”" class="headerlink" title="7）启动“gulimall-gateway”"></a>7）启动“gulimall-gateway”</h4><p>启动报错：</p>
<figure class="highlight verilog"><table><tbody><tr><td class="code"><pre><span class="line">Description:</span><br><span class="line"></span><br><span class="line">Failed to configure a DataSource: 'url' attribute is <span class="keyword">not</span> specified <span class="keyword">and</span> no embedded datasource could be configured.</span><br><span class="line"></span><br><span class="line">Reason: Failed to determine a suitable driver <span class="keyword">class</span></span><br></pre></td></tr></tbody></table></figure>

<p>解决方法：在“com.bigdata.gulimall.gulimallgateway.GulimallGatewayApplication”中排除和数据源相关的配置</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication(exclude = {DataSourceAutoConfiguration.class})</span></span><br></pre></td></tr></tbody></table></figure>

<p>重新启动</p>
<p>访问：<a target="_blank" rel="noopener" href="http://192.168.137.14:8848/nacos/#">http://192.168.137.14:8848/nacos/#</a>，查看到该服务已经注册到了Nacos中</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/1587730035866.png" alt="1587730035866"></p>
<h3 id="2、案例"><a href="#2、案例" class="headerlink" title="2、案例"></a>2、案例</h3><p>现在想要实现针对于“<a target="_blank" rel="noopener" href="http://localhost:88/hello?url=baidu%E2%80%9D%EF%BC%8C%E8%BD%AC%E5%8F%91%E5%88%B0%E2%80%9Chttps://www.baidu.com%E2%80%9D%EF%BC%8C%E9%92%88%E5%AF%B9%E4%BA%8E%E2%80%9Chttp://localhost:88/hello?url=qq%E2%80%9D%E7%9A%84%E8%AF%B7%E6%B1%82%EF%BC%8C%E8%BD%AC%E5%8F%91%E5%88%B0%E2%80%9Chttps://www.qq.com/%E2%80%9D">http://localhost:88/hello?url=baidu”，转发到“https://www.baidu.com”，针对于“http://localhost:88/hello?url=qq”的请求，转发到“https://www.qq.com/”</a></p>
<h4 id="1）创建“application-yml”"><a href="#1）创建“application-yml”" class="headerlink" title="1）创建“application.yml”"></a>1）创建“application.yml”</h4><figure class="highlight yaml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">baidu_route</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">https://www.baidu.com</span></span><br><span class="line">          <span class="attr">predicates:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Query=url,</span> <span class="string">baidu</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">qq_route</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">https://www.qq.com/</span></span><br><span class="line">          <span class="attr">predicates:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Query=url,</span> <span class="string">qq</span></span><br></pre></td></tr></tbody></table></figure>

<h4 id="2）启动“gulimall-gateway”"><a href="#2）启动“gulimall-gateway”" class="headerlink" title="2）启动“gulimall-gateway”"></a>2）启动“gulimall-gateway”</h4><h4 id="3）测试"><a href="#3）测试" class="headerlink" title="3）测试"></a>3）测试</h4><p>访问：<a target="_blank" rel="noopener" href="http://localhost:88/hello?url=baidu">http://localhost:88/hello?url=baidu</a></p>
<p>访问：<a target="_blank" rel="noopener" href="http://localhost:88/hello?url=qq">http://localhost:88/hello?url=qq</a></p>
<h2 id="12-Vue"><a href="#12-Vue" class="headerlink" title="12. Vue"></a>12. Vue</h2><p>安装vue</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line"># 最新稳定版</span><br><span class="line">$ npm install vue</span><br></pre></td></tr></tbody></table></figure>

<h3 id="1、vue声明式渲染"><a href="#1、vue声明式渲染" class="headerlink" title="1、vue声明式渲染"></a>1、vue声明式渲染</h3><figure class="highlight javascript"><table><tbody><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">let</span> vm = <span class="keyword">new</span> <span class="title class_">Vue</span>({</span><br><span class="line">    <span class="attr">el</span>: <span class="string">"#app"</span>,<span class="comment">//绑定元素</span></span><br><span class="line">    <span class="attr">data</span>: {  <span class="comment">//封装数据</span></span><br><span class="line">        <span class="attr">name</span>: <span class="string">"张三"</span>,</span><br><span class="line">        <span class="attr">num</span>: <span class="number">1</span></span><br><span class="line">    },</span><br><span class="line">    <span class="attr">methods</span>:{  <span class="comment">//封装方法</span></span><br><span class="line">        <span class="title function_">cancle</span>(<span class="params"></span>){</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">num</span> -- ;</span><br><span class="line">        },</span><br><span class="line">        <span class="title function_">hello</span>(<span class="params"></span>){</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"1"</span></span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">});</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>



<h3 id="2、双向绑定-模型变化，视图变化。反之亦然"><a href="#2、双向绑定-模型变化，视图变化。反之亦然" class="headerlink" title="2、双向绑定,模型变化，视图变化。反之亦然"></a>2、双向绑定,模型变化，视图变化。反之亦然</h3><p>双向绑定使用v-model</p>
<figure class="highlight html"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">v-model</span>=<span class="string">"num"</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>



<figure class="highlight javascript"><table><tbody><tr><td class="code"><pre><span class="line">&lt;h1&gt; {{name}} ,非常帅，有{{num}}个人为他点赞{{<span class="title function_">hello</span>()}}&lt;/h1&gt;</span><br></pre></td></tr></tbody></table></figure>

<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="IDE/1587746815353.png" alt="1587746815353" style="zoom: 67%;">

<h3 id="3、事件处理"><a href="#3、事件处理" class="headerlink" title="3、事件处理"></a>3、事件处理</h3><p>v-xx：指令<br>1、创建vue实例，关联页面的模板，将自己的数据（data）渲染到关联的模板，响应式的<br>2、指令来简化对dom的一些操作。<br>3、声明方法来做更复杂的操作。methods里面可以封装方法。</p>
<p>v-on是按钮的单击事件：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">&lt;button v-on:click="num++"&gt;点赞&lt;/button&gt;</span><br></pre></td></tr></tbody></table></figure>





<p>在VUE中el,data和vue的作用:</p>
<ul>
<li>el：用来绑定数据；</li>
<li>data:用来封装数据；</li>
<li>methods：用来封装方法，并且能够封装多个方法，如何上面封装了cancell和hello方法。</li>
</ul>
<p>安装“Vue 2 Snippets”，用来做代码提示</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/1587747283279.png" alt="1587747283279"></p>
<p>为了方便的在浏览器上调试VUE程序，需要安装“<a target="_blank" rel="noopener" href="https://github.com/vuejs/vue-devtools">vue-devtools</a>”，编译后安装到chrome中即可。</p>
<p>详细的使用方法见：<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/63f09651724c">Vue调试神器vue-devtools安装</a></p>
<p>“v-html”不会对于HTML标签进行转义，而是直接在浏览器上显示data所设置的内容;而“ v-text”会对html标签进行转义</p>
<figure class="highlight javascript"><table><tbody><tr><td class="code"><pre><span class="line"> &lt;div id=<span class="string">"app"</span>&gt;</span><br><span class="line">    {{msg}}  {{<span class="number">1</span>+<span class="number">1</span>}}  {{<span class="title function_">hello</span>()}}&lt;br/&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">span</span> <span class="attr">v-html</span>=<span class="string">"msg"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span></span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">span</span> <span class="attr">v-text</span>=<span class="string">"msg"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line">&lt;/div&gt;</span><br><span class="line">   </span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"../node_modules/vue/dist/vue.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">new</span> <span class="title class_">Vue</span>({</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">el</span>:<span class="string">"#app"</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">data</span>:{</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="attr">msg</span>:<span class="string">"&lt;h1&gt;Hello&lt;/h1&gt;"</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="attr">link</span>:<span class="string">"http://www.baidu.com"</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        },</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">methods</span>:{</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="title function_">hello</span>(<span class="params"></span>){</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="keyword">return</span> <span class="string">"World"</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            }</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        }</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    })</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></tbody></table></figure>

<p>运行结果：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/1587748494597.png" alt="1587748494597"></p>
    :称为差值表达式，它必须要写在Html表达式，可以完成数学运算和方法调用



<h3 id="4、v-bind-单向绑定"><a href="#4、v-bind-单向绑定" class="headerlink" title="4、v-bind :单向绑定"></a>4、v-bind :单向绑定</h3><p>给html标签的属性绑定</p>
<figure class="highlight javascript"><table><tbody><tr><td class="code"><pre><span class="line">&lt;!-- 给html标签的属性绑定 --&gt;</span><br><span class="line">   <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span> </span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">       <span class="tag">&lt;<span class="name">a</span> <span class="attr">v-bind:href</span>=<span class="string">"link"</span>&gt;</span>gogogo<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">       <span class="comment">&lt;!-- class,style  {class名：加上？}--&gt;</span></span></span><br><span class="line"><span class="language-xml">       <span class="tag">&lt;<span class="name">span</span> <span class="attr">v-bind:class</span>=<span class="string">"{active:isActive,'text-danger':hasError}"</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">         <span class="attr">:style</span>=<span class="string">"{color: color1,fontSize: size}"</span>&gt;</span>你好<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">   <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line">   <span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"../node_modules/vue/dist/vue.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line">   <span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">       <span class="keyword">let</span> vm = <span class="keyword">new</span> <span class="title class_">Vue</span>({</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">           <span class="attr">el</span>:<span class="string">"#app"</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">           <span class="attr">data</span>:{</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">               <span class="attr">link</span>: <span class="string">"http://www.baidu.com"</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">               <span class="attr">isActive</span>:<span class="literal">true</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">               <span class="attr">hasError</span>:<span class="literal">true</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">               <span class="attr">color1</span>:<span class="string">'red'</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">               <span class="attr">size</span>:<span class="string">'36px'</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">           }</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">       })</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">   </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></tbody></table></figure>

<p>上面所完成的任务就是给a标签绑定一个超链接。并且当“isActive”和“hasError”都是true的时候，将属性动态的绑定到，则绑定该“active”和 “text-danger”class。这样可以动态的调整属性的存在。</p>
<p>而且如果想要实现修改vm的”color1”和“size”， span元素的style也能够随之变化，则可以写作v-bind:style，也可以省略v-bind。</p>
<h3 id="5、v-model双向绑定"><a href="#5、v-model双向绑定" class="headerlink" title="5、v-model双向绑定"></a>5、v-model双向绑定</h3><figure class="highlight html"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"ie=edge"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 表单项，自定义组件 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        精通的语言：</span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">v-model</span>=<span class="string">"language"</span> <span class="attr">value</span>=<span class="string">"Java"</span>&gt;</span> java<span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">v-model</span>=<span class="string">"language"</span> <span class="attr">value</span>=<span class="string">"PHP"</span>&gt;</span> PHP<span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">v-model</span>=<span class="string">"language"</span> <span class="attr">value</span>=<span class="string">"Python"</span>&gt;</span> Python<span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">        选中了 {{language.join(",")}}</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"../node_modules/vue/dist/vue.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> vm = <span class="keyword">new</span> <span class="title class_">Vue</span>({</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">el</span>:<span class="string">"#app"</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">data</span>:{</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">language</span>: []</span></span><br><span class="line"><span class="language-javascript">            }</span></span><br><span class="line"><span class="language-javascript">        })</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>上面完成的功能就是通过“v-model”为输入框绑定多个值，能够实现选中的值，在data的language也在不断的发生着变化，</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/image-20200425090955705.png" alt="image-20200425090955705"></p>
<p>如果在控制台上指定vm.language=[“Java”,”PHP”]，则data值也会跟着变化。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/image-20200425091736505.png" alt="image-20200425091736505"></p>
<blockquote>
<p>通过“v-model”实现了页面发生了变化，则数据也发生变化，数据发生变化，则页面也发生变化，这样就实现了双向绑定。<br>数组的连接操作： 选中了 <code>{{language.join(",")}}</code></p>
</blockquote>
<h3 id="6、v-on为按钮绑定事件"><a href="#6、v-on为按钮绑定事件" class="headerlink" title="6、v-on为按钮绑定事件"></a>6、v-on为按钮绑定事件</h3><figure class="highlight js"><table><tbody><tr><td class="code"><pre><span class="line">&lt;!--事件中直接写js片段--&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">v-on:click</span>=<span class="string">"num++"</span>&gt;</span>点赞<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">&lt;!--事件指定一个回调函数，必须是<span class="title class_">Vue</span>实例中定义的函数--&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">"cancle"</span>&gt;</span>取消<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br></pre></td></tr></tbody></table></figure>

<p>上面是为两个按钮绑定了单击事件，其中一个对于num进行自增，另外一个自减。</p>
<p>v-on:click也可以写作@click</p>
<p>事件的冒泡：</p>
<figure class="highlight html"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 事件修饰符 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"border: 1px solid red;padding: 20px;"</span> <span class="attr">v-on:click</span>=<span class="string">"hello"</span>&gt;</span></span><br><span class="line">    大div</span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"border: 1px solid blue;padding: 20px;"</span> @<span class="attr">click</span>=<span class="string">"hello"</span>&gt;</span></span><br><span class="line">        小div <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"http://www.baidu.com"</span> @<span class="attr">click.prevent</span>=<span class="string">"hello"</span>&gt;</span>去百度<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>上面的这两个嵌套div中，如果点击了内层的div，则外层的div也会被触发；这种问题可以事件修饰符来完成：</p>
<figure class="highlight html"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 事件修饰符 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"border: 1px solid red;padding: 20px;"</span> <span class="attr">v-on:click.once</span>=<span class="string">"hello"</span>&gt;</span></span><br><span class="line">    大div</span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"border: 1px solid blue;padding: 20px;"</span> @<span class="attr">click.stop</span>=<span class="string">"hello"</span>&gt;</span></span><br><span class="line">        小div <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"http://www.baidu.com"</span> @<span class="attr">click.prevent.stop</span>=<span class="string">"hello"</span>&gt;</span>去百度<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--这里禁止了超链接的点击跳转操作，并且只会触发当前对象的操作--&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>关于事件修饰符：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/image-20200425094010008.png" alt="image-20200425094010008"></p>
<p>按键修饰符：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/image-20200425094247167.png" alt="image-20200425094247167"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/image-20200425100629676.png" alt="image-20200425100629676"></p>
<h3 id="7、v-for遍历循环"><a href="#7、v-for遍历循环" class="headerlink" title="7、v-for遍历循环"></a>7、v-for遍历循环</h3><figure class="highlight html"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"ie=edge"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">"(user,index) in users"</span> <span class="attr">:key</span>=<span class="string">"user.name"</span> <span class="attr">v-if</span>=<span class="string">"user.gender == '女'"</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 1、显示user信息：v-for="item in items" --&gt;</span></span><br><span class="line">               当前索引：{{index}} ==&gt; {{user.name}}  ==&gt;   {{user.gender}} ==&gt;{{user.age}} <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 2、获取数组下标：v-for="(item,index) in items" --&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 3、遍历对象：</span></span><br><span class="line"><span class="comment">                        v-for="value in object"</span></span><br><span class="line"><span class="comment">                        v-for="(value,key) in object"</span></span><br><span class="line"><span class="comment">                        v-for="(value,key,index) in object" </span></span><br><span class="line"><span class="comment">                --&gt;</span></span><br><span class="line">                对象信息：</span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">v-for</span>=<span class="string">"(v,k,i) in user"</span>&gt;</span>{{k}}=={{v}}=={{i}}；<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 4、遍历的时候都加上:key来区分不同数据，提高vue渲染效率 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            </span><br><span class="line">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">"(num,index) in nums"</span> <span class="attr">:key</span>=<span class="string">"index"</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"../node_modules/vue/dist/vue.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> app = <span class="keyword">new</span> <span class="title class_">Vue</span>({</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">el</span>: <span class="string">"#app"</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">data</span>: {</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">users</span>: [{ <span class="attr">name</span>: <span class="string">'柳岩'</span>, <span class="attr">gender</span>: <span class="string">'女'</span>, <span class="attr">age</span>: <span class="number">21</span> },</span></span><br><span class="line"><span class="language-javascript">                { <span class="attr">name</span>: <span class="string">'张三'</span>, <span class="attr">gender</span>: <span class="string">'男'</span>, <span class="attr">age</span>: <span class="number">18</span> },</span></span><br><span class="line"><span class="language-javascript">                { <span class="attr">name</span>: <span class="string">'范冰冰'</span>, <span class="attr">gender</span>: <span class="string">'女'</span>, <span class="attr">age</span>: <span class="number">24</span> },</span></span><br><span class="line"><span class="language-javascript">                { <span class="attr">name</span>: <span class="string">'刘亦菲'</span>, <span class="attr">gender</span>: <span class="string">'女'</span>, <span class="attr">age</span>: <span class="number">18</span> },</span></span><br><span class="line"><span class="language-javascript">                { <span class="attr">name</span>: <span class="string">'古力娜扎'</span>, <span class="attr">gender</span>: <span class="string">'女'</span>, <span class="attr">age</span>: <span class="number">25</span> }],</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">nums</span>: [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">4</span>]</span></span><br><span class="line"><span class="language-javascript">            },</span></span><br><span class="line"><span class="language-javascript">        })</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>4、遍历的时候都加上:key来区分不同数据，提高vue渲染效率</p>
<h3 id="过滤器"><a href="#过滤器" class="headerlink" title="过滤器"></a>过滤器</h3><figure class="highlight html"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"ie=edge"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 过滤器常用来处理文本格式化的操作。过滤器可以用在两个地方：双花括号插值和 v-bind 表达式 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">"user in userList"</span>&gt;</span></span><br><span class="line">                {{user.id}} ==&gt; {{user.name}} ==&gt; {{user.gender == 1?"男":"女"}} ==&gt;</span><br><span class="line">                {{user.gender | genderFilter}} ==&gt; {{user.gender | gFilter}}</span><br><span class="line">                <span class="comment">&lt;!-- 这里的"|"表示的管道，将user.gender的值交给genderFilter --&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"../node_modules/vue/dist/vue.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 全局过滤器 </span></span></span><br><span class="line"><span class="language-javascript">        <span class="title class_">Vue</span>.<span class="title function_">filter</span>(<span class="string">"gFilter"</span>, <span class="keyword">function</span> (<span class="params">val</span>) {</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span> (val == <span class="number">1</span>) {</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">return</span> <span class="string">"男~~~"</span>;</span></span><br><span class="line"><span class="language-javascript">            } <span class="keyword">else</span> {</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">return</span> <span class="string">"女~~~"</span>;</span></span><br><span class="line"><span class="language-javascript">            }</span></span><br><span class="line"><span class="language-javascript">        })</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> vm = <span class="keyword">new</span> <span class="title class_">Vue</span>({</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">el</span>: <span class="string">"#app"</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">data</span>: {</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">userList</span>: [</span></span><br><span class="line"><span class="language-javascript">                    { <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">name</span>: <span class="string">'jacky'</span>, <span class="attr">gender</span>: <span class="number">1</span> },</span></span><br><span class="line"><span class="language-javascript">                    { <span class="attr">id</span>: <span class="number">2</span>, <span class="attr">name</span>: <span class="string">'peter'</span>, <span class="attr">gender</span>: <span class="number">0</span> }</span></span><br><span class="line"><span class="language-javascript">                ]</span></span><br><span class="line"><span class="language-javascript">            },</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">filters</span>: {</span></span><br><span class="line"><span class="language-javascript">                <span class="comment">////&nbsp;filters&nbsp;定义局部过滤器，只可以在当前vue实例中使用</span></span></span><br><span class="line"><span class="language-javascript">                <span class="title function_">genderFilter</span>(<span class="params">val</span>) {</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">if</span> (val == <span class="number">1</span>) {</span></span><br><span class="line"><span class="language-javascript">                        <span class="keyword">return</span> <span class="string">"男"</span>;</span></span><br><span class="line"><span class="language-javascript">                    } <span class="keyword">else</span> {</span></span><br><span class="line"><span class="language-javascript">                        <span class="keyword">return</span> <span class="string">"女"</span>;</span></span><br><span class="line"><span class="language-javascript">                    }</span></span><br><span class="line"><span class="language-javascript">                }</span></span><br><span class="line"><span class="language-javascript">            }</span></span><br><span class="line"><span class="language-javascript">        })</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>



<h3 id="组件化"><a href="#组件化" class="headerlink" title="组件化"></a>组件化</h3><figure class="highlight html"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"ie=edge"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">v-on:click</span>=<span class="string">"count++"</span>&gt;</span>我被点击了 {{count}} 次<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">counter</span>&gt;</span><span class="tag">&lt;/<span class="name">counter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">counter</span>&gt;</span><span class="tag">&lt;/<span class="name">counter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">counter</span>&gt;</span><span class="tag">&lt;/<span class="name">counter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">counter</span>&gt;</span><span class="tag">&lt;/<span class="name">counter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">counter</span>&gt;</span><span class="tag">&lt;/<span class="name">counter</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 使用所定义的组件button-counter --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button-counter</span>&gt;</span><span class="tag">&lt;/<span class="name">button-counter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"../node_modules/vue/dist/vue.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">//1、全局声明注册一个组件</span></span></span><br><span class="line"><span class="language-javascript">        <span class="title class_">Vue</span>.<span class="title function_">component</span>(<span class="string">"counter"</span>, {</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">template</span>: <span class="string">`&lt;button v-on:click="count++"&gt;我被点击了 {{count}} 次&lt;/button&gt;`</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">data</span>(<span class="params"></span>) {</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">return</span> {</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">count</span>: <span class="number">1</span></span></span><br><span class="line"><span class="language-javascript">                }</span></span><br><span class="line"><span class="language-javascript">            }</span></span><br><span class="line"><span class="language-javascript">        });</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">//2、局部声明一个组件</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> buttonCounter = {</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">template</span>: <span class="string">`&lt;button v-on:click="count++"&gt;我被点击了 {{count}} 次~~~&lt;/button&gt;`</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">data</span>(<span class="params"></span>) {</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">return</span> {</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">count</span>: <span class="number">1</span></span></span><br><span class="line"><span class="language-javascript">                }</span></span><br><span class="line"><span class="language-javascript">            }</span></span><br><span class="line"><span class="language-javascript">        };</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">new</span> <span class="title class_">Vue</span>({</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">el</span>: <span class="string">"#app"</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">data</span>: {</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">count</span>: <span class="number">1</span></span></span><br><span class="line"><span class="language-javascript">            },</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">components</span>: {</span></span><br><span class="line"><span class="language-javascript">                <span class="comment">//声明所定义的局部组件</span></span></span><br><span class="line"><span class="language-javascript">                <span class="string">'button-counter'</span>: buttonCounter</span></span><br><span class="line"><span class="language-javascript">            }</span></span><br><span class="line"><span class="language-javascript">        })</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>



<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/image-20200425110048496.png" alt="image-20200425110048496"></p>
<h3 id="生命周期钩子函数"><a href="#生命周期钩子函数" class="headerlink" title="生命周期钩子函数"></a>生命周期钩子函数</h3><figure class="highlight html"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"ie=edge"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">"num"</span>&gt;</span>{{num}}<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">"num++"</span>&gt;</span>赞！<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h2</span>&gt;</span>{{name}}，有{{num}}个人点赞<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"../node_modules/vue/dist/vue.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> app = <span class="keyword">new</span> <span class="title class_">Vue</span>({</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">el</span>: <span class="string">"#app"</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">data</span>: {</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">name</span>: <span class="string">"张三"</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">num</span>: <span class="number">100</span></span></span><br><span class="line"><span class="language-javascript">            },</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">methods</span>: {</span></span><br><span class="line"><span class="language-javascript">                <span class="title function_">show</span>(<span class="params"></span>) {</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">name</span>;</span></span><br><span class="line"><span class="language-javascript">                },</span></span><br><span class="line"><span class="language-javascript">                <span class="title function_">add</span>(<span class="params"></span>) {</span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">this</span>.<span class="property">num</span>++;</span></span><br><span class="line"><span class="language-javascript">                }</span></span><br><span class="line"><span class="language-javascript">            },</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">beforeCreate</span>(<span class="params"></span>) {</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">"=========beforeCreate============="</span>);</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">"数据模型未加载："</span> + <span class="variable language_">this</span>.<span class="property">name</span>, <span class="variable language_">this</span>.<span class="property">num</span>);</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">"方法未加载："</span> + <span class="variable language_">this</span>.<span class="title function_">show</span>());</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">"html模板未加载："</span> + <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">"num"</span>));</span></span><br><span class="line"><span class="language-javascript">            },</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">created</span>: <span class="keyword">function</span> (<span class="params"></span>) {</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">"=========created============="</span>);</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">"数据模型已加载："</span> + <span class="variable language_">this</span>.<span class="property">name</span>, <span class="variable language_">this</span>.<span class="property">num</span>);</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">"方法已加载："</span> + <span class="variable language_">this</span>.<span class="title function_">show</span>());</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">"html模板已加载："</span> + <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">"num"</span>));</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">"html模板未渲染："</span> + <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">"num"</span>).<span class="property">innerText</span>);</span></span><br><span class="line"><span class="language-javascript">            },</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">beforeMount</span>(<span class="params"></span>) {</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">"=========beforeMount============="</span>);</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">"html模板未渲染："</span> + <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">"num"</span>).<span class="property">innerText</span>);</span></span><br><span class="line"><span class="language-javascript">            },</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">mounted</span>(<span class="params"></span>) {</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">"=========mounted============="</span>);</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">"html模板已渲染："</span> + <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">"num"</span>).<span class="property">innerText</span>);</span></span><br><span class="line"><span class="language-javascript">            },</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">beforeUpdate</span>(<span class="params"></span>) {</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">"=========beforeUpdate============="</span>);</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">"数据模型已更新："</span> + <span class="variable language_">this</span>.<span class="property">num</span>);</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">"html模板未更新："</span> + <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">"num"</span>).<span class="property">innerText</span>);</span></span><br><span class="line"><span class="language-javascript">            },</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">updated</span>(<span class="params"></span>) {</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">"=========updated============="</span>);</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">"数据模型已更新："</span> + <span class="variable language_">this</span>.<span class="property">num</span>);</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">"html模板已更新："</span> + <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">"num"</span>).<span class="property">innerText</span>);</span></span><br><span class="line"><span class="language-javascript">            }</span></span><br><span class="line"><span class="language-javascript">        });</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>



<h2 id="13-element-ui"><a href="#13-element-ui" class="headerlink" title="13. element ui"></a>13. element ui</h2><p>官网： <a target="_blank" rel="noopener" href="https://element.eleme.cn/#/zh-CN/component/installation">https://element.eleme.cn/#/zh-CN/component/installation</a> </p>
<p>安装</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">npm i element-ui -S</span><br></pre></td></tr></tbody></table></figure>

<h3 id=""><a href="#" class="headerlink" title=""></a></h3><p> 在 main.js 中写入以下内容： </p>
<figure class="highlight js"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">ElementUI</span>  <span class="keyword">from</span> <span class="string">'element-ui'</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">'element-ui/lib/theme-chalk/index.css'</span>;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">ElementUI</span>);</span><br></pre></td></tr></tbody></table></figure>


<h2 id="14-递归树形结构获取数据"><a href="#14-递归树形结构获取数据" class="headerlink" title="14. 递归树形结构获取数据"></a>14. 递归树形结构获取数据</h2><p>在注册中心中“product”命名空间中，创建“gulimall-product.yml”配置文件：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/image-20200425153735737.png" alt="image-20200425153735737"></p>
<p>将“application.yml”内容拷贝到该配置文件中</p>
<figure class="highlight yaml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">10000</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="comment">#MySQL配置</span></span><br><span class="line">    <span class="attr">driverClassName:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://192.168.137.14:3306/gulimall_pms?useUnicode=true&amp;characterEncoding=UTF-8&amp;useSSL=false</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">root</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">gulimall-product</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="number">192.168</span><span class="number">.137</span><span class="number">.14</span><span class="string">:8848</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="attr">global-config:</span></span><br><span class="line">    <span class="attr">db-config:</span></span><br><span class="line">      <span class="attr">id-type:</span> <span class="string">auto</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:/mapper/**/*.xml</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>在本地创建“bootstrap.properties”文件，指明配置中心的位置和使用到的配置文件：</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">spring.application.name=gulimall-product</span><br><span class="line">spring.cloud.nacos.config.server-addr=192.168.137.14:8848</span><br><span class="line">spring.cloud.nacos.config.namespace=3c50ffaa-010b-4b59-9372-902e35059232</span><br><span class="line">spring.cloud.nacos.config.extension-configs[0].data-id=gulimall-product.yml</span><br><span class="line">spring.cloud.nacos.config.extension-configs[0].group=DEFAULT_GROUP</span><br><span class="line">spring.cloud.nacos.config.extension-configs[0].refresh=<span class="literal">true</span></span><br></pre></td></tr></tbody></table></figure>

<p>然后启动gulimall-product，查看到该服务已经出现在了nacos的注册中心中了</p>
<p>修改“com.bigdata.gulimall.product.service.CategoryService”类，添加如下代码：</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 列表</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RequestMapping("/list/tree")</span></span><br><span class="line"><span class="keyword">public</span> List&lt;CategoryEntity&gt; <span class="title function_">list</span><span class="params">()</span>{</span><br><span class="line">    List&lt;CategoryEntity&gt; categoryEntities = categoryService.listWithTree();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> categoryEntities;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>测试：<a target="_blank" rel="noopener" href="http://localhost:10000/product/category/list/tree">http://localhost:10000/product/category/list/tree</a></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/image-20200425154348716.png" alt="image-20200425154348716"></p>
<p>如何区别是哪种分类级别？</p>
<p>答：可以通过分类的parent_cid来进行判断，如果是一级分类，其值为0.</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 列表</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RequestMapping("/list/tree")</span></span><br><span class="line"><span class="keyword">public</span> List&lt;CategoryEntity&gt; <span class="title function_">list</span><span class="params">()</span>{</span><br><span class="line">    List&lt;CategoryEntity&gt; categoryEntities = categoryService.listWithTree();</span><br><span class="line">    <span class="comment">//找到所有的一级分类</span></span><br><span class="line">    List&lt;CategoryEntity&gt; level1Menus = categoryEntities.stream()</span><br><span class="line">            .filter(item -&gt; item.getParentCid() == <span class="number">0</span>)</span><br><span class="line">            .map(menu-&gt;{</span><br><span class="line">                menu.setChildCategoryEntity(getChildrens(menu,categoryEntities));</span><br><span class="line">                <span class="keyword">return</span> menu;</span><br><span class="line">            })</span><br><span class="line">            .sorted((menu1, menu2) -&gt; {</span><br><span class="line"></span><br><span class="line">              <span class="keyword">return</span> (menu1.getSort() ==<span class="literal">null</span> ? <span class="number">0</span>:menu1.getSort())- (menu2.getSort()==<span class="literal">null</span>?<span class="number">0</span>:menu2.getSort());</span><br><span class="line"></span><br><span class="line">            })</span><br><span class="line">            .collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> level1Menus;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> List&lt;CategoryEntity&gt; <span class="title function_">getChildrens</span><span class="params">(CategoryEntity root,List&lt;CategoryEntity&gt; all)</span>{</span><br><span class="line"></span><br><span class="line">    List&lt;CategoryEntity&gt; childrens = all.stream().filter(item -&gt; {</span><br><span class="line">        <span class="keyword">return</span> item.getParentCid() == root.getCatId();</span><br><span class="line">    }).map(item -&gt; {</span><br><span class="line">        item.setChildCategoryEntity(getChildrens(item, all));</span><br><span class="line">        <span class="keyword">return</span> item;</span><br><span class="line">    }).sorted((menu1, menu2) -&gt; {</span><br><span class="line">        <span class="keyword">return</span> (menu1.getSort() ==<span class="literal">null</span> ? <span class="number">0</span>:menu1.getSort())- (menu2.getSort()==<span class="literal">null</span>?<span class="number">0</span>:menu2.getSort());</span><br><span class="line">    }).collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> childrens;</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>



<p>下面是得到的部分JSON数据</p>
<figure class="highlight json"><table><tbody><tr><td class="code"><pre><span class="line"><span class="punctuation">[</span></span><br><span class="line">  <span class="punctuation">{</span></span><br><span class="line">    <span class="attr">"catId"</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"name"</span><span class="punctuation">:</span> <span class="string">"图书、音像、电子书刊"</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"parentCid"</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"catLevel"</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"showStatus"</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"sort"</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"icon"</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"productUnit"</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"productCount"</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"childCategoryEntity"</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="punctuation">{</span></span><br><span class="line">        <span class="attr">"catId"</span><span class="punctuation">:</span> <span class="number">22</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">"name"</span><span class="punctuation">:</span> <span class="string">"电子书刊"</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">"parentCid"</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">"catLevel"</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">"showStatus"</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">"sort"</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">"icon"</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">"productUnit"</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">"productCount"</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">"childCategoryEntity"</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">          <span class="punctuation">{</span></span><br><span class="line">            <span class="attr">"catId"</span><span class="punctuation">:</span> <span class="number">165</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"name"</span><span class="punctuation">:</span> <span class="string">"电子书"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"parentCid"</span><span class="punctuation">:</span> <span class="number">22</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"catLevel"</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"showStatus"</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"sort"</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"icon"</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"productUnit"</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"productCount"</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"childCategoryEntity"</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span></span><br><span class="line">          <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">          <span class="punctuation">{</span></span><br><span class="line">            <span class="attr">"catId"</span><span class="punctuation">:</span> <span class="number">166</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"name"</span><span class="punctuation">:</span> <span class="string">"网络原创"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"parentCid"</span><span class="punctuation">:</span> <span class="number">22</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"catLevel"</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"showStatus"</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"sort"</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"icon"</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"productUnit"</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"productCount"</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"childCategoryEntity"</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span></span><br><span class="line">          <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">          <span class="punctuation">{</span></span><br><span class="line">            <span class="attr">"catId"</span><span class="punctuation">:</span> <span class="number">167</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"name"</span><span class="punctuation">:</span> <span class="string">"数字杂志"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"parentCid"</span><span class="punctuation">:</span> <span class="number">22</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"catLevel"</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"showStatus"</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"sort"</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"icon"</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"productUnit"</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"productCount"</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"childCategoryEntity"</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span></span><br><span class="line">          <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">          <span class="punctuation">{</span></span><br><span class="line">            <span class="attr">"catId"</span><span class="punctuation">:</span> <span class="number">168</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"name"</span><span class="punctuation">:</span> <span class="string">"多媒体图书"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"parentCid"</span><span class="punctuation">:</span> <span class="number">22</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"catLevel"</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"showStatus"</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"sort"</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"icon"</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"productUnit"</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"productCount"</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"childCategoryEntity"</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span></span><br><span class="line">          <span class="punctuation">}</span></span><br><span class="line">        <span class="punctuation">]</span></span><br><span class="line">      <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">{</span></span><br><span class="line">        <span class="attr">"catId"</span><span class="punctuation">:</span> <span class="number">23</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">"name"</span><span class="punctuation">:</span> <span class="string">"音像"</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">"parentCid"</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">"catLevel"</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">"showStatus"</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">"sort"</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">"icon"</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">"productUnit"</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">"productCount"</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">"childCategoryEntity"</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">          <span class="punctuation">{</span></span><br><span class="line">            <span class="attr">"catId"</span><span class="punctuation">:</span> <span class="number">169</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"name"</span><span class="punctuation">:</span> <span class="string">"音乐"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"parentCid"</span><span class="punctuation">:</span> <span class="number">23</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"catLevel"</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"showStatus"</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"sort"</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"icon"</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"productUnit"</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"productCount"</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"childCategoryEntity"</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span></span><br><span class="line">          <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">          <span class="punctuation">{</span></span><br><span class="line">            <span class="attr">"catId"</span><span class="punctuation">:</span> <span class="number">170</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"name"</span><span class="punctuation">:</span> <span class="string">"影视"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"parentCid"</span><span class="punctuation">:</span> <span class="number">23</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"catLevel"</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"showStatus"</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"sort"</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"icon"</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"productUnit"</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"productCount"</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"childCategoryEntity"</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span></span><br><span class="line">          <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">          <span class="punctuation">{</span></span><br><span class="line">            <span class="attr">"catId"</span><span class="punctuation">:</span> <span class="number">171</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"name"</span><span class="punctuation">:</span> <span class="string">"教育音像"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"parentCid"</span><span class="punctuation">:</span> <span class="number">23</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"catLevel"</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"showStatus"</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"sort"</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"icon"</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"productUnit"</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"productCount"</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"childCategoryEntity"</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span></span><br><span class="line">          <span class="punctuation">}</span></span><br><span class="line">        <span class="punctuation">]</span></span><br><span class="line">      <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">{</span></span><br></pre></td></tr></tbody></table></figure>



<p>启动后端项目renren-fast</p>
<p>启动前端项目renren-fast-vue：</p>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">npm run dev</span><br></pre></td></tr></tbody></table></figure>



<p>访问： <a target="_blank" rel="noopener" href="http://localhost:8001/#/login">http://localhost:8001/#/login</a> </p>
<p>创建一级菜单：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/image-20200425164019287.png" alt="image-20200425164019287"></p>
<p>创建完成后，在后台的管理系统中会创建一条记录：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/image-20200425164201813.png" alt="image-20200425164201813"></p>
<p>然后创建子菜单：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/image-20200425164509143.png" alt="image-20200425164509143"></p>
<p>创建renren-fast-vue\src\views\modules\product目录，子所以是这样来创建，是因为product/category，对应于product-category</p>
<p>在该目录下，新建“category.vue”文件：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>刷新页面出现404异常，查看请求发现，请求的是“<a target="_blank" rel="noopener" href="http://localhost:8080/renren-fast/product/category/list/tree%E2%80%9D">http://localhost:8080/renren-fast/product/category/list/tree”</a></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/image-20200425173615149.png" alt="image-20200425173615149"></p>
<p>这个请求是不正确的，正确的请求是：<a target="_blank" rel="noopener" href="http://localhost:10000/product/category/list/tree%EF%BC%8C">http://localhost:10000/product/category/list/tree，</a></p>
<p>修正这个问题：</p>
<p>替换“static\config\index.js”文件中的“window.SITE_CONFIG[‘baseUrl’]”</p>
<p>替换前：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">window.SITE_CONFIG['baseUrl'] = 'http://localhost:8080/renren-fast';</span><br></pre></td></tr></tbody></table></figure>

<p>替换后：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">window.SITE_CONFIG['baseUrl'] = 'http://localhost:88/api';</span><br></pre></td></tr></tbody></table></figure>

<p><a href="http://localhost:88，这个地址是我们网关微服务的接口。">http://localhost:88，这个地址是我们网关微服务的接口。</a></p>
<p>这里我们需要通过网关来完成路径的映射，因此将renren-fast注册到nacos注册中心中，并添加配置中心</p>
<figure class="highlight yaml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">renren-fast</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="number">192.168</span><span class="number">.137</span><span class="number">.14</span><span class="string">:8848</span></span><br><span class="line"></span><br><span class="line">      <span class="attr">config:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">renren-fast</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="number">192.168</span><span class="number">.137</span><span class="number">.8848</span></span><br><span class="line">        <span class="attr">namespace:</span> <span class="string">ee409c3f-3206-4a3b-ba65-7376922a886d</span></span><br></pre></td></tr></tbody></table></figure>



<p>配置网关路由，前台的所有请求都是经由“<a target="_blank" rel="noopener" href="http://localhost:88/api%E2%80%9D%E6%9D%A5%E8%BD%AC%E5%8F%91%E7%9A%84%EF%BC%8C%E5%9C%A8%E2%80%9Cgulimall-gateway%E2%80%9D%E4%B8%AD%E6%B7%BB%E5%8A%A0%E8%B7%AF%E7%94%B1%E8%A7%84%E5%88%99%EF%BC%9A">http://localhost:88/api”来转发的，在“gulimall-gateway”中添加路由规则：</a></p>
<figure class="highlight yaml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">id:</span> <span class="string">admin_route</span></span><br><span class="line">  <span class="attr">uri:</span> <span class="string">lb://renren-fast</span></span><br><span class="line">  <span class="attr">predicates:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">Path=/api/**</span></span><br></pre></td></tr></tbody></table></figure>



<p>但是这样做也引入了另外的一个问题，再次访问：<a target="_blank" rel="noopener" href="http://localhost:8001/#/login%EF%BC%8C%E5%8F%91%E7%8E%B0%E9%AA%8C%E8%AF%81%E7%A0%81%E4%B8%8D%E5%86%8D%E6%98%BE%E7%A4%BA%EF%BC%9A">http://localhost:8001/#/login，发现验证码不再显示：</a></p>
<p>分析原因：</p>
<ol>
<li>现在的验证码请求路径为，<a target="_blank" rel="noopener" href="http://localhost:88/api/captcha.jpg?uuid=69c79f02-d15b-478a-8465-a07fd09001e6">http://localhost:88/api/captcha.jpg?uuid=69c79f02-d15b-478a-8465-a07fd09001e6</a></li>
<li>原始的验证码请求路径：<a target="_blank" rel="noopener" href="http://localhost:8001/renren-fast/captcha.jpg?uuid=69c79f02-d15b-478a-8465-a07fd09001e6">http://localhost:8001/renren-fast/captcha.jpg?uuid=69c79f02-d15b-478a-8465-a07fd09001e6</a></li>
</ol>
<p>在admin_route的路由规则下，在访问路径中包含了“api”，因此它会将它转发到renren-fast，网关在转发的时候，会使用网关的前缀信息，为了能够正常的取得验证码，我们需要对请求路径进行重写</p>
<p>关于请求路径重写：</p>
<p><a target="_blank" rel="noopener" href="https://cloud.spring.io/spring-cloud-static/spring-cloud-gateway/2.2.2.RELEASE/reference/html/#the-rewritepath-gatewayfilter-factory">6.16. The <code>RewritePath</code> <code>GatewayFilter</code> Factory</a></p>
<p>The <code>RewritePath</code> <code>GatewayFilter</code> factory takes a path <code>regexp</code> parameter and a <code>replacement</code> parameter. This uses Java regular expressions for a flexible way to rewrite the request path. The following listing configures a <code>RewritePath</code> <code>GatewayFilter</code>:</p>
<p>Example 41. application.yml</p>
<figure class="highlight yaml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">rewritepath_route</span></span><br><span class="line">        <span class="attr">uri:</span> <span class="string">https://example.org</span></span><br><span class="line">        <span class="attr">predicates:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">Path=/foo/**</span></span><br><span class="line">        <span class="attr">filters:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">RewritePath=/red(?&lt;segment&gt;/?.*),</span> <span class="string">$\{segment}</span></span><br></pre></td></tr></tbody></table></figure>

<p>For a request path of <code>/red/blue</code>, this sets the path to <code>/blue</code> before making the downstream request. Note that the <code>$</code> should be replaced with <code>$\</code> because of the YAML specification.</p>
<p>修改“admin_route”路由规则：</p>
<figure class="highlight yaml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">id:</span> <span class="string">admin_route</span></span><br><span class="line">  <span class="attr">uri:</span> <span class="string">lb://renren-fast</span></span><br><span class="line">  <span class="attr">predicates:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">Path=/api/**</span></span><br><span class="line">  <span class="attr">filters:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">RewritePath=/api/(?&lt;segment&gt;/?.*),</span> <span class="string">/renren-fast/$\{segment}</span></span><br></pre></td></tr></tbody></table></figure>



<p>再次访问：<a target="_blank" rel="noopener" href="http://localhost:8001/#/login%EF%BC%8C%E9%AA%8C%E8%AF%81%E7%A0%81%E8%83%BD%E5%A4%9F%E6%AD%A3%E5%B8%B8%E7%9A%84%E5%8A%A0%E8%BD%BD%E4%BA%86%E3%80%82">http://localhost:8001/#/login，验证码能够正常的加载了。</a></p>
<p>但是很不幸新的问题又产生了，访问被拒绝了</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/image-20200425192722821.png" alt="image-20200425192722821"></p>
<p> 问题描述：已拦截跨源请求：同源策略禁止读取位于 <a target="_blank" rel="noopener" href="http://localhost:88/api/sys/login">http://localhost:88/api/sys/login</a> 的远程资源。（原因：CORS 头缺少 ‘Access-Control-Allow-Origin’）。 </p>
<p>问题分析：这是一种跨域问题。访问的域名和端口和原来的请求不同，请求就会被限制</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/image-20200425192902637.png" alt="image-20200425192902637"></p>
<p>跨域流程：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/image-20200425193136641.png" alt="image-20200425193136641"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/image-20200425193523849.png" alt="image-20200425193523849"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/image-20200425193614185.png" alt="image-20200425193614185"></p>
<p>解决方法：在网关中定义“GulimallCorsConfiguration”类，该类用来做过滤，允许所有的请求跨域。</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GulimallCorsConfiguration</span> {</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> CorsWebFilter <span class="title function_">corsWebFilter</span><span class="params">()</span>{</span><br><span class="line">        UrlBasedCorsConfigurationSource source=<span class="keyword">new</span> <span class="title class_">UrlBasedCorsConfigurationSource</span>();</span><br><span class="line">        <span class="type">CorsConfiguration</span> <span class="variable">corsConfiguration</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CorsConfiguration</span>();</span><br><span class="line">        corsConfiguration.addAllowedHeader(<span class="string">"*"</span>);</span><br><span class="line">        corsConfiguration.addAllowedMethod(<span class="string">"*"</span>);</span><br><span class="line">        corsConfiguration.addAllowedOrigin(<span class="string">"*"</span>);</span><br><span class="line">        corsConfiguration.setAllowCredentials(<span class="literal">true</span>);</span><br><span class="line">        </span><br><span class="line">        source.registerCorsConfiguration(<span class="string">"/**"</span>,corsConfiguration);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CorsWebFilter</span>(source);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>



<p>再次访问：<a target="_blank" rel="noopener" href="http://localhost:8001/#/login">http://localhost:8001/#/login</a></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/image-20200425195437299.png" alt="image-20200425195437299"></p>
<p><a target="_blank" rel="noopener" href="http://localhost:8001/renre%E5%B7%B2%E6%8B%A6%E6%88%AA%E8%B7%A8%E6%BA%90%E8%AF%B7%E6%B1%82%EF%BC%9A%E5%90%8C%E6%BA%90%E7%AD%96%E7%95%A5%E7%A6%81%E6%AD%A2%E8%AF%BB%E5%8F%96%E4%BD%8D%E4%BA%8E">http://localhost:8001/renre已拦截跨源请求：同源策略禁止读取位于</a> <a target="_blank" rel="noopener" href="http://localhost:88/api/sys/login">http://localhost:88/api/sys/login</a> 的远程资源。（原因：不允许有多个 ‘Access-Control-Allow-Origin’ CORS 头）n-fast/captcha.jpg?uuid=69c79f02-d15b-478a-8465-a07fd09001e6</p>
<p>出现了多个请求，并且也存在多个跨源请求。</p>
<p>为了解决这个问题，需要修改renren-fast项目，注释掉“io.renren.config.CorsConfig”类。然后再次进行访问。</p>
<p>在显示分类信息的时候，出现了404异常，请求的<a target="_blank" rel="noopener" href="http://localhost:88/api/product/category/list/tree%E4%B8%8D%E5%AD%98%E5%9C%A8">http://localhost:88/api/product/category/list/tree不存在</a></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/image-20200425213240724.png" alt="image-20200425213240724"></p>
<p>这是因为网关上所做的路径映射不正确，映射后的路径为<a target="_blank" rel="noopener" href="http://localhost:8001/renren-fast/product/category/list/tree">http://localhost:8001/renren-fast/product/category/list/tree</a></p>
<p>但是只有通过<a target="_blank" rel="noopener" href="http://localhost:10000/product/category/list/tree%E8%B7%AF%E5%BE%84%E6%89%8D%E8%83%BD%E5%A4%9F%E6%AD%A3%E5%B8%B8%E8%AE%BF%E9%97%AE%EF%BC%8C%E6%89%80%E4%BB%A5%E4%BC%9A%E6%8A%A5404%E5%BC%82%E5%B8%B8%E3%80%82">http://localhost:10000/product/category/list/tree路径才能够正常访问，所以会报404异常。</a></p>
<p>解决方法就是定义一个product路由规则，进行路径重写：</p>
<figure class="highlight yaml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">id:</span> <span class="string">product_route</span></span><br><span class="line">  <span class="attr">uri:</span> <span class="string">lb://gulimall-product</span></span><br><span class="line">  <span class="attr">predicates:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">Path=/api/product/**</span></span><br><span class="line">  <span class="attr">filters:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">RewritePath=/api/(?&lt;segment&gt;/?.*),/$\{segment}</span></span><br></pre></td></tr></tbody></table></figure>

<p>在路由规则的顺序上，将精确的路由规则放置到模糊的路由规则的前面，否则的话，精确的路由规则将不会被匹配到，类似于异常体系中try catch子句中异常的处理顺序。</p>
<h2 id="15-删除数据"><a href="#15-删除数据" class="headerlink" title="15. 删除数据"></a>15. 删除数据</h2><p>添加delete和append标识，并且增加复选框</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">&lt;el-tree</span><br><span class="line">   :data="menus"</span><br><span class="line">   show-checkbox  //显示复选框</span><br><span class="line">   :props="defaultProps"  </span><br><span class="line">   :expand-on-click-node="false" //设置节点点击时不展开</span><br><span class="line">   node-key="catId"   </span><br><span class="line"> &gt;</span><br><span class="line">   &lt;span class="custom-tree-node" slot-scope="{ node, data }"&gt;</span><br><span class="line">     &lt;span&gt;{{ node.label }}&lt;/span&gt;</span><br><span class="line">     &lt;span&gt;</span><br><span class="line">       &lt;el-button v-if="node.level &lt;= 2" type="text" size="mini" @click="() =&gt; append(data)"&gt;Append&lt;/el-button&gt;</span><br><span class="line">       &lt;el-button</span><br><span class="line">         v-if="node.childNodes.length == 0"</span><br><span class="line">         type="text"</span><br><span class="line">         size="mini"</span><br><span class="line">         @click="() =&gt; remove(node, data)"</span><br><span class="line">       &gt;Delete&lt;/el-button&gt;</span><br><span class="line">     &lt;/span&gt;</span><br><span class="line">   &lt;/span&gt;</span><br><span class="line"> &lt;/el-tree&gt;</span><br></pre></td></tr></tbody></table></figure>



<p>测试删除数据，打开postman输入“ <a target="_blank" rel="noopener" href="http://localhost:88/api/product/category/delete">http://localhost:88/api/product/category/delete</a> ”，请求方式设置为POST，为了比对效果，可以在删除之前查询数据库的pms_category表：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/image-20200426112814069.png" alt="image-20200426112814069"></p>
<p>由于delete请求接收的是一个数组，所以这里使用JSON方式，传入了一个数组：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/image-20200426113003531.png" alt="image-20200426113003531"></p>
<p>再次查询数据库能够看到cat_id为1000的数据已经被删除了。</p>
<p>修改“com.bigdata.gulimall.product.controller.CategoryController”类，添加如下代码：</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"> <span class="meta">@RequestMapping("/delete")</span></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">delete</span><span class="params">(<span class="meta">@RequestBody</span> Long[] catIds)</span>{</span><br><span class="line">        <span class="comment">//删除之前需要判断待删除的菜单那是否被别的地方所引用。</span></span><br><span class="line"><span class="comment">//		categoryService.removeByIds(Arrays.asList(catIds));</span></span><br><span class="line"></span><br><span class="line">        categoryService.removeMenuByIds(Arrays.asList(catIds));</span><br><span class="line">        <span class="keyword">return</span> R.ok();</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>



<p>com.bigdata.gulimall.product.service.impl.CategoryServiceImpl</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span>   <span class="keyword">void</span> <span class="title function_">removeMenuByIds</span><span class="params">(List&lt;Long&gt; asList)</span> {</span><br><span class="line">    <span class="comment">//TODO 检查当前的菜单是否被别的地方所引用</span></span><br><span class="line">    categoryDao.deleteBatchIds(asList);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>



<p>然而多数时候，我们并不希望删除数据，而是标记它被删除了，这就是逻辑删除；</p>
<p>可以设置show_status为0，标记它已经被删除。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/image-20200426115332899.png" alt="image-20200426115332899"></p>
<p>mybatis-plus的逻辑删除：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/image-20200426115420393.png" alt="image-20200426115420393"></p>
<p>配置全局的逻辑删除规则，在“src/main/resources/application.yml”文件中添加如下内容：</p>
<figure class="highlight yaml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="attr">global-config:</span></span><br><span class="line">    <span class="attr">db-config:</span></span><br><span class="line">      <span class="attr">id-type:</span> <span class="string">auto</span></span><br><span class="line">      <span class="attr">logic-delete-value:</span> <span class="number">1</span></span><br><span class="line">      <span class="attr">logic-not-delete-value:</span> <span class="number">0</span></span><br></pre></td></tr></tbody></table></figure>

<p>修改“com.bigdata.gulimall.product.entity.CategoryEntity”类，添加上@TableLogic，表明使用逻辑删除：</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 是否显示[0-不显示，1显示]</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@TableLogic(value = "1",delval = "0")</span></span><br><span class="line"><span class="keyword">private</span> Integer showStatus;</span><br></pre></td></tr></tbody></table></figure>

<p>然后在POSTMan中测试一下是否能够满足需要。另外在“src/main/resources/application.yml”文件中，设置日志级别，打印出SQL语句：</p>
<figure class="highlight yaml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">level:</span></span><br><span class="line">    <span class="attr">com.bigdata.gulimall.product:</span> <span class="string">debug</span></span><br></pre></td></tr></tbody></table></figure>

<p>打印的日志：</p>
<figure class="highlight verilog"><table><tbody><tr><td class="code"><pre><span class="line">==&gt;  Preparing: UPDATE pms_category SET show_status=<span class="number">0</span> WHERE cat_id IN ( ? ) AND show_status=<span class="number">1</span> </span><br><span class="line">==&gt; Parameters: <span class="number">1431</span>(Long)</span><br><span class="line">&lt;==    Updates: <span class="number">1</span></span><br><span class="line">get changedGroupKeys:[]</span><br></pre></td></tr></tbody></table></figure>



<h2 id="16-菜单拖动"><a href="#16-菜单拖动" class="headerlink" title="16. 菜单拖动"></a>16. 菜单拖动</h2><table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>同一个菜单内拖动</td>
<td>正常</td>
</tr>
<tr>
<td>拖动到父菜单的前面或后面</td>
<td>正常</td>
</tr>
<tr>
<td>拖动到父菜单同级的另外一个菜单中</td>
<td>正常</td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>关注的焦点在于，拖动到目标节点中，使得目标节点的catlevel+deep小于3即可。拖动到目标节点前后的条件是，使得</p>
<h3 id="拖动菜单时需要修改顺序和级别"><a href="#拖动菜单时需要修改顺序和级别" class="headerlink" title="拖动菜单时需要修改顺序和级别"></a>拖动菜单时需要修改顺序和级别</h3><p>需要考虑两种类型节点的catLevel</p>
<p>一种关系是：如果是同一个节点下的子节点的前后移动，则不需要修改其catLevel</p>
<p>如果是拖动到另外一个节点内或父节点中，则要考虑修改其catLevel</p>
<p>如果拖动到与父节点平级的节点关系中，则要将该拖动的节点的catLevel，设置为兄弟节点的Level，</p>
<p>先考虑parentCid还是先考虑catLevel?</p>
<p>两种关系在耦合</p>
<p>另外还有一种是前后拖动的情况</p>
<p>哪个范围最大？</p>
<p>肯定是拖动类型关系最大，</p>
<p>如果是前后拖动，则拖动后需要看待拖动节点的层级和设置待拖动节点的parentId，</p>
<p>​       如果待拖动节点和目标节点的层级相同，则认为是同级拖动，只需要修改节点的先后顺序即可；</p>
<p>​       否则认为是跨级拖动，则需要修改层级和重新设置parentID</p>
<p>​              如果</p>
<p>​      以拖动类型来分，并不合适，比较合适的是跨级拖动和同级拖动</p>
<p>如何判断是跨级拖动还是同级拖动，根据拖动的层级来看，如果是同一级的拖动，只需要修改先后顺序即可，但是这样也会存在一个问题，就是当拖动到另外一个分组下的同级目录中，显然也需要修改parentID，究竟什么样的模型最好呢？</p>
<p>  另外也可以判断在跨级移动时，跨级后的parentID是否相同，如果不相同，则认为是在不同目录下的跨级移动需要修改parentID。</p>
<p>顺序、catLevel和parentID</p>
<p>同级移动：</p>
<p>（1）首先判断待移动节点和目标节点的catLevel是否相同，</p>
<p> （2）相同则认为是同级移动，</p>
<p>​          如果此时移动后目标节点的parentID和待移动节点的相同，但是移动类型是前后移动，只需要调整顺序即可，此时移动类型是inner，则需要修改catLevel和parentId和顺序</p>
<p>​         如果此时移动后目标节点的parentID和待移动节点的不相同，但是移动类型是前后移动，则需要调整顺序和parentId，此时移动类型是inner，则需要修改catLevel和parentId和顺序</p>
<p>通过这两步的操作能看到一些共性，如果抽取移动类型作为大的分类，则在这种分类下，</p>
<p>如果是前后移动，则分为下面几种情况：</p>
<p>​    同级别下的前后移动：界定标准为catLevel相同，但是又可以分为parentID相同和parentID不同，parent相同时，只需要修改顺序即可；parentID不同时，需要修改parentID和顺序</p>
<p>​    不同级别下的前后移动：界定标准为catLevel不同，此时无论如何都要修改parentID，顺序和catLevel</p>
<p>如果是inner类型移动，则分为一下的几种情况。</p>
<p>​     此时不论是同级inner，还是跨级innner，都需要修改parentID，顺序和catLevel</p>
<p>哪种情况需要更新子节点呢？</p>
<p>那就要看要拖拽的节点是否含有子节点，如果有子节点，则需要更新子节点的catLevel，不需要更新它之间的顺序和parentId，只需要更新catLevel即可。这种更新子节点的Level应该归类，目前的目标是只要有子节点就更新它的catLevel，</p>
<p>（2）如果待移动节点和目标节点的catLevel不同，则认为是跨级移动。如果是移动到父节点中，则需要设置catLevel，parentID和顺序。此时需要分两种情况来考虑，如果是移动到父节点中，则需要设置catLevel，parentID和顺序，如果是移动到兄弟节点中，则需要设置</p>
<p>包含移动到父节点同级目录，兄弟节点中。</p>
<h3 id="设置菜单拖动开关"><a href="#设置菜单拖动开关" class="headerlink" title="设置菜单拖动开关"></a>设置菜单拖动开关</h3><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">&lt;el-switch v-model="draggable" active-text="开启拖拽" inactive-text="关闭拖拽"&gt;&lt;/el-switch&gt;</span><br></pre></td></tr></tbody></table></figure>



<p>但是现在存在的一个问题是每次拖拽的时候，都会发送请求，更新数据库这样频繁的与数据库交互，现在想要实现一个拖拽过程中不更新数据库，拖拽完成后，统一提交拖拽后的数据。</p>
<p>现在还存在一个问题，如果是将一个菜单连续的拖拽，最终还放到了原来的位置，但是updateNode中却出现了很多节点更新信息，这样显然也是一个问题。</p>
<h3 id="批量删除"><a href="#批量删除" class="headerlink" title="批量删除"></a>批量删除</h3><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">&lt;el-button type="danger" plain size="small" @click="batchDelete"&gt;批量删除&lt;/el-button&gt;</span><br></pre></td></tr></tbody></table></figure>



<figure class="highlight javascript"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//批量删除</span></span><br><span class="line">   <span class="title function_">batchDelete</span>(<span class="params"></span>) {</span><br><span class="line">     <span class="keyword">let</span> checkNodes = <span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">menuTree</span>.<span class="title function_">getCheckedNodes</span>();</span><br><span class="line"></span><br><span class="line">     <span class="comment">//  console.log("被选中的节点：",checkNodes);</span></span><br><span class="line"></span><br><span class="line">     <span class="keyword">let</span> catIds = [];</span><br><span class="line">     <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; checkNodes.<span class="property">length</span>; i++) {</span><br><span class="line">       catIds.<span class="title function_">push</span>(checkNodes[i].<span class="property">catId</span>);</span><br><span class="line">     }</span><br><span class="line"></span><br><span class="line">     <span class="variable language_">this</span>.$confirm(<span class="string">`确定要删除?`</span>, <span class="string">"提示"</span>, {</span><br><span class="line">       <span class="attr">confirmButtonText</span>: <span class="string">"确定"</span>,</span><br><span class="line">       <span class="attr">cancelButtonText</span>: <span class="string">"取消"</span>,</span><br><span class="line">       <span class="attr">type</span>: <span class="string">"warning"</span></span><br><span class="line">     })</span><br><span class="line">       .<span class="title function_">then</span>(<span class="function">() =&gt;</span> {</span><br><span class="line">         <span class="variable language_">this</span>.$http({</span><br><span class="line">           <span class="attr">url</span>: <span class="variable language_">this</span>.<span class="property">$http</span>.<span class="title function_">adornUrl</span>(<span class="string">"/product/category/delete"</span>),</span><br><span class="line">           <span class="attr">method</span>: <span class="string">"post"</span>,</span><br><span class="line">           <span class="attr">data</span>: <span class="variable language_">this</span>.<span class="property">$http</span>.<span class="title function_">adornData</span>(catIds, <span class="literal">false</span>)</span><br><span class="line">         }).<span class="title function_">then</span>(<span class="function">(<span class="params">{ data }</span>) =&gt;</span> {</span><br><span class="line">           <span class="variable language_">this</span>.$message({</span><br><span class="line">             <span class="attr">message</span>: <span class="string">"菜单批量删除成功"</span>,</span><br><span class="line">             <span class="attr">type</span>: <span class="string">"success"</span></span><br><span class="line">           });</span><br><span class="line"></span><br><span class="line">           <span class="comment">//重新刷新页面</span></span><br><span class="line">           <span class="variable language_">this</span>.<span class="title function_">getMeus</span>();</span><br><span class="line">         });</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">       })</span><br><span class="line">       .<span class="title function_">catch</span>(<span class="function">() =&gt;</span> {</span><br><span class="line">         <span class="comment">//取消删除</span></span><br><span class="line">       });</span><br><span class="line">   },</span><br></pre></td></tr></tbody></table></figure>



<h2 id="17-品牌管理菜单"><a href="#17-品牌管理菜单" class="headerlink" title="17. 品牌管理菜单"></a>17. 品牌管理菜单</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/image-20200428164054517.png" alt="image-20200428164054517"></p>
<p>（2）将“”逆向工程得到的resources\src\views\modules\product文件拷贝到gulimall/renren-fast-vue/src/views/modules/product目录下，也就是下面的两个文件</p>
<p>brand.vue  brand-add-or-update.vue</p>
<p>但是显示的页面没有新增和删除功能，这是因为权限控制的原因，</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/image-20200428170325515.png" alt="image-20200428170325515"></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">&lt;el-button v-if="isAuth('product:brand:save')" type="primary" @click="addOrUpdateHandle()"&gt;新增&lt;/el-button&gt;</span><br><span class="line">&lt;el-button v-if="isAuth('product:brand:delete')" type="danger" @click="deleteHandle()" :disabled="dataListSelections.length &lt;= 0"&gt;批量删除&lt;/el-button&gt;</span><br><span class="line">      </span><br></pre></td></tr></tbody></table></figure>

<p>查看“isAuth”的定义位置：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/image-20200428170437592.png" alt="image-20200428170437592"></p>
<p>它是在“index.js”中定义，现在将它设置为返回值为true，即可显示添加和删除功能。</p>
<p>再次刷新页面能够看到，按钮已经出现了：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/image-20200428170644511.png" alt="image-20200428170644511"></p>
<h3 id="添加“显示状态按钮”"><a href="#添加“显示状态按钮”" class="headerlink" title="添加“显示状态按钮”"></a>添加“显示状态按钮”</h3><p>brand.vue</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">&lt;template slot-scope="scope"&gt;</span><br><span class="line">  &lt;el-switch</span><br><span class="line">    v-model="scope.row.showStatus"</span><br><span class="line">    active-color="#13ce66"</span><br><span class="line">    inactive-color="#ff4949"</span><br><span class="line">    @change="updateBrandStatus(scope.row)"</span><br><span class="line">    :active-value = "1"</span><br><span class="line">    :inactive-value	= "0"</span><br><span class="line">  &gt;&lt;/el-switch&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>brand-add-or-update.vue</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">&lt;el-form-item label="显示状态" prop="showStatus"&gt;</span><br><span class="line">   &lt;el-switch v-model="dataForm.showStatus" active-color="#13ce66" inactive-color="#ff4949"&gt;&lt;/el-switch&gt;</span><br><span class="line">&lt;/el-form-item&gt;</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight javascript"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//更新开关的状态</span></span><br><span class="line">    <span class="title function_">updateBrandStatus</span>(<span class="params">data</span>) {</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">"最新状态"</span>, data);</span><br><span class="line">      <span class="keyword">let</span> {brandId,showStatus} = data;</span><br><span class="line">      <span class="variable language_">this</span>.$http({</span><br><span class="line">        <span class="attr">url</span>: <span class="variable language_">this</span>.<span class="property">$http</span>.<span class="title function_">adornUrl</span>(<span class="string">"/product/brand/update"</span>),</span><br><span class="line">        <span class="attr">method</span>: <span class="string">"post"</span>,</span><br><span class="line">        <span class="attr">data</span>: <span class="variable language_">this</span>.<span class="property">$http</span>.<span class="title function_">adornData</span>({brandId,showStatus}, <span class="literal">false</span>)</span><br><span class="line">      }).<span class="title function_">then</span>(<span class="function">(<span class="params">{ data }</span>) =&gt;</span> {</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">this</span>.$message({</span><br><span class="line">          <span class="attr">message</span>: <span class="string">"状态更新成功"</span>,</span><br><span class="line">          <span class="attr">type</span>: <span class="string">"success"</span></span><br><span class="line">        });</span><br><span class="line"></span><br><span class="line">      });</span><br><span class="line">    },</span><br></pre></td></tr></tbody></table></figure>







<h3 id="添加上传"><a href="#添加上传" class="headerlink" title="添加上传"></a>添加上传</h3><p>和传统的单体应用不同，这里我们选择将数据上传到分布式文件服务器上。</p>
<p>这里我们选择将图片放置到阿里云上，使用对象存储。</p>
<p>阿里云上使使用对象存储方式：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/image-20200428182755992.png" alt="image-20200428182755992"></p>
<p>创建Bucket</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/image-20200428183041570.png" alt="image-20200428183041570"></p>
<p>上传文件：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/image-20200428183213694.png" alt="image-20200428183213694"></p>
<p>上传成功后，取得图片的URL</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/image-20200428183644020.png" alt="image-20200428183644020"></p>
<p>这种方式是手动上传图片，实际上我们可以在程序中设置自动上传图片到阿里云对象存储。</p>
<p>上传模型：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/image-20200428184029655.png" alt="image-20200428184029655"></p>
<p>查看阿里云关于文件上传的帮助： <a target="_blank" rel="noopener" href="https://help.aliyun.com/document_detail/32009.html?spm=a2c4g.11186623.6.768.549d59aaWuZMGJ">https://help.aliyun.com/document_detail/32009.html?spm=a2c4g.11186623.6.768.549d59aaWuZMGJ</a> </p>
<h4 id="1）添加依赖包"><a href="#1）添加依赖包" class="headerlink" title="1）添加依赖包"></a>1）添加依赖包</h4><p>在Maven项目中加入依赖项（推荐方式）</p>
<p>在 Maven 工程中使用 OSS Java SDK，只需在 pom.xml 中加入相应依赖即可。以 3.8.0 版本为例，在 <dependencies> 内加入如下内容：</dependencies></p>
<figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.aliyun.oss<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aliyun-sdk-oss<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.8.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<h4 id="2）上传文件流"><a href="#2）上传文件流" class="headerlink" title="2）上传文件流"></a>2）上传文件流</h4><p>以下代码用于上传文件流：</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// Endpoint以杭州为例，其它Region请按实际情况填写。</span></span><br><span class="line"><span class="type">String</span> <span class="variable">endpoint</span> <span class="operator">=</span> <span class="string">"http://oss-cn-hangzhou.aliyuncs.com"</span>;</span><br><span class="line"><span class="comment">// 云账号AccessKey有所有API访问权限，建议遵循阿里云安全最佳实践，创建并使用RAM子账号进行API访问或日常运维，请登录 https://ram.console.aliyun.com 创建。</span></span><br><span class="line"><span class="type">String</span> <span class="variable">accessKeyId</span> <span class="operator">=</span> <span class="string">"&lt;yourAccessKeyId&gt;"</span>;</span><br><span class="line"><span class="type">String</span> <span class="variable">accessKeySecret</span> <span class="operator">=</span> <span class="string">"&lt;yourAccessKeySecret&gt;"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建OSSClient实例。</span></span><br><span class="line"><span class="type">OSS</span> <span class="variable">ossClient</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OSSClientBuilder</span>().build(endpoint, accessKeyId, accessKeySecret);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 上传文件流。</span></span><br><span class="line"><span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">"&lt;yourlocalFile&gt;"</span>);</span><br><span class="line">ossClient.putObject(<span class="string">"&lt;yourBucketName&gt;"</span>, <span class="string">"&lt;yourObjectName&gt;"</span>, inputStream);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 关闭OSSClient。</span></span><br><span class="line">ossClient.shutdown();</span><br></pre></td></tr></tbody></table></figure>

<p>endpoint的取值：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/image-20200428190553350.png" alt="image-20200428190553350"></p>
<p>accessKeyId和accessKeySecret需要创建一个RAM账号：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/image-20200428190532924.png" alt="image-20200428190532924"></p>
<p>创建用户完毕后，会得到一个“AccessKey ID”和“AccessKeySecret”，然后复制这两个值到代码的“AccessKey ID”和“AccessKeySecret”。</p>
<p>另外还需要添加访问控制权限：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/image-20200428191518591.png" alt="image-20200428191518591"></p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testUpload</span><span class="params">()</span> <span class="keyword">throws</span> FileNotFoundException {</span><br><span class="line">        <span class="comment">// Endpoint以杭州为例，其它Region请按实际情况填写。</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">endpoint</span> <span class="operator">=</span> <span class="string">"oss-cn-shanghai.aliyuncs.com"</span>;</span><br><span class="line">        <span class="comment">// 云账号AccessKey有所有API访问权限，建议遵循阿里云安全最佳实践，创建并使用RAM子账号进行API访问或日常运维，请登录 https://ram.console.aliyun.com 创建。</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">accessKeyId</span> <span class="operator">=</span> <span class="string">"LTAI4G4W1RA4JXz2QhoDwHhi"</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">accessKeySecret</span> <span class="operator">=</span> <span class="string">"R99lmDOJumF2x43ZBKT259Qpe70Oxw"</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建OSSClient实例。</span></span><br><span class="line">        <span class="type">OSS</span> <span class="variable">ossClient</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OSSClientBuilder</span>().build(endpoint, accessKeyId, accessKeySecret);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 上传文件流。</span></span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">"C:\\Users\\Administrator\\Pictures\\timg.jpg"</span>);</span><br><span class="line">        ossClient.putObject(<span class="string">"gulimall-images"</span>, <span class="string">"time.jpg"</span>, inputStream);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 关闭OSSClient。</span></span><br><span class="line">        ossClient.shutdown();</span><br><span class="line">        System.out.println(<span class="string">"上传成功."</span>);</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>



<p>更为简单的使用方式，是使用SpringCloud Alibaba</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/image-20200428195507730.png" alt="image-20200428195507730"></p>
<p>详细使用方法，见： <a target="_blank" rel="noopener" href="https://help.aliyun.com/knowledge_detail/108650.html">https://help.aliyun.com/knowledge_detail/108650.html</a>  </p>
<p>（1）添加依赖</p>
<figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alicloud-oss<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.0.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>（2）创建“AccessKey ID”和“AccessKeySecret”</p>
<p>（3）配置key，secret和endpoint相关信息</p>
<figure class="highlight yaml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">access-key:</span> <span class="string">LTAI4G4W1RA4JXz2QhoDwHhi</span></span><br><span class="line"><span class="attr">secret-key:</span> <span class="string">R99lmDOJumF2x43ZBKT259Qpe70Oxw</span></span><br><span class="line"><span class="attr">oss:</span></span><br><span class="line">  <span class="attr">endpoint:</span> <span class="string">oss-cn-shanghai.aliyuncs.com</span></span><br></pre></td></tr></tbody></table></figure>



<p>（4）注入OSSClient并进行文件上传下载等操作</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/image-20200428224840535.png" alt="image-20200428224840535"></p>
<p>但是这样来做还是比较麻烦，如果以后的上传任务都交给gulimall-product来完成，显然耦合度高。最好单独新建一个Module来完成文件上传任务。</p>
<h3 id="其他方式"><a href="#其他方式" class="headerlink" title="其他方式"></a>其他方式</h3><h4 id="1）新建gulimall-third-party"><a href="#1）新建gulimall-third-party" class="headerlink" title="1）新建gulimall-third-party"></a>1）新建gulimall-third-party</h4><h4 id="2）添加依赖，将原来gulimall-common中的“spring-cloud-starter-alicloud-oss”依赖移动到该项目中"><a href="#2）添加依赖，将原来gulimall-common中的“spring-cloud-starter-alicloud-oss”依赖移动到该项目中" class="headerlink" title="2）添加依赖，将原来gulimall-common中的“spring-cloud-starter-alicloud-oss”依赖移动到该项目中"></a>2）添加依赖，将原来gulimall-common中的“spring-cloud-starter-alicloud-oss”依赖移动到该项目中</h4><figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alicloud-oss<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.0.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.bigdata.gulimall<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>gulimall-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p> 另外也需要在“pom.xml”文件中，添加如下的依赖管理</p>
<figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>${spring-cloud.version}<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-alibaba-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.1.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<h4 id="3）在主启动类中开启服务的注册和发现"><a href="#3）在主启动类中开启服务的注册和发现" class="headerlink" title="3）在主启动类中开启服务的注册和发现"></a>3）在主启动类中开启服务的注册和发现</h4><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br></pre></td></tr></tbody></table></figure>



<h4 id="4）在nacos中注册"><a href="#4）在nacos中注册" class="headerlink" title="4）在nacos中注册"></a>4）在nacos中注册</h4><p>（1）创建命名空间“ gulimall-third-party ”</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/image-20200429075831984.png" alt="image-20200429075831984"></p>
<p>（2）在“ gulimall-third-party”命名空间中，创建“ gulimall-third-party.yml”文件</p>
<figure class="highlight yaml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">alicloud:</span></span><br><span class="line">      <span class="attr">access-key:</span> <span class="string">LTAI4G4W1RA4JXz2QhoDwHhi</span></span><br><span class="line">      <span class="attr">secret-key:</span> <span class="string">R99lmDOJumF2x43ZBKT259Qpe70Oxw</span></span><br><span class="line">      <span class="attr">oss:</span></span><br><span class="line">        <span class="attr">endpoint:</span> <span class="string">oss-cn-shanghai.aliyuncs.com</span></span><br></pre></td></tr></tbody></table></figure>



<h4 id="5）编写配置文件"><a href="#5）编写配置文件" class="headerlink" title="5）编写配置文件"></a>5）编写配置文件</h4><p>application.yml</p>
<figure class="highlight yaml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">30000</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">gulimall-third-party</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="number">192.168</span><span class="number">.137</span><span class="number">.14</span><span class="string">:8848</span></span><br><span class="line"></span><br><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">level:</span></span><br><span class="line">    <span class="attr">com.bigdata.gulimall.product:</span> <span class="string">debug</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>



<p>bootstrap.properties</p>
<figure class="highlight properties"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">spring.cloud.nacos.config.name</span>=<span class="string">gulimall-third-party</span></span><br><span class="line"><span class="attr">spring.cloud.nacos.config.server-addr</span>=<span class="string">192.168.137.14:8848</span></span><br><span class="line"><span class="attr">spring.cloud.nacos.config.namespace</span>=<span class="string">f995d8ee-c53a-4d29-8316-a1ef54775e00</span></span><br><span class="line"><span class="attr">spring.cloud.nacos.config.extension-configs[0].data-id</span>=<span class="string">gulimall-third-party.yml</span></span><br><span class="line"><span class="attr">spring.cloud.nacos.config.extension-configs[0].group</span>=<span class="string">DEFAULT_GROUP</span></span><br><span class="line"><span class="attr">spring.cloud.nacos.config.extension-configs[0].refresh</span>=<span class="string">true</span></span><br></pre></td></tr></tbody></table></figure>



<h4 id="6）-编写测试类"><a href="#6）-编写测试类" class="headerlink" title="6） 编写测试类"></a>6） 编写测试类</h4><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.bigdata.gulimall.thirdparty;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.aliyun.oss.OSS;</span><br><span class="line"><span class="keyword">import</span> com.aliyun.oss.OSSClient;</span><br><span class="line"><span class="keyword">import</span> com.aliyun.oss.OSSClientBuilder;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.FileNotFoundException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GulimallThirdPartyApplicationTests</span> {</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    OSSClient ossClient;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testUpload</span><span class="params">()</span> <span class="keyword">throws</span> FileNotFoundException {</span><br><span class="line">        <span class="comment">// Endpoint以杭州为例，其它Region请按实际情况填写。</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">endpoint</span> <span class="operator">=</span> <span class="string">"oss-cn-shanghai.aliyuncs.com"</span>;</span><br><span class="line">        <span class="comment">// 云账号AccessKey有所有API访问权限，建议遵循阿里云安全最佳实践，创建并使用RAM子账号进行API访问或日常运维，请登录 https://ram.console.aliyun.com 创建。</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">accessKeyId</span> <span class="operator">=</span> <span class="string">"LTAI4G4W1RA4JXz2QhoDwHhi"</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">accessKeySecret</span> <span class="operator">=</span> <span class="string">"R99lmDOJumF2x43ZBKT259Qpe70Oxw"</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建OSSClient实例。</span></span><br><span class="line">        <span class="type">OSS</span> <span class="variable">ossClient</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OSSClientBuilder</span>().build(endpoint, accessKeyId, accessKeySecret);</span><br><span class="line"></span><br><span class="line">         <span class="comment">//上传文件流。</span></span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">"C:\\Users\\Administrator\\Pictures\\timg.jpg"</span>);</span><br><span class="line">        ossClient.putObject(<span class="string">"gulimall-images"</span>, <span class="string">"time3.jpg"</span>, inputStream);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 关闭OSSClient。</span></span><br><span class="line">        ossClient.shutdown();</span><br><span class="line">        System.out.println(<span class="string">"上传成功."</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>





<p> <a target="_blank" rel="noopener" href="https://help.aliyun.com/document_detail/31926.html?spm=a2c4g.11186623.6.1527.228d74b8V6IZuT">https://help.aliyun.com/document_detail/31926.html?spm=a2c4g.11186623.6.1527.228d74b8V6IZuT</a> </p>
<p><strong>背景</strong></p>
<p>采用JavaScript客户端直接签名（参见<a target="_blank" rel="noopener" href="https://help.aliyun.com/document_detail/31925.html#concept-frd-4gy-5db">JavaScript客户端签名直传</a>）时，AccessKeyID和AcessKeySecret会暴露在前端页面，因此存在严重的安全隐患。因此，OSS提供了服务端签名后直传的方案。</p>
<p><strong>原理介绍</strong></p>
<p><a target="_blank" rel="noopener" href="http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/6875011751/p1472.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/6875011751/p1472.png" alt="img"></a></p>
<p>服务端签名后直传的原理如下：</p>
<ol>
<li>用户发送上传Policy请求到应用服务器。</li>
<li>应用服务器返回上传Policy和签名给用户。</li>
<li>用户直接上传数据到OSS。</li>
</ol>
<p>编写“com.bigdata.gulimall.thirdparty.controller.OssController”类：</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.bigdata.gulimall.thirdparty.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.aliyun.oss.OSS;</span><br><span class="line"><span class="keyword">import</span> com.aliyun.oss.common.utils.BinaryUtil;</span><br><span class="line"><span class="keyword">import</span> com.aliyun.oss.model.MatchMode;</span><br><span class="line"><span class="keyword">import</span> com.aliyun.oss.model.PolicyConditions;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.LinkedHashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OssController</span> {</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    OSS ossClient;</span><br><span class="line">    <span class="meta">@Value</span> (<span class="string">"${spring.cloud.alicloud.oss.endpoint}"</span>)</span><br><span class="line">    String endpoint ;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value("${spring.cloud.alicloud.oss.bucket}")</span></span><br><span class="line">    String bucket ;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value("${spring.cloud.alicloud.access-key}")</span></span><br><span class="line">    String accessId ;</span><br><span class="line">    <span class="meta">@Value("${spring.cloud.alicloud.secret-key}")</span></span><br><span class="line">    String accessKey ;</span><br><span class="line">    <span class="meta">@RequestMapping("/oss/policy")</span></span><br><span class="line">    <span class="keyword">public</span> Map&lt;String, String&gt; <span class="title function_">policy</span><span class="params">()</span>{</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">host</span> <span class="operator">=</span> <span class="string">"https://"</span> + bucket + <span class="string">"."</span> + endpoint; <span class="comment">// host的格式为 bucketname.endpoint</span></span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">format</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">"yyyy-MM-dd"</span>).format(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">        <span class="type">String</span> <span class="variable">dir</span> <span class="operator">=</span> format; <span class="comment">// 用户上传文件时指定的前缀。</span></span><br><span class="line"></span><br><span class="line">        Map&lt;String, String&gt; respMap=<span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="type">long</span> <span class="variable">expireTime</span> <span class="operator">=</span> <span class="number">30</span>;</span><br><span class="line">            <span class="type">long</span> <span class="variable">expireEndTime</span> <span class="operator">=</span> System.currentTimeMillis() + expireTime * <span class="number">1000</span>;</span><br><span class="line">            <span class="type">Date</span> <span class="variable">expiration</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>(expireEndTime);</span><br><span class="line">            <span class="type">PolicyConditions</span> <span class="variable">policyConds</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PolicyConditions</span>();</span><br><span class="line">            policyConds.addConditionItem(PolicyConditions.COND_CONTENT_LENGTH_RANGE, <span class="number">0</span>, <span class="number">1048576000</span>);</span><br><span class="line">            policyConds.addConditionItem(MatchMode.StartWith, PolicyConditions.COND_KEY, dir);</span><br><span class="line"></span><br><span class="line">            <span class="type">String</span> <span class="variable">postPolicy</span> <span class="operator">=</span> ossClient.generatePostPolicy(expiration, policyConds);</span><br><span class="line">            <span class="type">byte</span>[] binaryData = postPolicy.getBytes(<span class="string">"utf-8"</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">encodedPolicy</span> <span class="operator">=</span> BinaryUtil.toBase64String(binaryData);</span><br><span class="line">            <span class="type">String</span> <span class="variable">postSignature</span> <span class="operator">=</span> ossClient.calculatePostSignature(postPolicy);</span><br><span class="line"></span><br><span class="line">            respMap= <span class="keyword">new</span> <span class="title class_">LinkedHashMap</span>&lt;String, String&gt;();</span><br><span class="line">            respMap.put(<span class="string">"accessid"</span>, accessId);</span><br><span class="line">            respMap.put(<span class="string">"policy"</span>, encodedPolicy);</span><br><span class="line">            respMap.put(<span class="string">"signature"</span>, postSignature);</span><br><span class="line">            respMap.put(<span class="string">"dir"</span>, dir);</span><br><span class="line">            respMap.put(<span class="string">"host"</span>, host);</span><br><span class="line">            respMap.put(<span class="string">"expire"</span>, String.valueOf(expireEndTime / <span class="number">1000</span>));</span><br><span class="line"></span><br><span class="line">        } <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">            <span class="comment">// Assert.fail(e.getMessage());</span></span><br><span class="line">            System.out.println(e.getMessage());</span><br><span class="line">        } <span class="keyword">finally</span> {</span><br><span class="line">            ossClient.shutdown();</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> respMap;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>



<p>测试： <a target="_blank" rel="noopener" href="http://localhost:30000/oss/policy">http://localhost:30000/oss/policy</a> </p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">{"accessid":"LTAI4G4W1RA4JXz2QhoDwHhi","policy":"eyJleHBpcmF0aW9uIjoiMjAyMC0wNC0yOVQwMjo1ODowNy41NzhaIiwiY29uZGl0aW9ucyI6W1siY29udGVudC1sZW5ndGgtcmFuZ2UiLDAsMTA0ODU3NjAwMF0sWyJzdGFydHMtd2l0aCIsIiRrZXkiLCIyMDIwLTA0LTI5LyJdXX0=","signature":"s42iRxtxGFmHyG40StM3d9vOfFk=","dir":"2020-04-29/","host":"https://gulimall-images.oss-cn-shanghai.aliyuncs.com","expire":"1588129087"}</span><br></pre></td></tr></tbody></table></figure>



<p>以后在上传文件时的访问路径为“ <a target="_blank" rel="noopener" href="http://localhost:88/api/thirdparty/oss/policy%E2%80%9D%EF%BC%8C">http://localhost:88/api/thirdparty/oss/policy”，</a></p>
<p>在“gulimall-gateway”中配置路由规则：</p>
<figure class="highlight yaml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">id:</span> <span class="string">third_party_route</span></span><br><span class="line">  <span class="attr">uri:</span> <span class="string">lb://gulimall-gateway</span></span><br><span class="line">  <span class="attr">predicates:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">Path=/api/thirdparty/**</span></span><br><span class="line">  <span class="attr">filters:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">RewritePath=/api/thirdparty/(?&lt;segment&gt;/?.*),/$\{segment}</span></span><br></pre></td></tr></tbody></table></figure>



<p>测试是否能够正常跳转： <a target="_blank" rel="noopener" href="http://localhost:88/api/thirdparty/oss/policy">http://localhost:88/api/thirdparty/oss/policy</a> </p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/image-20200429111408164.png" alt="image-20200429111408164"></p>
<h3 id="上传组件"><a href="#上传组件" class="headerlink" title="上传组件"></a>上传组件</h3><p>放置项目提供的upload文件夹到components目录下，一个是单文件上传，另外一个是多文件上传</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">PS D:\Project\gulimall\renren-fast-vue\src\components\upload&gt; ls</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    目录: D:\Project\gulimall\renren-fast-vue\src\components\upload</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Mode                LastWriteTime         Length Name</span><br><span class="line">----                -------------         ------ ----</span><br><span class="line">-a----  2020/4/29 星期三     12:0           3122 multiUpload.vue</span><br><span class="line">                                2</span><br><span class="line">-a----  2019/11/11 星期一     21:            343 policy.js</span><br><span class="line">                               20</span><br><span class="line">-a----  2020/4/29 星期三     12:0           3053 singleUpload.vue</span><br><span class="line">                                1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">PS D:\Project\gulimall\renren-fast-vue\src\components\upload&gt;</span><br></pre></td></tr></tbody></table></figure>



<p>修改这两个文件的配置后</p>
<p>开始执行上传，但是在上传过程中，出现了如下的问题：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/image-20200429124629150.png" alt="image-20200429124629150"></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">Access to XMLHttpRequest at 'http://gulimall-images.oss-cn-shanghai.aliyuncs.com/' from origin 'http://localhost:8001' has been blocked by CORS policy: Response to preflight request doesn't pass access control check: No 'Access-Control-Allow-Origin' header is present on the requested resource.</span><br></pre></td></tr></tbody></table></figure>

<p>这又是一个跨域的问题，解决方法就是在阿里云上开启跨域访问：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/image-20200429124940091.png" alt="image-20200429124940091"></p>
<p>再次执行文件上传。</p>
<h2 id="18-JSR303校验"><a href="#18-JSR303校验" class="headerlink" title="18. JSR303校验"></a>18. JSR303校验</h2><h3 id="步骤1：使用校验注解"><a href="#步骤1：使用校验注解" class="headerlink" title="步骤1：使用校验注解"></a>步骤1：使用校验注解</h3><p>在Java中提供了一系列的校验方式，它这些校验方式在“javax.validation.constraints”包中，提供了如@Email，@NotNull等注解。</p>
<p>在非空处理方式上提供了@NotNull，@Blank和@</p>
<p>（1）@NotNull</p>
<p>The annotated element must not be null. Accepts any type.<br>注解元素禁止为null，能够接收任何类型</p>
<p>（2）@NotEmpty</p>
<p>the annotated element must not be null nor empty.</p>
<p>该注解修饰的字段不能为null或””</p>
<p>Supported types are:</p>
<p>支持以下几种类型</p>
<p>CharSequence (length of character sequence is evaluated)</p>
<p>字符序列（字符序列长度的计算）</p>
<p>Collection (collection size is evaluated)<br>集合长度的计算</p>
<p>Map (map size is evaluated)<br>map长度的计算</p>
<p>Array (array length is evaluated)<br>数组长度的计算</p>
<p>（3）@NotBlank</p>
<p>The annotated element must not be null and must contain at least one non-whitespace character. Accepts CharSequence.<br>该注解不能为null，并且至少包含一个非空白字符。接收字符序列。</p>
<h3 id="步骤2：在请求方法种，使用校验注解-Valid，开启校验，"><a href="#步骤2：在请求方法种，使用校验注解-Valid，开启校验，" class="headerlink" title="步骤2：在请求方法种，使用校验注解@Valid，开启校验，"></a>步骤2：在请求方法种，使用校验注解@Valid，开启校验，</h3><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">  <span class="meta">@RequestMapping("/save")</span></span><br><span class="line">  <span class="keyword">public</span> R <span class="title function_">save</span><span class="params">(<span class="meta">@Valid</span> <span class="meta">@RequestBody</span> BrandEntity brand)</span>{</span><br><span class="line">brandService.save(brand);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> R.ok();</span><br><span class="line">  }</span><br></pre></td></tr></tbody></table></figure>



<p>测试： <a target="_blank" rel="noopener" href="http://localhost:88/api/product/brand/save">http://localhost:88/api/product/brand/save</a> </p>
<p>在postman种发送上面的请求</p>
<figure class="highlight json"><table><tbody><tr><td class="code"><pre><span class="line"><span class="punctuation">{</span></span><br><span class="line">    <span class="attr">"timestamp"</span><span class="punctuation">:</span> <span class="string">"2020-04-29T09:20:46.383+0000"</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"status"</span><span class="punctuation">:</span> <span class="number">400</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"error"</span><span class="punctuation">:</span> <span class="string">"Bad Request"</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"errors"</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">{</span></span><br><span class="line">            <span class="attr">"codes"</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="string">"NotBlank.brandEntity.name"</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">"NotBlank.name"</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">"NotBlank.java.lang.String"</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">"NotBlank"</span></span><br><span class="line">            <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"arguments"</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="punctuation">{</span></span><br><span class="line">                    <span class="attr">"codes"</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                        <span class="string">"brandEntity.name"</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="string">"name"</span></span><br><span class="line">                    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">"arguments"</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">"defaultMessage"</span><span class="punctuation">:</span> <span class="string">"name"</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">"code"</span><span class="punctuation">:</span> <span class="string">"name"</span></span><br><span class="line">                <span class="punctuation">}</span></span><br><span class="line">            <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"defaultMessage"</span><span class="punctuation">:</span> <span class="string">"不能为空"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"objectName"</span><span class="punctuation">:</span> <span class="string">"brandEntity"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"field"</span><span class="punctuation">:</span> <span class="string">"name"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"rejectedValue"</span><span class="punctuation">:</span> <span class="string">""</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"bindingFailure"</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"code"</span><span class="punctuation">:</span> <span class="string">"NotBlank"</span></span><br><span class="line">        <span class="punctuation">}</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"message"</span><span class="punctuation">:</span> <span class="string">"Validation failed for object='brandEntity'. Error count: 1"</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"path"</span><span class="punctuation">:</span> <span class="string">"/product/brand/save"</span></span><br><span class="line"><span class="punctuation">}</span></span><br></pre></td></tr></tbody></table></figure>

<p>能够看到”defaultMessage”: “不能为空”，这些错误消息定义在“hibernate-validator”的“\org\hibernate\validator\ValidationMessages_zh_CN.properties”文件中。在该文件中定义了很多的错误规则：</p>
<figure class="highlight properties"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">javax.validation.constraints.AssertFalse.message</span>     = <span class="string">只能为false</span></span><br><span class="line"><span class="attr">javax.validation.constraints.AssertTrue.message</span>      = <span class="string">只能为true</span></span><br><span class="line"><span class="attr">javax.validation.constraints.DecimalMax.message</span>      = <span class="string">必须小于或等于{value}</span></span><br><span class="line"><span class="attr">javax.validation.constraints.DecimalMin.message</span>      = <span class="string">必须大于或等于{value}</span></span><br><span class="line"><span class="attr">javax.validation.constraints.Digits.message</span>          = <span class="string">数字的值超出了允许范围(只允许在{integer}位整数和{fraction}位小数范围内)</span></span><br><span class="line"><span class="attr">javax.validation.constraints.Email.message</span>           = <span class="string">不是一个合法的电子邮件地址</span></span><br><span class="line"><span class="attr">javax.validation.constraints.Future.message</span>          = <span class="string">需要是一个将来的时间</span></span><br><span class="line"><span class="attr">javax.validation.constraints.FutureOrPresent.message</span> = <span class="string">需要是一个将来或现在的时间</span></span><br><span class="line"><span class="attr">javax.validation.constraints.Max.message</span>             = <span class="string">最大不能超过{value}</span></span><br><span class="line"><span class="attr">javax.validation.constraints.Min.message</span>             = <span class="string">最小不能小于{value}</span></span><br><span class="line"><span class="attr">javax.validation.constraints.Negative.message</span>        = <span class="string">必须是负数</span></span><br><span class="line"><span class="attr">javax.validation.constraints.NegativeOrZero.message</span>  = <span class="string">必须是负数或零</span></span><br><span class="line"><span class="attr">javax.validation.constraints.NotBlank.message</span>        = <span class="string">不能为空</span></span><br><span class="line"><span class="attr">javax.validation.constraints.NotEmpty.message</span>        = <span class="string">不能为空</span></span><br><span class="line"><span class="attr">javax.validation.constraints.NotNull.message</span>         = <span class="string">不能为null</span></span><br><span class="line"><span class="attr">javax.validation.constraints.Null.message</span>            = <span class="string">必须为null</span></span><br><span class="line"><span class="attr">javax.validation.constraints.Past.message</span>            = <span class="string">需要是一个过去的时间</span></span><br><span class="line"><span class="attr">javax.validation.constraints.PastOrPresent.message</span>   = <span class="string">需要是一个过去或现在的时间</span></span><br><span class="line"><span class="attr">javax.validation.constraints.Pattern.message</span>         = <span class="string">需要匹配正则表达式"{regexp}"</span></span><br><span class="line"><span class="attr">javax.validation.constraints.Positive.message</span>        = <span class="string">必须是正数</span></span><br><span class="line"><span class="attr">javax.validation.constraints.PositiveOrZero.message</span>  = <span class="string">必须是正数或零</span></span><br><span class="line"><span class="attr">javax.validation.constraints.Size.message</span>            = <span class="string">个数必须在{min}和{max}之间</span></span><br><span class="line"></span><br><span class="line"><span class="attr">org.hibernate.validator.constraints.CreditCardNumber.message</span>        = <span class="string">不合法的信用卡号码</span></span><br><span class="line"><span class="attr">org.hibernate.validator.constraints.Currency.message</span>                = <span class="string">不合法的货币 (必须是{value}其中之一)</span></span><br><span class="line"><span class="attr">org.hibernate.validator.constraints.EAN.message</span>                     = <span class="string">不合法的{type}条形码</span></span><br><span class="line"><span class="attr">org.hibernate.validator.constraints.Email.message</span>                   = <span class="string">不是一个合法的电子邮件地址</span></span><br><span class="line"><span class="attr">org.hibernate.validator.constraints.Length.message</span>                  = <span class="string">长度需要在{min}和{max}之间</span></span><br><span class="line"><span class="attr">org.hibernate.validator.constraints.CodePointLength.message</span>         = <span class="string">长度需要在{min}和{max}之间</span></span><br><span class="line"><span class="attr">org.hibernate.validator.constraints.LuhnCheck.message</span>               = <span class="string">${validatedValue}的校验码不合法, Luhn模10校验和不匹配</span></span><br><span class="line"><span class="attr">org.hibernate.validator.constraints.Mod10Check.message</span>              = <span class="string">${validatedValue}的校验码不合法, 模10校验和不匹配</span></span><br><span class="line"><span class="attr">org.hibernate.validator.constraints.Mod11Check.message</span>              = <span class="string">${validatedValue}的校验码不合法, 模11校验和不匹配</span></span><br><span class="line"><span class="attr">org.hibernate.validator.constraints.ModCheck.message</span>                = <span class="string">${validatedValue}的校验码不合法, ${modType}校验和不匹配</span></span><br><span class="line"><span class="attr">org.hibernate.validator.constraints.NotBlank.message</span>                = <span class="string">不能为空</span></span><br><span class="line"><span class="attr">org.hibernate.validator.constraints.NotEmpty.message</span>                = <span class="string">不能为空</span></span><br><span class="line"><span class="attr">org.hibernate.validator.constraints.ParametersScriptAssert.message</span>  = <span class="string">执行脚本表达式"{script}"没有返回期望结果</span></span><br><span class="line"><span class="attr">org.hibernate.validator.constraints.Range.message</span>                   = <span class="string">需要在{min}和{max}之间</span></span><br><span class="line"><span class="attr">org.hibernate.validator.constraints.SafeHtml.message</span>                = <span class="string">可能有不安全的HTML内容</span></span><br><span class="line"><span class="attr">org.hibernate.validator.constraints.ScriptAssert.message</span>            = <span class="string">执行脚本表达式"{script}"没有返回期望结果</span></span><br><span class="line"><span class="attr">org.hibernate.validator.constraints.URL.message</span>                     = <span class="string">需要是一个合法的URL</span></span><br><span class="line"></span><br><span class="line"><span class="attr">org.hibernate.validator.constraints.time.DurationMax.message</span>        = <span class="string">必须小于${inclusive == true ? '或等于' : ''}${days == 0 ? '' : days += '天'}${hours == 0 ? '' : hours += '小时'}${minutes == 0 ? '' : minutes += '分钟'}${seconds == 0 ? '' : seconds += '秒'}${millis == 0 ? '' : millis += '毫秒'}${nanos == 0 ? '' : nanos += '纳秒'}</span></span><br><span class="line"><span class="attr">org.hibernate.validator.constraints.time.DurationMin.message</span>        = <span class="string">必须大于${inclusive == true ? '或等于' : ''}${days == 0 ? '' : days += '天'}${hours == 0 ? '' : hours += '小时'}${minutes == 0 ? '' : minutes += '分钟'}${seconds == 0 ? '' : seconds += '秒'}${millis == 0 ? '' : millis += '毫秒'}${nanos == 0 ? '' : nanos += '纳秒'}</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>想要自定义错误消息，可以覆盖默认的错误提示信息，如@NotBlank的默认message是</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> NotBlank {</span><br><span class="line"></span><br><span class="line">	String <span class="title function_">message</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">"{javax.validation.constraints.NotBlank.message}"</span>;</span><br></pre></td></tr></tbody></table></figure>

<p>可以在添加注解的时候，修改message：</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@NotBlank(message = "品牌名必须非空")</span></span><br><span class="line"><span class="keyword">private</span> String name;</span><br></pre></td></tr></tbody></table></figure>

<p>当再次发送请求时，得到的错误提示信息：</p>
<figure class="highlight json"><table><tbody><tr><td class="code"><pre><span class="line"><span class="punctuation">{</span></span><br><span class="line">    <span class="attr">"timestamp"</span><span class="punctuation">:</span> <span class="string">"2020-04-29T09:36:04.125+0000"</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"status"</span><span class="punctuation">:</span> <span class="number">400</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"error"</span><span class="punctuation">:</span> <span class="string">"Bad Request"</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"errors"</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">{</span></span><br><span class="line">            <span class="attr">"codes"</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="string">"NotBlank.brandEntity.name"</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">"NotBlank.name"</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">"NotBlank.java.lang.String"</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">"NotBlank"</span></span><br><span class="line">            <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"arguments"</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="punctuation">{</span></span><br><span class="line">                    <span class="attr">"codes"</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                        <span class="string">"brandEntity.name"</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="string">"name"</span></span><br><span class="line">                    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">"arguments"</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">"defaultMessage"</span><span class="punctuation">:</span> <span class="string">"name"</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">"code"</span><span class="punctuation">:</span> <span class="string">"name"</span></span><br><span class="line">                <span class="punctuation">}</span></span><br><span class="line">            <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"defaultMessage"</span><span class="punctuation">:</span> <span class="string">"品牌名必须非空"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"objectName"</span><span class="punctuation">:</span> <span class="string">"brandEntity"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"field"</span><span class="punctuation">:</span> <span class="string">"name"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"rejectedValue"</span><span class="punctuation">:</span> <span class="string">""</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"bindingFailure"</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"code"</span><span class="punctuation">:</span> <span class="string">"NotBlank"</span></span><br><span class="line">        <span class="punctuation">}</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"message"</span><span class="punctuation">:</span> <span class="string">"Validation failed for object='brandEntity'. Error count: 1"</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"path"</span><span class="punctuation">:</span> <span class="string">"/product/brand/save"</span></span><br><span class="line"><span class="punctuation">}</span></span><br></pre></td></tr></tbody></table></figure>



<p>但是这种返回的错误结果并不符合我们的业务需要。</p>
<h3 id="步骤3：给校验的Bean后，紧跟一个BindResult，就可以获取到校验的结果。拿到校验的结果，就可以自定义的封装。"><a href="#步骤3：给校验的Bean后，紧跟一个BindResult，就可以获取到校验的结果。拿到校验的结果，就可以自定义的封装。" class="headerlink" title="步骤3：给校验的Bean后，紧跟一个BindResult，就可以获取到校验的结果。拿到校验的结果，就可以自定义的封装。"></a>步骤3：给校验的Bean后，紧跟一个BindResult，就可以获取到校验的结果。拿到校验的结果，就可以自定义的封装。</h3><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping("/save")</span></span><br><span class="line">   <span class="keyword">public</span> R <span class="title function_">save</span><span class="params">(<span class="meta">@Valid</span> <span class="meta">@RequestBody</span> BrandEntity brand, BindingResult result)</span>{</span><br><span class="line">       <span class="keyword">if</span>( result.hasErrors()){</span><br><span class="line">           Map&lt;String,String&gt; map=<span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">           <span class="comment">//1.获取错误的校验结果</span></span><br><span class="line">           result.getFieldErrors().forEach((item)-&gt;{</span><br><span class="line">               <span class="comment">//获取发生错误时的message</span></span><br><span class="line">               <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> item.getDefaultMessage();</span><br><span class="line">               <span class="comment">//获取发生错误的字段</span></span><br><span class="line">               <span class="type">String</span> <span class="variable">field</span> <span class="operator">=</span> item.getField();</span><br><span class="line">               map.put(field,message);</span><br><span class="line">           });</span><br><span class="line">           <span class="keyword">return</span> R.error(<span class="number">400</span>,<span class="string">"提交的数据不合法"</span>).put(<span class="string">"data"</span>,map);</span><br><span class="line">       }<span class="keyword">else</span> {</span><br><span class="line"></span><br><span class="line">       }</span><br><span class="line">	brandService.save(brand);</span><br><span class="line"></span><br><span class="line">       <span class="keyword">return</span> R.ok();</span><br><span class="line">   }</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>这种是针对于该请求设置了一个内容校验，如果针对于每个请求都单独进行配置，显然不是太合适，实际上可以统一的对于异常进行处理。</p>
<h3 id="步骤4：统一异常处理"><a href="#步骤4：统一异常处理" class="headerlink" title="步骤4：统一异常处理"></a>步骤4：统一异常处理</h3><p>可以使用SpringMvc所提供的@ControllerAdvice，通过“basePackages”能够说明处理哪些路径下的异常。</p>
<p>（1）抽取一个异常处理类</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.bigdata.gulimall.product.exception;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.bigdata.common.utils.R;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.validation.BindingResult;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.MethodArgumentNotValidException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ControllerAdvice;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ExceptionHandler;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestControllerAdvice;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 集中处理所有异常</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RestControllerAdvice(basePackages = "com.bigdata.gulimall.product.controller")</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GulimallExceptionAdvice</span> {</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExceptionHandler(value = Exception.class)</span></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">handleValidException</span><span class="params">(MethodArgumentNotValidException exception)</span>{</span><br><span class="line">        Map&lt;String,String&gt; map=<span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="type">BindingResult</span> <span class="variable">bindingResult</span> <span class="operator">=</span> exception.getBindingResult();</span><br><span class="line">        bindingResult.getFieldErrors().forEach(fieldError -&gt; {</span><br><span class="line">            <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> fieldError.getDefaultMessage();</span><br><span class="line">            <span class="type">String</span> <span class="variable">field</span> <span class="operator">=</span> fieldError.getField();</span><br><span class="line">            map.put(field,message);</span><br><span class="line">        });</span><br><span class="line"></span><br><span class="line">        log.error(<span class="string">"数据校验出现问题{},异常类型{}"</span>,exception.getMessage(),exception.getClass());</span><br><span class="line">        <span class="keyword">return</span> R.error(<span class="number">400</span>,<span class="string">"数据校验出现问题"</span>).put(<span class="string">"data"</span>,map);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>（2）测试： <a target="_blank" rel="noopener" href="http://localhost:88/api/product/brand/save">http://localhost:88/api/product/brand/save</a> </p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/image-20200429183334783.png" alt="image-20200429183334783"></p>
<p>（3）默认异常处理</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@ExceptionHandler(value = Throwable.class)</span></span><br><span class="line"> <span class="keyword">public</span> R <span class="title function_">handleException</span><span class="params">(Throwable throwable)</span>{</span><br><span class="line">     log.error(<span class="string">"未知异常{},异常类型{}"</span>,throwable.getMessage(),throwable.getClass());</span><br><span class="line">     <span class="keyword">return</span> R.error(BizCodeEnum.UNKNOW_EXEPTION.getCode(),BizCodeEnum.UNKNOW_EXEPTION.getMsg());</span><br><span class="line"> }</span><br></pre></td></tr></tbody></table></figure>

<p>（4）错误状态码</p>
<p>上面代码中，针对于错误状态码，是我们进行随意定义的，然而正规开发过程中，错误状态码有着严格的定义规则，如该在项目中我们的错误状态码定义</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/image-20200429183748249.png" alt="image-20200429183748249"></p>
<p>为了定义这些错误状态码，我们可以单独定义一个常量类，用来存储这些错误状态码</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.bigdata.common.exception;</span><br><span class="line"></span><br><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> * 错误码和错误信息定义类</span></span><br><span class="line"><span class="comment"> * 1. 错误码定义规则为5为数字</span></span><br><span class="line"><span class="comment"> * 2. 前两位表示业务场景，最后三位表示错误码。例如：100001。10:通用 001:系统未知异常</span></span><br><span class="line"><span class="comment"> * 3. 维护错误码后需要维护错误描述，将他们定义为枚举形式</span></span><br><span class="line"><span class="comment"> * 错误码列表：</span></span><br><span class="line"><span class="comment"> *  10: 通用</span></span><br><span class="line"><span class="comment"> *      001：参数格式校验</span></span><br><span class="line"><span class="comment"> *  11: 商品</span></span><br><span class="line"><span class="comment"> *  12: 订单</span></span><br><span class="line"><span class="comment"> *  13: 购物车</span></span><br><span class="line"><span class="comment"> *  14: 物流</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">BizCodeEnum</span> {</span><br><span class="line"></span><br><span class="line">    UNKNOW_EXEPTION(<span class="number">10000</span>,<span class="string">"系统未知异常"</span>),</span><br><span class="line"></span><br><span class="line">    VALID_EXCEPTION( <span class="number">10001</span>,<span class="string">"参数格式校验失败"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> code;</span><br><span class="line">    <span class="keyword">private</span> String msg;</span><br><span class="line"></span><br><span class="line">    BizCodeEnum(<span class="type">int</span> code, String msg) {</span><br><span class="line">        <span class="built_in">this</span>.code = code;</span><br><span class="line">        <span class="built_in">this</span>.msg = msg;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getCode</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> code;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getMsg</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> msg;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>（5）测试： <a target="_blank" rel="noopener" href="http://localhost:88/api/product/brand/save">http://localhost:88/api/product/brand/save</a> </p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="IDE/image-20200429191830967.png" alt="image-20200429191830967" style="zoom:67%;">

<h2 id="19-分组校验功能（完成多场景的复杂校验）"><a href="#19-分组校验功能（完成多场景的复杂校验）" class="headerlink" title="19. 分组校验功能（完成多场景的复杂校验）"></a>19. 分组校验功能（完成多场景的复杂校验）</h2><h3 id="1、给校验注解，标注上groups，指定什么情况下才需要进行校验"><a href="#1、给校验注解，标注上groups，指定什么情况下才需要进行校验" class="headerlink" title="1、给校验注解，标注上groups，指定什么情况下才需要进行校验"></a>1、给校验注解，标注上groups，指定什么情况下才需要进行校验</h3><p>如：指定在更新和添加的时候，都需要进行校验</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@NotEmpty</span></span><br><span class="line"><span class="meta">@NotBlank(message = "品牌名必须非空",groups = {UpdateGroup.class,AddGroup.class})</span></span><br><span class="line"><span class="keyword">private</span> String name;</span><br></pre></td></tr></tbody></table></figure>

<p>在这种情况下，没有指定分组的校验注解，默认是不起作用的。想要起作用就必须要加groups。</p>
<h3 id="2、业务方法参数上使用-Validated注解"><a href="#2、业务方法参数上使用-Validated注解" class="headerlink" title="2、业务方法参数上使用@Validated注解"></a>2、业务方法参数上使用@Validated注解</h3><p>@Validated的value方法：</p>
<p>Specify one or more validation groups to apply to the validation step kicked off by this annotation.<br> 指定一个或多个验证组以应用于此注释启动的验证步骤。 </p>
<p>JSR-303 defines validation groups as custom annotations which an application declares for the sole purpose of using<br>them as type-safe group arguments, as implemented in SpringValidatorAdapter.</p>
<p> JSR-303 将验证组定义为自定义注释，应用程序声明的唯一目的是将它们用作类型安全组参数，如 SpringValidatorAdapter 中实现的那样。 </p>
<p>Other SmartValidator implementations may support class arguments in other ways as well.</p>
<p> 其他SmartValidator 实现也可以以其他方式支持类参数。 </p>
<h3 id="3、默认情况下，在分组校验情况下，没有指定指定分组的校验注解，将不会生效，它只会在不分组的情况下生效。"><a href="#3、默认情况下，在分组校验情况下，没有指定指定分组的校验注解，将不会生效，它只会在不分组的情况下生效。" class="headerlink" title="3、默认情况下，在分组校验情况下，没有指定指定分组的校验注解，将不会生效，它只会在不分组的情况下生效。"></a>3、默认情况下，在分组校验情况下，没有指定指定分组的校验注解，将不会生效，它只会在不分组的情况下生效。</h3><h2 id="20-自定义校验功能"><a href="#20-自定义校验功能" class="headerlink" title="20. 自定义校验功能"></a>20. 自定义校验功能</h2><h3 id="1、编写一个自定义的校验注解"><a href="#1、编写一个自定义的校验注解" class="headerlink" title="1、编写一个自定义的校验注解"></a>1、编写一个自定义的校验注解</h3><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Constraint(validatedBy = { ListValueConstraintValidator.class})</span></span><br><span class="line"><span class="meta">@Target({ METHOD, FIELD, ANNOTATION_TYPE, CONSTRUCTOR, PARAMETER, TYPE_USE })</span></span><br><span class="line"><span class="meta">@Retention(RUNTIME)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> ListValue {</span><br><span class="line">    String <span class="title function_">message</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">"{com.bigdata.common.valid.ListValue.message}"</span>;</span><br><span class="line"></span><br><span class="line">    Class&lt;?&gt;[] groups() <span class="keyword">default</span> { };</span><br><span class="line"></span><br><span class="line">    Class&lt;? <span class="keyword">extends</span> <span class="title class_">Payload</span>&gt;[] payload() <span class="keyword">default</span> { };</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span>[] value() <span class="keyword">default</span> {};</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>



<h3 id="2、编写一个自定义的校验器"><a href="#2、编写一个自定义的校验器" class="headerlink" title="2、编写一个自定义的校验器"></a>2、编写一个自定义的校验器</h3><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ListValueConstraintValidator</span> <span class="keyword">implements</span> <span class="title class_">ConstraintValidator</span>&lt;ListValue,Integer&gt; {</span><br><span class="line">    <span class="keyword">private</span> Set&lt;Integer&gt; set=<span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initialize</span><span class="params">(ListValue constraintAnnotation)</span> {</span><br><span class="line">        <span class="type">int</span>[] value = constraintAnnotation.value();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i : value) {</span><br><span class="line">            set.add(i);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isValid</span><span class="params">(Integer value, ConstraintValidatorContext context)</span> {</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span>  set.contains(value);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>



<h3 id="3、关联自定义的校验器和自定义的校验注解"><a href="#3、关联自定义的校验器和自定义的校验注解" class="headerlink" title="3、关联自定义的校验器和自定义的校验注解"></a>3、关联自定义的校验器和自定义的校验注解</h3><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Constraint(validatedBy = { ListValueConstraintValidator.class})</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="4、使用实例"><a href="#4、使用实例" class="headerlink" title="4、使用实例"></a>4、使用实例</h3><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 显示状态[0-不显示；1-显示]</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ListValue(value = {0,1},groups ={AddGroup.class})</span></span><br><span class="line"><span class="keyword">private</span> Integer showStatus;</span><br></pre></td></tr></tbody></table></figure>

<h2 id="21-商品SPU和SKU管理"><a href="#21-商品SPU和SKU管理" class="headerlink" title="21. 商品SPU和SKU管理"></a>21. 商品SPU和SKU管理</h2><p>重新执行“sys_menus.sql”</p>
<h2 id="22-点击子组件，父组件触发事件"><a href="#22-点击子组件，父组件触发事件" class="headerlink" title="22. 点击子组件，父组件触发事件"></a>22. 点击子组件，父组件触发事件</h2><p>现在想要实现点击菜单的左边，能够实现在右边展示数据</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/image-20200430215649355.png" alt="image-20200430215649355"></p>
<p>父子组件传递数据：</p>
<p>1）子组件给父组件传递数据，事件机制；</p>
<p>在category中绑定node-click事件，</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">&lt;el-tree :data="menus" :props="defaultProps" node-key="catId" ref="menuTree" @node-click="nodeClick"	&gt;&lt;/el-tree&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>2）子组件给父组件发送一个事件，携带上数据；</p>
<figure class="highlight javascript"><table><tbody><tr><td class="code"><pre><span class="line"><span class="title function_">nodeClick</span>(<span class="params">data,Node,component</span>){</span><br><span class="line">   <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">"子组件"</span>,data,<span class="title class_">Node</span>,component);</span><br><span class="line">   <span class="variable language_">this</span>.$emit(<span class="string">"tree-node-click"</span>,data,<span class="title class_">Node</span>,component);</span><br><span class="line">}, </span><br></pre></td></tr></tbody></table></figure>

<p>this.$emit(事件名,”携带的数据”);</p>
<p>3）父组件中的获取发送的事件</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">&lt;category @tree-node-click="treeNodeClick"&gt;&lt;/category&gt;</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight javascript"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//获取发送的事件数据</span></span><br><span class="line"><span class="title function_">treeNodeClick</span>(<span class="params">data,Node,component</span>){</span><br><span class="line"> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">"attgroup感知到的category的节点被点击"</span>,data,<span class="title class_">Node</span>,component);</span><br><span class="line"> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">"刚才被点击的菜单ID"</span>,data.<span class="property">catId</span>);</span><br><span class="line">},</span><br></pre></td></tr></tbody></table></figure>



<h2 id="23-规格参数新增与VO"><a href="#23-规格参数新增与VO" class="headerlink" title="23. 规格参数新增与VO"></a>23. 规格参数新增与VO</h2><p>规格参数新增时，请求的URL：Request URL: </p>
<p><a target="_blank" rel="noopener" href="http://localhost:88/api/product/attr/base/list/0?t=1588731762158&amp;page=1&amp;limit=10&amp;key=">http://localhost:88/api/product/attr/base/list/0?t=1588731762158&amp;page=1&amp;limit=10&amp;key=</a></p>
<p>当有新增字段时，我们往往会在entity实体类中新建一个字段，并标注数据库中不存在该字段，然而这种方式并不规范</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/1588732021702.png" alt="1588732021702"></p>
<p>比较规范的做法是，新建一个vo文件夹，将每种不同的对象，按照它的功能进行了划分。在java中，涉及到了这几种类型</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/1588732152646.png" alt="1588732152646"></p>
<p>Request URL: <a target="_blank" rel="noopener" href="http://localhost:88/api/product/attr/save%EF%BC%8C%E7%8E%B0%E5%9C%A8%E7%9A%84%E6%83%85%E5%86%B5%E6%98%AF%EF%BC%8C%E5%AE%83%E5%9C%A8%E4%BF%9D%E5%AD%98%E7%9A%84%E6%97%B6%E5%80%99%EF%BC%8C%E5%8F%AA%E6%98%AF%E4%BF%9D%E5%AD%98%E4%BA%86attr%EF%BC%8C%E5%B9%B6%E6%B2%A1%E6%9C%89%E4%BF%9D%E5%AD%98attrgroup%EF%BC%8C%E4%B8%BA%E4%BA%86%E8%A7%A3%E5%86%B3%E8%BF%99%E4%B8%AA%E9%97%AE%E9%A2%98%EF%BC%8C%E6%88%91%E4%BB%AC%E6%96%B0%E5%BB%BA%E4%BA%86%E4%B8%80%E4%B8%AAvo/AttrVo%EF%BC%8C%E5%9C%A8%E5%8E%9FAttrEntity%E5%9F%BA%E7%A1%80%E4%B8%8A%E5%A2%9E%E5%8A%A0%E4%BA%86attrGroupId%E5%AD%97%E6%AE%B5%EF%BC%8C%E4%BD%BF%E5%BE%97%E4%BF%9D%E5%AD%98%E6%96%B0%E5%A2%9E%E6%95%B0%E6%8D%AE%E7%9A%84%E6%97%B6%E5%80%99%EF%BC%8C%E4%B9%9F%E4%BF%9D%E5%AD%98%E4%BA%86%E5%AE%83%E4%BB%AC%E4%B9%8B%E9%97%B4%E7%9A%84%E5%85%B3%E7%B3%BB%E3%80%82">http://localhost:88/api/product/attr/save，现在的情况是，它在保存的时候，只是保存了attr，并没有保存attrgroup，为了解决这个问题，我们新建了一个vo/AttrVo，在原AttrEntity基础上增加了attrGroupId字段，使得保存新增数据的时候，也保存了它们之间的关系。</a></p>
<p>通过” BeanUtils.copyProperties(attr,attrEntity);”能够实现在两个Bean之间拷贝数据，但是两个Bean的字段要相同</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveAttr</span><span class="params">(AttrVo attr)</span> {</span><br><span class="line">     <span class="type">AttrEntity</span> <span class="variable">attrEntity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AttrEntity</span>();</span><br><span class="line">     BeanUtils.copyProperties(attr,attrEntity);</span><br><span class="line">     <span class="built_in">this</span>.save(attrEntity);</span><br><span class="line"> }</span><br></pre></td></tr></tbody></table></figure>

<p>问题：现在有两个查询，一个是查询部分，另外一个是查询全部，但是又必须这样来做吗？还是有必要的，但是可以在后台进行设计，两种查询是根据catId是否为零进行区分的。</p>
<h2 id="24-查询分组关联属性和删除关联"><a href="#24-查询分组关联属性和删除关联" class="headerlink" title="24. 查询分组关联属性和删除关联"></a>24. 查询分组关联属性和删除关联</h2><p>获取属性分组的关联的所有属性</p>
<p>API：<a target="_blank" rel="noopener" href="https://easydoc.xyz/doc/75716633/ZUqEdvA4/LnjzZHPj">https://easydoc.xyz/doc/75716633/ZUqEdvA4/LnjzZHPj</a></p>
<p>发送请求：/product/attrgroup/{attrgroupId}/attr/relation</p>
<p>获取当前属性分组所关联的属性</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/1588766303205.png" alt="1588766303205"></p>
<p>如何查找：既然给出了attr_group_id，那么到中间表中查询出来所关联的attr_id，然后得到最终的所有属性即可。</p>
<p>可能出现null值的问题</p>
<h2 id="25-查询分组未关联的属性"><a href="#25-查询分组未关联的属性" class="headerlink" title="25. 查询分组未关联的属性"></a>25. 查询分组未关联的属性</h2><p>/product/attrgroup/{attrgroupId}/noattr/relation</p>
<p>API：<a target="_blank" rel="noopener" href="https://easydoc.xyz/doc/75716633/ZUqEdvA4/d3EezLdO">https://easydoc.xyz/doc/75716633/ZUqEdvA4/d3EezLdO</a></p>
<p>获取属性分组里面还没有关联的本分类里面的其他基本属性，方便添加新的关联</p>
<p>Request URL: <a target="_blank" rel="noopener" href="http://localhost:88/api/product/attrgroup/1/noattr/relation?t=1588780783441&amp;page=1&amp;limit=10&amp;key=">http://localhost:88/api/product/attrgroup/1/noattr/relation?t=1588780783441&amp;page=1&amp;limit=10&amp;key=</a></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/1588780868214.png" alt="1588780868214"></p>
<p>属性分组，对应于“pms_attr_group”表，每个分组下，需要查看到关联了哪些属性信息，销售属性不需要和分组进行关联，但是规格参数要和属性分组进行关联。</p>
<p>规格参数：对应于<code>pms_attr</code>表，attr_type=1，需要显示分组信息</p>
<p>销售属性：对应于pms_attr`表，attr_type=0，不需要显示分组信息</p>
<p>分组ID为9的分组：Request URL: <a target="_blank" rel="noopener" href="http://localhost:88/api/product/attrgroup/9/noattr/relation?t=1588822258669&amp;page=1&amp;limit=10&amp;key=">http://localhost:88/api/product/attrgroup/9/noattr/relation?t=1588822258669&amp;page=1&amp;limit=10&amp;key=</a></p>
<p>对应的数据库字段</p>
<p>attr_group_id  attr_group_name    sort  descript                icon    catelog_id  </p>
<hr>
<pre><code>        9  主体                    1  型号 平台                   wu               454
       10  显卡                    1  显存容量                    wu               454
       11  输入设备                  1  鼠标 键盘                   wu               454
       12  主板                    1  显卡类型 芯片组                wu               454
       13  规格                    1  尺寸                      wu               454
</code></pre>
<p>查询attrgroupId=9的属性分组：</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="type">AttrGroupEntity</span> <span class="variable">attrGroupEntity</span> <span class="operator">=</span> attrGroupDao.selectById(attrgroupId);</span><br></pre></td></tr></tbody></table></figure>

<p>获取到分类信息：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">Long catelogId = attrGroupEntity.getCatelogId();</span><br></pre></td></tr></tbody></table></figure>



<p>目标：获取属性分组没有关联的其他属性</p>
<p>也就是获取attrgroupId=9的属性分组中，关联的分类catelog_id =454 （台式机），其他基本属性</p>
<p>在该属性分组中，现在已经关联的属性：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/1588822997675.png" alt="1588822997675"></p>
<p>本分类下，存在哪些基本属性？</p>
<p>没有关联的其他属性</p>
<p>已经关联的属性，这些属性是如何关联上的？</p>
<p>答：在创建规格参数的时候，已经设置了需要关联哪些属性分组。</p>
<p>想要知道还没有关联哪些，先查看关联了哪些，如何排除掉这些就是未关联的</p>
<p>在中间表中显示了属性和属性分组之间的关联关系，在属性表中显示了所有的属性，</p>
<p>先查询中间表，得到所有已经关联的属性的id，然后再次查询属性表，排除掉已经建立关联的属性ID，将剩下的属性ID和属性建立起关联关系</p>
<h2 id="26-添加属性和分组的关联关系"><a href="#26-添加属性和分组的关联关系" class="headerlink" title="26. 添加属性和分组的关联关系"></a>26. 添加属性和分组的关联关系</h2><p>请求类型：Request URL: <a target="_blank" rel="noopener" href="http://localhost:88/api/product/attrgroup/attr/relation">http://localhost:88/api/product/attrgroup/attr/relation</a></p>
<p>请求方式：POST</p>
<p>请求数据：[{“attrId”:10,”attrGroupId”:9}]</p>
<p>API：<a target="_blank" rel="noopener" href="https://easydoc.xyz/doc/75716633/ZUqEdvA4/VhgnaedC">https://easydoc.xyz/doc/75716633/ZUqEdvA4/VhgnaedC</a></p>
<p>响应数据：</p>
<figure class="highlight json"><table><tbody><tr><td class="code"><pre><span class="line"><span class="punctuation">{</span></span><br><span class="line">	<span class="attr">"msg"</span><span class="punctuation">:</span> <span class="string">"success"</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">"code"</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line"><span class="punctuation">}</span></span><br></pre></td></tr></tbody></table></figure>



<p>本质就是在中间表pms_attr_attrgroup_relation中，添加一条记录的过程</p>
<h2 id="27-发布商品"><a href="#27-发布商品" class="headerlink" title="27. 发布商品"></a>27. 发布商品</h2><p>获取所有会员等级：/member/memberlevel/list</p>
<p>API：<a target="_blank" rel="noopener" href="https://easydoc.xyz/doc/75716633/ZUqEdvA4/jCFganpf">https://easydoc.xyz/doc/75716633/ZUqEdvA4/jCFganpf</a></p>
<p>在“gulimall-gateway”中修改“”文件，添加对于member的路由</p>
<figure class="highlight yaml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">id:</span> <span class="string">gulimall-member</span></span><br><span class="line">  <span class="attr">uri:</span> <span class="string">lb://gulimall-member</span></span><br><span class="line">  <span class="attr">predicates:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">Path=/api/member/**</span></span><br><span class="line">  <span class="attr">filters:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">RewritePath=/api/(?&lt;segment&gt;/?.*),/$\{segment}</span></span><br></pre></td></tr></tbody></table></figure>



<p>在“gulimall-member”中，创建“bootstrap.properties”文件，内容如下：</p>
<figure class="highlight properties"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">spring.cloud.nacos.config.name</span>=<span class="string">gulimall-member</span></span><br><span class="line"><span class="attr">spring.cloud.nacos.config.server-addr</span>=<span class="string">192.168.137.14:8848</span></span><br><span class="line"><span class="attr">spring.cloud.nacos.config.namespace</span>=<span class="string">795521fa-77ef-411e-a8d8-0889fdfe6964</span></span><br><span class="line"><span class="attr">spring.cloud.nacos.config.extension-configs[0].data-id</span>=<span class="string">gulimall-member.yml</span></span><br><span class="line"><span class="attr">spring.cloud.nacos.config.extension-configs[0].group</span>=<span class="string">DEFAULT_GROUP</span></span><br><span class="line"><span class="attr">spring.cloud.nacos.config.extension-configs[0].refresh</span>=<span class="string">true</span></span><br></pre></td></tr></tbody></table></figure>



<p>获取分类关联的品牌：/product/categorybrandrelation/brands/list</p>
<p>API：<a target="_blank" rel="noopener" href="https://easydoc.xyz/doc/75716633/ZUqEdvA4/HgVjlzWV">https://easydoc.xyz/doc/75716633/ZUqEdvA4/HgVjlzWV</a></p>
<p>遇到PubSub问题</p>
<ol>
<li>首先安装pubsub-js</li>
</ol>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">`npm install --save pubsub-js`</span><br></pre></td></tr></tbody></table></figure>

<ol start="2">
<li>订阅方组件</li>
</ol>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">`import PubSub from 'pubsub-js'`</span><br></pre></td></tr></tbody></table></figure>

<p>该this.PubSub为PubSub。</p>
<p>获取分类下所有分组&amp;关联属性</p>
<p>请求类型：/product/attrgroup/{catelogId}/withattr</p>
<p>请求方式：GET</p>
<p>请求URL：<a target="_blank" rel="noopener" href="http://localhost:88/api/product/attrgroup/225/withattr?t=1588864569478">http://localhost:88/api/product/attrgroup/225/withattr?t=1588864569478</a></p>
<p>mysql默认的隔离级别为读已提交，为了能够在调试过程中，获取到数据库中的数据信息，可以调整隔离级别为读未提交：</p>
<figure class="highlight sql"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">SET</span> SESSION TRANSACTION ISOLATION LEVEL READ UNCOMMITTED;</span><br></pre></td></tr></tbody></table></figure>

<p>但是它对于当前的事务窗口生效，如果想要设置全局的，需要加上global字段。</p>
<h2 id="28-商品管理"><a href="#28-商品管理" class="headerlink" title="28. 商品管理"></a>28. 商品管理</h2><p>当新建时：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">t: 1588983621569</span><br><span class="line">status: 0</span><br><span class="line">key: </span><br><span class="line">brandId: 0</span><br><span class="line">catelogId: 0</span><br><span class="line">page: 1</span><br><span class="line">limit: 10</span><br></pre></td></tr></tbody></table></figure>

<p>当上架时：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">t: 1588983754030</span><br><span class="line">status: 1</span><br><span class="line">key: </span><br><span class="line">brandId: 0</span><br><span class="line">catelogId: 0</span><br><span class="line">page: 1</span><br><span class="line">limit: 10</span><br></pre></td></tr></tbody></table></figure>

<p>当下架时：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">t: 1588983789089</span><br><span class="line">status: 2</span><br><span class="line">key: </span><br><span class="line">brandId: 0</span><br><span class="line">catelogId: 0</span><br><span class="line">page: 1</span><br><span class="line">limit: 10</span><br></pre></td></tr></tbody></table></figure>



<p>在SPU中，写出的日期数据都不符合规则：<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/image-20200509083248660.png" alt="image-20200509083248660"></p>
<p>想要符合规则，可以设置写出数据的规则：</p>
<p>spring.jackson</p>
<figure class="highlight yaml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">jackson:</span></span><br><span class="line">  <span class="attr">date-format:</span> <span class="string">yyyy-MM-dd</span> <span class="string">HH:mm:ss</span></span><br></pre></td></tr></tbody></table></figure>



<p>SKU检索：</p>
<p>Request URL: <a target="_blank" rel="noopener" href="http://localhost:88/api/product/skuinfo/list?t=1588989437944&amp;page=1&amp;limit=10&amp;key=&amp;catelogId=0&amp;brandId=0&amp;min=0&amp;max=0">http://localhost:88/api/product/skuinfo/list?t=1588989437944&amp;page=1&amp;limit=10&amp;key=&amp;catelogId=0&amp;brandId=0&amp;min=0&amp;max=0</a></p>
<p>请求体：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">t: 1588989437944</span><br><span class="line">page: 1</span><br><span class="line">limit: 10</span><br><span class="line">key: </span><br><span class="line">catelogId: 0</span><br><span class="line">brandId: 0</span><br><span class="line">min: 0</span><br><span class="line">max: 0</span><br></pre></td></tr></tbody></table></figure>

<p>API： <a target="_blank" rel="noopener" href="https://easydoc.xyz/doc/75716633/ZUqEdvA4/ucirLq1D">https://easydoc.xyz/doc/75716633/ZUqEdvA4/ucirLq1D</a> </p>
<h2 id="29-仓库管理"><a href="#29-仓库管理" class="headerlink" title="29. 仓库管理"></a>29. 仓库管理</h2><p> 库存信息表：wms_ware_info</p>
<p>【1】仓库列表功能： </p>
<p>【2】查询商品库存：</p>
<p>【3】查询采购需求：</p>
<p>【4】 合并采购需求：</p>
<p>合并整单选中parcharseID：Request URL: <a target="_blank" rel="noopener" href="http://localhost:88/api/ware/purchase/merge">http://localhost:88/api/ware/purchase/merge</a></p>
<p>请求数据：</p>
<figure class="highlight json"><table><tbody><tr><td class="code"><pre><span class="line"><span class="punctuation">{</span>purchaseId<span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span> items<span class="punctuation">:</span> <span class="punctuation">[</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">]</span><span class="punctuation">}</span></span><br><span class="line">items<span class="punctuation">:</span> <span class="punctuation">[</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">]</span></span><br></pre></td></tr></tbody></table></figure>



<p>合并整单未选择parcharseID :Request URL: <a target="_blank" rel="noopener" href="http://localhost:88/api/ware/purchase/merge">http://localhost:88/api/ware/purchase/merge</a></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/image-20200509170916557.png" alt="image-20200509170916557"></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">items: [1, 2]</span><br></pre></td></tr></tbody></table></figure>



<p>涉及到两张表：wms_purchase_detail，wms_purchase</p>
<p>现在采购单中填写数据，然后关联用户，关联用户后，</p>
<p>总的含义，就是根据采购单中的信息，更新采购需求，在采购单中填写采购人员，采购单号，采购的时候，更新采购细节表中的采购人员ID和采购状态。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/image-20200509191108806.png" alt="image-20200509191108806"></p>
<p>领取采购单</p>
<p><a target="_blank" rel="noopener" href="http://localhost:88/api/ware/purchase/received">http://localhost:88/api/ware/purchase/received</a></p>
<p>（1）某个人领取了采购单后，先看采购单是否处于未分配状态，只有采购单是新建或以领取状态时，才更新采购单的状态</p>
<p>（2）</p>
<p>【1】仓库列表功能： <a target="_blank" rel="noopener" href="https://easydoc.xyz/doc/75716633/ZUqEdvA4/mZgdqOWe">https://easydoc.xyz/doc/75716633/ZUqEdvA4/mZgdqOWe</a> </p>
<p>【2】查询商品库存： <a target="_blank" rel="noopener" href="https://easydoc.xyz/doc/75716633/ZUqEdvA4/hwXrEXBZ">https://easydoc.xyz/doc/75716633/ZUqEdvA4/hwXrEXBZ</a> </p>
<p>【3】查询采购需求： <a target="_blank" rel="noopener" href="https://easydoc.xyz/doc/75716633/ZUqEdvA4/Ss4zsV7R">https://easydoc.xyz/doc/75716633/ZUqEdvA4/Ss4zsV7R</a> </p>
<p>【4】 合并采购需求：<a target="_blank" rel="noopener" href="https://easydoc.xyz/doc/75716633/ZUqEdvA4/cUlv9QvK">https://easydoc.xyz/doc/75716633/ZUqEdvA4/cUlv9QvK</a> </p>
<p>【5】查询未领取的采购单： <a target="_blank" rel="noopener" href="https://easydoc.xyz/doc/75716633/ZUqEdvA4/hI12DNrH">https://easydoc.xyz/doc/75716633/ZUqEdvA4/hI12DNrH</a> </p>
<p>【6】领取采购单： <a target="_blank" rel="noopener" href="https://easydoc.xyz/doc/75716633/ZUqEdvA4/vXMBBgw1">https://easydoc.xyz/doc/75716633/ZUqEdvA4/vXMBBgw1</a> </p>
<p>完成采购，在完成采购过程中，需要涉及到设置SKU的name信息到仓库中，这是通过远程调用“gulimall-product”来实现根据sku_id查询得到sku_name的，如果这个过程发生了异常，事务不想要回滚，目前采用的方式是通过捕获异常的方式，防止事务回滚，是否还有其他的方式呢？这个问题留待以后解决。</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addStock</span><span class="params">(Long skuId, Long wareId, Integer skuNum)</span> {</span><br><span class="line"></span><br><span class="line">       List&lt;WareSkuEntity&gt; wareSkuEntities = wareSkuDao.selectList(<span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;WareSkuEntity&gt;().eq(<span class="string">"sku_id"</span>, skuId).eq(<span class="string">"ware_id"</span>, wareId));</span><br><span class="line"></span><br><span class="line">       <span class="keyword">if</span>(wareSkuEntities == <span class="literal">null</span> || wareSkuEntities.size() ==<span class="number">0</span> ){</span><br><span class="line">            <span class="comment">//新增</span></span><br><span class="line">           <span class="type">WareSkuEntity</span> <span class="variable">wareSkuEntity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WareSkuEntity</span>();</span><br><span class="line">           wareSkuEntity.setSkuId(skuId);</span><br><span class="line">           wareSkuEntity.setWareId(wareId);</span><br><span class="line">           wareSkuEntity.setStock(skuNum);</span><br><span class="line">           wareSkuEntity.setStockLocked(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">           <span class="comment">//远程查询SKU的name，若失败无需回滚</span></span><br><span class="line">           <span class="keyword">try</span> {</span><br><span class="line">               <span class="type">R</span> <span class="variable">info</span> <span class="operator">=</span> productFeignService.info(skuId);</span><br><span class="line">               <span class="keyword">if</span>(info.getCode() == <span class="number">0</span>){</span><br><span class="line">                   Map&lt;String,Object&gt; data=(Map&lt;String,Object&gt;)info.get(<span class="string">"skuInfo"</span>);</span><br><span class="line">                   wareSkuEntity.setSkuName((String) data.get(<span class="string">"skuName"</span>));</span><br><span class="line">               }</span><br><span class="line">           } <span class="keyword">catch</span> (Exception e) {</span><br><span class="line"></span><br><span class="line">           }</span><br><span class="line"></span><br><span class="line">           wareSkuDao.insert(wareSkuEntity);</span><br><span class="line">       }<span class="keyword">else</span>{</span><br><span class="line">           <span class="comment">//插入</span></span><br><span class="line">           wareSkuDao.addStock(skuId,wareId,skuNum);</span><br><span class="line">       }</span><br><span class="line"></span><br><span class="line">   }</span><br></pre></td></tr></tbody></table></figure>



<h2 id="30-获取spu规格"><a href="#30-获取spu规格" class="headerlink" title="30. 获取spu规格"></a>30. 获取spu规格</h2><p>在SPU管理页面，获取商品规格的时候，出现400异常，浏览器显示跳转不了</p>
<p>问题现象：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/image-20200510182051355.png" alt="image-20200510182051355"></p>
<p>出现问题的代码：</p>
<figure class="highlight javascript"><table><tbody><tr><td class="code"><pre><span class="line"><span class="title function_">attrUpdateShow</span>(<span class="params">row</span>) {</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(row);</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">push</span>({</span><br><span class="line">    <span class="attr">path</span>: <span class="string">"/product-attrupdate"</span>,</span><br><span class="line">    <span class="attr">query</span>: { <span class="attr">spuId</span>: row.<span class="property">id</span>, <span class="attr">catalogId</span>: row.<span class="property">catalogId</span> }</span><br><span class="line">  });</span><br><span class="line">},</span><br></pre></td></tr></tbody></table></figure>



<p>暂时不知道如何解决问题。只能留待以后解决。</p>
<p>经过测试发现，问题和上面的代码没有关系，问题出现在“attrupdate.vue”上，该vue页面无法通过浏览器访问，当输入访问URL（ <a target="_blank" rel="noopener" href="http://localhost:8001/#/product-attrupdate">http://localhost:8001/#/product-attrupdate</a> ）的时候，就会出现404，而其他的请求则不会出现这种情况，不知为何。</p>
<p>通过POSTMAN进行请求的时候，能够请求到数据。</p>
<p>经过分析发现，是因为在数据库中没有该页面的导航所导致的，为了修正这个问题，可以在“sys-menu”表中添加一行，内容位：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/image-20200510231012714.png" alt="image-20200510231012714"></p>
<p>这样当再次访问的时候，在“平台属性”下，会出现“规格维护”菜单，</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/image-20200510231041708.png" alt="image-20200510231041708"></p>
<p>当再次点击“规格”的时候，显示出菜单</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/image-20200510231200130.png" alt="image-20200510231200130"></p>
<p>不过这种菜单并不符合我们的需要，我们需要让它以弹出框的形式出现。</p>
<h2 id="31-修改商品规格"><a href="#31-修改商品规格" class="headerlink" title="31. 修改商品规格"></a>31. 修改商品规格</h2><p>API： <a target="_blank" rel="noopener" href="https://easydoc.xyz/doc/75716633/ZUqEdvA4/GhnJ0L85">https://easydoc.xyz/doc/75716633/ZUqEdvA4/GhnJ0L85</a> </p>
<p>URL：/product/attr/update/{spuId}</p>
<h2 id="小结："><a href="#小结：" class="headerlink" title="小结："></a>小结：</h2><h3 id="1-在open-fen中会将调用的数据转换为JSON，接收方接收后，将JSON转换为对象，此时调用方和被调用方的处理JSON的对象不一定都是同一个类，只要它们的字段类型吻合即可。"><a href="#1-在open-fen中会将调用的数据转换为JSON，接收方接收后，将JSON转换为对象，此时调用方和被调用方的处理JSON的对象不一定都是同一个类，只要它们的字段类型吻合即可。" class="headerlink" title="1.  在open fen中会将调用的数据转换为JSON，接收方接收后，将JSON转换为对象，此时调用方和被调用方的处理JSON的对象不一定都是同一个类，只要它们的字段类型吻合即可。"></a>1.  在open fen中会将调用的数据转换为JSON，接收方接收后，将JSON转换为对象，此时调用方和被调用方的处理JSON的对象不一定都是同一个类，只要它们的字段类型吻合即可。</h3><p>调用方：</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@FeignClient(value = "gulimall-coupon")</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CouponFenService</span> {</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping("/coupon/spubounds/save")</span></span><br><span class="line">    R <span class="title function_">saveSpuBounds</span><span class="params">(<span class="meta">@RequestBody</span> SpuBoundTo spuBoundTo)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping("/coupon/skufullreduction/saveInfo")</span></span><br><span class="line">    R <span class="title function_">saveSkuReduction</span><span class="params">(<span class="meta">@RequestBody</span> SkuReductionTo skuReductionTo)</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>被调用方：</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">  <span class="meta">@PostMapping("/save")</span></span><br><span class="line">  <span class="keyword">public</span> R <span class="title function_">save</span><span class="params">(<span class="meta">@RequestBody</span> SpuBoundsEntity spuBounds)</span>{</span><br><span class="line">spuBoundsService.save(spuBounds);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> R.ok();</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="meta">@PostMapping("/saveInfo")</span></span><br><span class="line">  <span class="keyword">public</span> R <span class="title function_">saveInfo</span><span class="params">(<span class="meta">@RequestBody</span> SkuReductionTo skuReductionTo)</span>{</span><br><span class="line">      skuFullReductionService.saveSkuReduction(skuReductionTo);</span><br><span class="line">      <span class="keyword">return</span> R.ok();</span><br><span class="line">  }</span><br></pre></td></tr></tbody></table></figure>



<p>调用方JSON化时的对象SpuBoundTo：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">@Data</span><br><span class="line">public class SpuBoundTo {</span><br><span class="line">    private Long spuId;</span><br><span class="line">    private BigDecimal buyBounds;</span><br><span class="line">    private BigDecimal growBounds;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>被调用方JSON数据对象化时的对象SpuBoundsEntity：</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 商品spu积分设置</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> cosmoswong</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@email</span> cosmoswong@sina.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020-04-23 23:38:48</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@TableName("sms_spu_bounds")</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpuBoundsEntity</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> {</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * id</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@TableId</span></span><br><span class="line">	<span class="keyword">private</span> Long id;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * </span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> Long spuId;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 成长积分</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> BigDecimal growBounds;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 购物积分</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> BigDecimal buyBounds;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 优惠生效情况[1111（四个状态位，从右到左）;0 - 无优惠，成长积分是否赠送;1 - 无优惠，购物积分是否赠送;2 - 有优惠，成长积分是否赠送;3 - 有优惠，购物积分是否赠送【状态位0：不赠送，1：赠送】]</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> Integer work;</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>





<h3 id="2-事务究竟要如何加上？"><a href="#2-事务究竟要如何加上？" class="headerlink" title="2. 事务究竟要如何加上？"></a>2. 事务究竟要如何加上？</h3><p>存在Batch操作的时候，才需要加上事务，单个操作无需添加事务控制。</p>
<p>SpringBoot中的是事务</p>
<p>批量操作的时候，才需要事务</p>
<p>一个事务标注的方法上，方法内存在这些操作：</p>
<p>（1）批量更新一个表中字段</p>
<p>（2）更新多张表中的操作</p>
<p>实际上不论是哪种类型，方法中所有对于数据库的写操作，都会被整体当做一个事务，在这个事务过程中，如果某个操作出现了异常，则整体都不会被提交。这就是对于SpringBoot中的@Transactional的理解。</p>
<p>@EnableTransactionManagement和@Transactional的区别？</p>
<p> <a target="_blank" rel="noopener" href="https://blog.csdn.net/abysscarry/article/details/80189232">https://blog.csdn.net/abysscarry/article/details/80189232</a><br> <a target="_blank" rel="noopener" href="https://blog.csdn.net/Driver_tu/article/details/99679145">https://blog.csdn.net/Driver_tu/article/details/99679145</a> </p>
<p> <a target="_blank" rel="noopener" href="https://www.cnblogs.com/leaveast/p/11765503.html">https://www.cnblogs.com/leaveast/p/11765503.html</a> </p>
<h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><h3 id="1-文档参考地址"><a href="#1-文档参考地址" class="headerlink" title="1. 文档参考地址"></a>1. 文档参考地址</h3><p> <a target="_blank" rel="noopener" href="http://www.jayh.club/#/02.PassJava%E6%9E%B6%E6%9E%84%E7%AF%87/01.%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE%E5%92%8C%E6%B7%BB%E5%8A%A0%E6%A8%A1%E5%9D%97">http://www.jayh.club/#/02.PassJava%E6%9E%B6%E6%9E%84%E7%AF%87/01.%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE%E5%92%8C%E6%B7%BB%E5%8A%A0%E6%A8%A1%E5%9D%97</a> </p>
<p> <a target="_blank" rel="noopener" href="https://blog.csdn.net/ok_wolf/article/details/105400748">https://blog.csdn.net/ok_wolf/article/details/105400748</a> </p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/javalbb/p/12690862.html">https://www.cnblogs.com/javalbb/p/12690862.html</a></p>
<p> <a target="_blank" rel="noopener" href="https://blog.csdn.net/ok_wolf/article/details/105456170">https://blog.csdn.net/ok_wolf/article/details/105456170</a> </p>
<p> <a target="_blank" rel="noopener" href="https://easydoc.xyz/doc/75716633/ZUqEdvA4/jCFganpf">https://easydoc.xyz/doc/75716633/ZUqEdvA4/jCFganpf</a> </p>
<h3 id="2-开机启动docker"><a href="#2-开机启动docker" class="headerlink" title="2. 开机启动docker"></a>2. 开机启动docker</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/image-20200422221237751.png" alt="image-20200422221237751"></p>
<p>在Docker中设置开机启动容器</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/image-20200423005200485.png" alt="image-20200423005200485"></p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查看防火墙状态</span></span><br><span class="line">[root@hadoop-104 module]# systemctl status firewalld</span><br><span class="line">  firewalld.service - firewalld - dynamic firewall daemon</span><br><span class="line">   Loaded: loaded (/usr/lib/systemd/system/firewalld.service; enabled; vendor preset: enabled)</span><br><span class="line">   Active: active (running) since Wed 2020-04-22 21:26:23 EDT; 10min ago</span><br><span class="line">     Docs: man:firewalld(1)</span><br><span class="line"> Main PID: 5947 (firewalld)</span><br><span class="line">   CGroup: /system.slice/firewalld.service</span><br><span class="line">           └─5947 /usr/bin/python -Es /usr/sbin/firewalld --nofork --nopid</span><br><span class="line"></span><br><span class="line">Apr 22 21:26:20 hadoop-104 systemd[1]: Starting firewalld - dynamic firewall daemon...</span><br><span class="line">Apr 22 21:26:23 hadoop-104 systemd[1]: Started firewalld - dynamic firewall daemon.</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查看防火墙是否是开机启动</span></span><br><span class="line">[root@hadoop-104 module]# systemctl list-unit-files|grep firewalld</span><br><span class="line">firewalld.service                             enabled </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">关闭开机启动防火墙</span></span><br><span class="line">[root@hadoop-104 module]# systemctl disable firewalld             </span><br><span class="line">Removed symlink /etc/systemd/system/multi-user.target.wants/firewalld.service.</span><br><span class="line">Removed symlink /etc/systemd/system/dbus-org.fedoraproject.FirewallD1.service.</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">停止防火墙</span></span><br><span class="line">[root@hadoop-104 module]# systemctl stop firewalld         </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">再次查看防火墙</span></span><br><span class="line">[root@hadoop-104 module]# systemctl list-unit-files|grep firewalld</span><br><span class="line">firewalld.service                             disabled</span><br><span class="line">[root@hadoop-104 module]# </span><br></pre></td></tr></tbody></table></figure>



<h3 id="3-查看命令的安装位置"><a href="#3-查看命令的安装位置" class="headerlink" title="3. 查看命令的安装位置"></a>3. 查看命令的安装位置</h3><p>whereis mysql：查看mysql的安装位置</p>
<h3 id="4-vscode中生成代码片段"><a href="#4-vscode中生成代码片段" class="headerlink" title="4. vscode中生成代码片段"></a>4. vscode中生成代码片段</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/image-20200425165814903.png" alt="image-20200425165814903"></p>
<p>新建一个全局的代码片段，名字为vue，然后回车：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/image-20200425165929332.png" alt="image-20200425165929332"></p>
<p>将下面的代码片段粘贴到“vue.code-snippets”</p>
<figure class="highlight json"><table><tbody><tr><td class="code"><pre><span class="line"><span class="punctuation">{</span></span><br><span class="line">    <span class="comment">// Place your 全局 snippets here. Each snippet is defined under a snippet name and has a scope, prefix, body and </span></span><br><span class="line">    <span class="comment">// description. Add comma separated ids of the languages where the snippet is applicable in the scope field. If scope </span></span><br><span class="line">    <span class="comment">// is left empty or omitted, the snippet gets applied to all languages. The prefix is what is </span></span><br><span class="line">    <span class="comment">// used to trigger the snippet and the body will be expanded and inserted. Possible variables are: </span></span><br><span class="line">    <span class="comment">// $1, $2 for tab stops, $0 for the final cursor position, and ${1:label}, ${2:another} for placeholders. </span></span><br><span class="line">    <span class="comment">// Placeholders with the same ids are connected.</span></span><br><span class="line">    <span class="comment">// Example:</span></span><br><span class="line">    <span class="comment">// "Print to console": {</span></span><br><span class="line">    <span class="comment">// 	"scope": "javascript,typescript",</span></span><br><span class="line">    <span class="comment">// 	"prefix": "log",</span></span><br><span class="line">    <span class="comment">// 	"body": [</span></span><br><span class="line">    <span class="comment">// 		"console.log('$1');",</span></span><br><span class="line">    <span class="comment">// 		"$2"</span></span><br><span class="line">    <span class="comment">// 	],</span></span><br><span class="line">    <span class="comment">// 	"description": "Log output to console"</span></span><br><span class="line">    <span class="comment">// }</span></span><br><span class="line">    <span class="attr">"生成vue模板"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">        <span class="attr">"prefix"</span><span class="punctuation">:</span> <span class="string">"vue"</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">"body"</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="string">"&lt;!-- $1 --&gt;"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">"&lt;template&gt;"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">"&lt;div class='$2'&gt;$5&lt;/div&gt;"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">"&lt;/template&gt;"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">""</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">"&lt;script&gt;"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">"//这里可以导入其他文件（比如：组件，工具js，第三方插件js，json文件，图片文件等等）"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">"//例如：import 《组件名称》 from '《组件路径》';"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">""</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">"export default {"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">"//import引入的组件需要注入到对象中才能使用"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">"components: {},"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">"data() {"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">"//这里存放数据"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">"return {"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">""</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">"};"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">"},"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">"//监听属性 类似于data概念"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">"computed: {},"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">"//监控data中的数据变化"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">"watch: {},"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">"//方法集合"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">"methods: {"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">""</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">"},"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">"//生命周期 - 创建完成（可以访问当前this实例）"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">"created() {"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">""</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">"},"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">"//生命周期 - 挂载完成（可以访问DOM元素）"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">"mounted() {"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">""</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">"},"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">"beforeCreate() {}, //生命周期 - 创建之前"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">"beforeMount() {}, //生命周期 - 挂载之前"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">"beforeUpdate() {}, //生命周期 - 更新之前"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">"updated() {}, //生命周期 - 更新之后"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">"beforeDestroy() {}, //生命周期 - 销毁之前"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">"destroyed() {}, //生命周期 - 销毁完成"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">"activated() {}, //如果页面有keep-alive缓存功能，这个函数会触发"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">"}"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">"&lt;/script&gt;"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">"&lt;style lang='scss' scoped&gt;"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">"//@import url($3); 引入公共css类"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">"$4"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">"&lt;/style&gt;"</span></span><br><span class="line">        <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">"description"</span><span class="punctuation">:</span> <span class="string">"生成VUE模板"</span></span><br><span class="line">    <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"http-get请求"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">        <span class="attr">"prefix"</span><span class="punctuation">:</span> <span class="string">"httpget"</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">"body"</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="string">"this.\\$http({"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">"url: this.\\$http.adornUrl(''),"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">"method: 'get',"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">"params: this.\\$http.adornParams({})"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">"}).then(({ data }) =&gt; {"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">"})"</span></span><br><span class="line">        <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">"description"</span><span class="punctuation">:</span> <span class="string">"httpGET请求"</span></span><br><span class="line">    <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"http-post请求"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">        <span class="attr">"prefix"</span><span class="punctuation">:</span> <span class="string">"httppost"</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">"body"</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="string">"this.\\$http({"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">"url: this.\\$http.adornUrl(''),"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">"method: 'post',"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">"data: this.\\$http.adornData(data, false)"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">"}).then(({ data }) =&gt; { });"</span></span><br><span class="line">        <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">"description"</span><span class="punctuation">:</span> <span class="string">"httpPOST请求"</span></span><br><span class="line">    <span class="punctuation">}</span></span><br><span class="line"><span class="punctuation">}</span></span><br></pre></td></tr></tbody></table></figure>

<p>更多详细说明见： <a target="_blank" rel="noopener" href="https://blog.csdn.net/z772330927/article/details/105730430/">https://blog.csdn.net/z772330927/article/details/105730430/</a> </p>
<h3 id="5-vscode快捷键"><a href="#5-vscode快捷键" class="headerlink" title="5. vscode快捷键"></a>5. vscode快捷键</h3><p>ctrl+shift+f 全局搜索</p>
<p>alt+shift+f 格式化代码</p>
<h3 id="6-关闭eslint的语法检查"><a href="#6-关闭eslint的语法检查" class="headerlink" title="6.  关闭eslint的语法检查"></a>6.  关闭eslint的语法检查</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/image-20200428171043110.png" alt="image-20200428171043110"></p>
<figure class="highlight json"><table><tbody><tr><td class="code"><pre><span class="line"></span><br></pre></td></tr></tbody></table></figure>



<h3 id="7-安装mybatisx插件"><a href="#7-安装mybatisx插件" class="headerlink" title="7. 安装mybatisx插件"></a>7. 安装mybatisx插件</h3><p>在Marketplace中搜索“mybatisx”，安装后重启IDEA，使用时会自动在@Mapper标注的接口上，产生小图标，然后alt+enter，generate statement，就会自动的在xml文件中生成SQL。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/1588730028929.png" alt="1588730028929"></p>
<h3 id="8-mysql的批量删除"><a href="#8-mysql的批量删除" class="headerlink" title="8. mysql的批量删除"></a>8. mysql的批量删除</h3><figure class="highlight sql"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span>  `pms_attr_attrgroup_relation` <span class="keyword">WHERE</span> (attr_id<span class="operator">=</span> ? <span class="keyword">AND</span> attr_group_id ) <span class="keyword">OR</span> (attr_id<span class="operator">=</span> ? <span class="keyword">AND</span> attr_group_id )</span><br></pre></td></tr></tbody></table></figure>



<h3 id="9-String-join"><a href="#9-String-join" class="headerlink" title="9. String.join"></a>9. String.join</h3><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">java.lang.String <span class="meta">@NotNull</span> </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">join</span><span class="params">(<span class="meta">@NotNull</span> CharSequence delimiter,</span></span><br><span class="line"><span class="params">                          <span class="meta">@NotNull</span> Iterable&lt;? extends CharSequence&gt; elements)</span></span><br></pre></td></tr></tbody></table></figure>

<p>Returns a new String composed of copies of the CharSequence elements joined together with a copy of the specified delimiter.</p>
<p> 返回一个由CharSequence元素的副本和指定分隔符的副本组成的新字符串。 </p>
<p>For example,</p>
<pre><code> List&lt;String&gt; strings = new LinkedList&lt;&gt;();
 strings.add("Java");strings.add("is");
 strings.add("cool");
 String message = String.join(" ", strings);
 //message returned is: "Java is cool"

 Set&lt;String&gt; strings = new LinkedHashSet&lt;&gt;();
 strings.add("Java"); strings.add("is");
 strings.add("very"); strings.add("cool");
 String message = String.join("-", strings);
 //message returned is: "Java-is-very-cool"
</code></pre>
<p>Note that if an individual element is null, then “null” is added.</p>
<p> 注意，如果单个元素为null，则添加“null”。 </p>
<p>Params:<br>delimiter – a sequence of characters that is used to separate each of the elements in the resulting String<br>               用于分隔结果字符串中的每个元素的字符序列 </p>
<p>elements – an Iterable that will have its elements joined together.<br>                  将其元素连接在一起的可迭代的。 </p>
<p>Returns:<br>a new String that is composed from the elements argument<br> 由elements参数组成的新字符串 </p>
<p>Throws:<br>NullPointerException – If delimiter or elements is null</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">join</span><span class="params">(CharSequence delimiter,</span></span><br><span class="line"><span class="params">        Iterable&lt;? extends CharSequence&gt; elements)</span> {</span><br><span class="line">    Objects.requireNonNull(delimiter);</span><br><span class="line">    Objects.requireNonNull(elements);</span><br><span class="line">    <span class="type">StringJoiner</span> <span class="variable">joiner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringJoiner</span>(delimiter);</span><br><span class="line">    <span class="keyword">for</span> (CharSequence cs: elements) {</span><br><span class="line">        joiner.add(cs);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> joiner.toString();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>能够看到实际上它就是通过创建StringJoiner，然后遍历elements，加入每个元素来完成的。</p>
<p>StringJoiner</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">java.util <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">StringJoiner</span></span><br><span class="line"><span class="keyword">extends</span> <span class="title class_">Object</span></span><br></pre></td></tr></tbody></table></figure>

<p>StringJoiner is used to construct a sequence of characters separated by a delimiter and optionally starting with a supplied prefix and ending with a supplied suffix.<br> tringJoiner用于构造由分隔符分隔的字符序列，可以选择以提供的前缀开始，以提供的后缀结束。 </p>
<p>Prior to adding something to the StringJoiner, its sj.toString() method will, by default, return prefix + suffix. However, if the setEmptyValue method is called, the emptyValue supplied will be returned instead. This can be used, for example, when creating a string using set notation to indicate an empty set, i.e. “{}”, where the prefix is “{“, the suffix is “}” and nothing has been added to the StringJoiner.<br> 在向StringJoiner添加内容之前，它的sj.toString()方法在默认情况下会返回前缀+后缀。但是，如果调用setEmptyValue方法，则返回所提供的emptyValue。例如，当使用set符号创建一个字符串来表示一个空集时，可以使用这种方法。“{}”，其中前缀是“{”，后缀是“}”，没有向StringJoiner添加任何内容。 </p>
<p>apiNote:<br>The String “[George:Sally:Fred]” may be constructed as follows:</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="type">StringJoiner</span> <span class="variable">sj</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringJoiner</span>(<span class="string">":"</span>, <span class="string">"["</span>, <span class="string">"]"</span>);</span><br><span class="line">sj.add(<span class="string">"George"</span>).add(<span class="string">"Sally"</span>).add(<span class="string">"Fred"</span>);</span><br><span class="line"><span class="type">String</span> <span class="variable">desiredString</span> <span class="operator">=</span> sj.toString();</span><br></pre></td></tr></tbody></table></figure>

<p>A StringJoiner may be employed to create formatted output from a java.util.stream.Stream using java.util.stream.Collectors.joining(CharSequence). For example:<br> 使用StringJoiner从java.util.stream创建格式化输出流，使用java.util.stream.Collectors.joining (CharSequence进行)。例如: </p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">List&lt;Integer&gt; numbers = Arrays.asList(1, 2, 3, 4);</span><br><span class="line">String commaSeparatedNumbers = numbers.stream()</span><br><span class="line">    .map(i -&gt; i.toString())</span><br><span class="line">    .collect(Collectors.joining(", "));</span><br></pre></td></tr></tbody></table></figure>



<p>通过分析源码发现，在“”内部维护了一个StringBuilder，所有加入到它内部的元素都会先拼接上分割符，然后再拼接上加入的元素</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> StringJoiner <span class="title function_">add</span><span class="params">(CharSequence newElement)</span> {</span><br><span class="line">       prepareBuilder().append(newElement);</span><br><span class="line">       <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>



<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> StringBuilder <span class="title function_">prepareBuilder</span><span class="params">()</span> {</span><br><span class="line">     <span class="keyword">if</span> (value != <span class="literal">null</span>) {</span><br><span class="line">         value.append(delimiter);</span><br><span class="line">     } <span class="keyword">else</span> {</span><br><span class="line">         value = <span class="keyword">new</span> <span class="title class_">StringBuilder</span>().append(prefix);</span><br><span class="line">     }</span><br><span class="line">     <span class="keyword">return</span> value;</span><br><span class="line"> }</span><br></pre></td></tr></tbody></table></figure>





<h3 id="10-在Service中微服务比较多的时候，可以配置将一些微服务放置到compound中，组成一个小组"><a href="#10-在Service中微服务比较多的时候，可以配置将一些微服务放置到compound中，组成一个小组" class="headerlink" title="10. 在Service中微服务比较多的时候，可以配置将一些微服务放置到compound中，组成一个小组"></a>10. 在Service中微服务比较多的时候，可以配置将一些微服务放置到compound中，组成一个小组</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/image-20200508222508833.png" alt="image-20200508222508833"></p>
<p>以后再运行时，直接选择这个compound即可很方便的运行或停止一组微服务：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/image-20200508223524543.png" alt="image-20200508223524543"></p>
<p>另外可以单独为每个微服务，设置需要的运行时最大堆内存大小：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/IDE/image-20200508222812353.png" alt="image-20200508222812353"></p>
<h3 id="11-mysql的dateTime和timestamp的区别？"><a href="#11-mysql的dateTime和timestamp的区别？" class="headerlink" title="11. mysql的dateTime和timestamp的区别？"></a>11. mysql的dateTime和timestamp的区别？</h3><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/mxwz/p/7520309.html">MySQL中datetime和timestamp的区别及使用</a></p>
<p><strong>TIMESTAMP和DATETIME的相同点：</strong></p>
<p>1&gt; 两者都可用来表示YYYY-MM-DD HH:MM:SS[.fraction]类型的日期。</p>
<p><strong>TIMESTAMP和DATETIME的不同点：</strong></p>
<p>1&gt; 两者的存储方式不一样</p>
<p>对于TIMESTAMP，它把客户端插入的时间从当前时区转化为UTC（世界标准时间）进行存储。查询时，将其又转化为客户端当前时区进行返回。</p>
<p>而对于DATETIME，不做任何改变，基本上是原样输入和输出。</p>
<p>2&gt; 两者所能存储的时间范围不一样</p>
<p>timestamp所能存储的时间范围为：’1970-01-01 00:00:01.000000’ 到 ‘2038-01-19 03:14:07.999999’。</p>
<p>datetime所能存储的时间范围为：’1000-01-01 00:00:00.000000’ 到 ‘9999-12-31 23:59:59.999999’。</p>
<p>总结：TIMESTAMP和DATETIME除了存储范围和存储方式不一样，没有太大区别。当然，对于跨时区的业务，TIMESTAMP更为合适。</p>
<p> <a target="_blank" rel="noopener" href="https://www.cnblogs.com/Jashinck/p/10472398.html">https://www.cnblogs.com/Jashinck/p/10472398.html</a> </p>
<h3 id="12-SpringBoot中的事务"><a href="#12-SpringBoot中的事务" class="headerlink" title="12. SpringBoot中的事务"></a>12. SpringBoot中的事务</h3><p> <a target="_blank" rel="noopener" href="https://blog.csdn.net/Z__Sheng/article/details/89489053">https://blog.csdn.net/Z__Sheng/article/details/89489053</a> </p>
<h3 id="13-IDEA-RESTFUll-clinet"><a href="#13-IDEA-RESTFUll-clinet" class="headerlink" title="13. IDEA RESTFUll clinet"></a>13. IDEA RESTFUll clinet</h3><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_37502106/article/details/103183492">IntelliJ IDEA 使用 rest client</a></p>
<h3 id="-1"><a href="#-1" class="headerlink" title=""></a></h3><h2 id="FAQ"><a href="#FAQ" class="headerlink" title="FAQ"></a>FAQ</h2><h3 id="1-TypeError-vm-previewHandle-is-not-a-function"><a href="#1-TypeError-vm-previewHandle-is-not-a-function" class="headerlink" title="1. TypeError: _vm.previewHandle is not a function"></a>1. TypeError: _vm.previewHandle is not a function</h3></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://risingrode.github.io">fcw</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://risingrode.github.io/post/%E9%A1%B9%E7%9B%AE/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E2%80%94%E5%88%86%E5%B8%83%E5%BC%8F%E5%9F%BA%E7%A1%80.html">https://risingrode.github.io/post/项目/谷粒商城/谷粒商城—分布式基础.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://risingrode.github.io" target="_blank">代码有点萌</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E-%E5%9F%BA%E7%A1%80%E7%AF%87/">谷粒商城-基础篇</a></div><div class="post_share"><div class="social-share" data-image="https://i0.hippopx.com/photos/356/657/107/beach-beverage-caribbean-cocktail-thumb.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer=""></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.jpg" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/wechat.jpg" alt="微信"></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/alipay.jpg" alt="支付宝"></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/post/%E9%A1%B9%E7%9B%AE/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E2%80%94%E5%88%86%E5%B8%83%E5%BC%8F%E9%AB%98%E7%BA%A7.html" title="谷粒商城-高级篇"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://i0.hippopx.com/photos/356/657/107/beach-beverage-caribbean-cocktail-thumb.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">谷粒商城-高级篇</div></div></a></div><div class="next-post pull-right"><a href="/post/%E5%B7%A5%E5%85%B7%E8%AF%AD%E6%B3%95/IDE.html" title="IDE"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s2.loli.net/2023/08/05/xzsJhrp9ZSHT1AV.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">IDE</div></div></a></div></nav><hr><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div><div id="comment-switch"><span class="first-comment">Valine</span><span class="switch-btn"></span><span class="second-comment">Disqus</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div><div><div id="disqus_thread"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/girl.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"></div><div class="author-info__name">fcw</div><div class="author-info__description">一个收藏回忆与分享技术的地方！</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">93</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">75</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">41</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Risingrode"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">欢迎来到cwRising的博客</div></div><div class="card-widget"><div class="item-headline"><i></i><span></span></div><div class="item-content"></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E6%95%B4%E4%BD%93%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.</span> <span class="toc-text">1. 整体介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%EF%BC%89%E5%AE%89%E8%A3%85vagrant"><span class="toc-number">1.1.</span> <span class="toc-text">1）安装vagrant</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%EF%BC%89%E5%AE%89%E8%A3%85Centos7"><span class="toc-number">1.2.</span> <span class="toc-text">2）安装Centos7</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-docker%E4%B8%AD%E5%AE%89%E8%A3%85mysql"><span class="toc-number">2.</span> <span class="toc-text">2. docker中安装mysql</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-docker%E4%B8%AD%E5%AE%89%E8%A3%85redis"><span class="toc-number">3.</span> <span class="toc-text">3. docker中安装redis</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E5%88%9B%E5%BB%BAmaven%E5%B7%A5%E7%A8%8B"><span class="toc-number">4.</span> <span class="toc-text">4. 创建maven工程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E6%89%A7%E8%A1%8Csql%E8%84%9A%E6%9C%AC"><span class="toc-number">5.</span> <span class="toc-text">5. 执行sql脚本</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-clone-%E4%BA%BA%E4%BA%BA%E5%BC%80%E6%BA%90"><span class="toc-number">6.</span> <span class="toc-text">6. clone 人人开源</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-clone-renren-generator"><span class="toc-number">7.</span> <span class="toc-text">7. clone renren-generator</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#clone"><span class="toc-number">7.1.</span> <span class="toc-text">clone</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E9%85%8D%E7%BD%AE"><span class="toc-number">7.2.</span> <span class="toc-text">修改配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%90%E8%A1%8C%E2%80%9Crenren-generator%E2%80%9D"><span class="toc-number">7.3.</span> <span class="toc-text">运行“renren-generator”</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83"><span class="toc-number">8.</span> <span class="toc-text">8. 微服务注册中心</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-%E4%BD%BF%E7%94%A8openfen"><span class="toc-number">9.</span> <span class="toc-text">9. 使用openfen</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83"><span class="toc-number">10.</span> <span class="toc-text">10. 配置中心</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%EF%BC%89%E4%BF%AE%E6%94%B9%E2%80%9Cgulimall-coupon%E2%80%9D%E6%A8%A1%E5%9D%97"><span class="toc-number">10.1.</span> <span class="toc-text">1）修改“gulimall-coupon”模块</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%EF%BC%89%E4%BC%A0%E7%BB%9F%E6%96%B9%E5%BC%8F"><span class="toc-number">10.2.</span> <span class="toc-text">2）传统方式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%EF%BC%89nacos-config"><span class="toc-number">10.3.</span> <span class="toc-text">3）nacos config</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%EF%BC%89Nacos%E6%94%AF%E6%8C%81%E4%B8%89%E7%A7%8D%E9%85%8D%E7%BD%AE%E5%8A%A0%E8%BD%BD%E6%96%B9%E6%96%B9%E6%A1%88"><span class="toc-number">10.4.</span> <span class="toc-text">4）Nacos支持三种配置加载方方案</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Namespace%E6%96%B9%E6%A1%88"><span class="toc-number">10.4.0.1.</span> <span class="toc-text">Namespace方案</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#DataID%E6%96%B9%E6%A1%88"><span class="toc-number">10.4.0.2.</span> <span class="toc-text">DataID方案</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Group%E6%96%B9%E6%A1%88"><span class="toc-number">10.4.0.3.</span> <span class="toc-text">Group方案</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%EF%BC%89%E5%90%8C%E6%97%B6%E5%8A%A0%E8%BD%BD%E5%A4%9A%E4%B8%AA%E9%85%8D%E7%BD%AE%E9%9B%86"><span class="toc-number">10.5.</span> <span class="toc-text">5）同时加载多个配置集</span></a></li></ol><li class="toc-item toc-level-2"><a class="toc-link" href="#11-%E7%BD%91%E5%85%B3"><span class="toc-number">11.</span> <span class="toc-text">11. 网关</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E6%B3%A8%E5%86%8C%E2%80%9Cgulimall-gateway%E2%80%9D%E5%88%B0Nacos"><span class="toc-number">11.1.</span> <span class="toc-text">1、注册“gulimall-gateway”到Nacos</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%EF%BC%89%E5%88%9B%E5%BB%BA%E2%80%9Cgulimall-gateway%E2%80%9D"><span class="toc-number">11.1.1.</span> <span class="toc-text">1）创建“gulimall-gateway”</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%EF%BC%89%E6%B7%BB%E5%8A%A0%E2%80%9Cgulimall-common%E2%80%9D%E4%BE%9D%E8%B5%96%E5%92%8C%E2%80%9Cspring-cloud-starter-gateway%E2%80%9D%E4%BE%9D%E8%B5%96"><span class="toc-number">11.1.2.</span> <span class="toc-text">2）添加“gulimall-common”依赖和“spring-cloud-starter-gateway”依赖</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3%EF%BC%89%E2%80%9Ccom-bigdata-gulimall-gulimallgateway-GulimallGatewayApplication%E2%80%9D%E7%B1%BB%E4%B8%8A%E5%8A%A0%E4%B8%8A%E2%80%9C-EnableDiscoveryClient%E2%80%9D%E6%B3%A8%E8%A7%A3"><span class="toc-number">11.1.3.</span> <span class="toc-text">3）“com.bigdata.gulimall.gulimallgateway.GulimallGatewayApplication”类上加上“@EnableDiscoveryClient”注解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4%EF%BC%89%E5%9C%A8Nacos%E4%B8%AD%E5%88%9B%E5%BB%BA%E2%80%9Cgateway%E2%80%9D%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4%EF%BC%8C%E5%90%8C%E6%97%B6%E5%9C%A8%E8%AF%A5%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4%E4%B8%AD%E5%88%9B%E5%BB%BA%E2%80%9Cgulimall-gateway-yml%E2%80%9D"><span class="toc-number">11.1.4.</span> <span class="toc-text">4）在Nacos中创建“gateway”命名空间，同时在该命名空间中创建“gulimall-gateway.yml”</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5%EF%BC%89%E5%88%9B%E5%BB%BA%E2%80%9Cbootstrap-properties%E2%80%9D%E6%96%87%E4%BB%B6%EF%BC%8C%E6%B7%BB%E5%8A%A0%E5%A6%82%E4%B8%8B%E9%85%8D%E7%BD%AE%EF%BC%8C%E6%8C%87%E6%98%8E%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83%E5%9C%B0%E5%9D%80%E5%92%8C%E6%89%80%E5%B1%9E%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4"><span class="toc-number">11.1.5.</span> <span class="toc-text">5）创建“bootstrap.properties”文件，添加如下配置，指明配置中心地址和所属命名空间</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6%EF%BC%89%E5%88%9B%E5%BB%BA%E2%80%9Capplication-properties%E2%80%9D%E6%96%87%E4%BB%B6%EF%BC%8C%E6%8C%87%E5%AE%9A%E6%9C%8D%E5%8A%A1%E5%90%8D%E5%92%8C%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83%E5%9C%B0%E5%9D%80"><span class="toc-number">11.1.6.</span> <span class="toc-text">6）创建“application.properties”文件，指定服务名和注册中心地址</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7%EF%BC%89%E5%90%AF%E5%8A%A8%E2%80%9Cgulimall-gateway%E2%80%9D"><span class="toc-number">11.1.7.</span> <span class="toc-text">7）启动“gulimall-gateway”</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E6%A1%88%E4%BE%8B"><span class="toc-number">11.2.</span> <span class="toc-text">2、案例</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%EF%BC%89%E5%88%9B%E5%BB%BA%E2%80%9Capplication-yml%E2%80%9D"><span class="toc-number">11.2.1.</span> <span class="toc-text">1）创建“application.yml”</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%EF%BC%89%E5%90%AF%E5%8A%A8%E2%80%9Cgulimall-gateway%E2%80%9D"><span class="toc-number">11.2.2.</span> <span class="toc-text">2）启动“gulimall-gateway”</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3%EF%BC%89%E6%B5%8B%E8%AF%95"><span class="toc-number">11.2.3.</span> <span class="toc-text">3）测试</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12-Vue"><span class="toc-number">12.</span> <span class="toc-text">12. Vue</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81vue%E5%A3%B0%E6%98%8E%E5%BC%8F%E6%B8%B2%E6%9F%93"><span class="toc-number">12.1.</span> <span class="toc-text">1、vue声明式渲染</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E5%8F%8C%E5%90%91%E7%BB%91%E5%AE%9A-%E6%A8%A1%E5%9E%8B%E5%8F%98%E5%8C%96%EF%BC%8C%E8%A7%86%E5%9B%BE%E5%8F%98%E5%8C%96%E3%80%82%E5%8F%8D%E4%B9%8B%E4%BA%A6%E7%84%B6"><span class="toc-number">12.2.</span> <span class="toc-text">2、双向绑定,模型变化，视图变化。反之亦然</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86"><span class="toc-number">12.3.</span> <span class="toc-text">3、事件处理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81v-bind-%E5%8D%95%E5%90%91%E7%BB%91%E5%AE%9A"><span class="toc-number">12.4.</span> <span class="toc-text">4、v-bind :单向绑定</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%E3%80%81v-model%E5%8F%8C%E5%90%91%E7%BB%91%E5%AE%9A"><span class="toc-number">12.5.</span> <span class="toc-text">5、v-model双向绑定</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6%E3%80%81v-on%E4%B8%BA%E6%8C%89%E9%92%AE%E7%BB%91%E5%AE%9A%E4%BA%8B%E4%BB%B6"><span class="toc-number">12.6.</span> <span class="toc-text">6、v-on为按钮绑定事件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7%E3%80%81v-for%E9%81%8D%E5%8E%86%E5%BE%AA%E7%8E%AF"><span class="toc-number">12.7.</span> <span class="toc-text">7、v-for遍历循环</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="toc-number">12.8.</span> <span class="toc-text">过滤器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%84%E4%BB%B6%E5%8C%96"><span class="toc-number">12.9.</span> <span class="toc-text">组件化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E9%92%A9%E5%AD%90%E5%87%BD%E6%95%B0"><span class="toc-number">12.10.</span> <span class="toc-text">生命周期钩子函数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#13-element-ui"><span class="toc-number">13.</span> <span class="toc-text">13. element ui</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-number">13.1.</span> <span class="toc-text"></span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#14-%E9%80%92%E5%BD%92%E6%A0%91%E5%BD%A2%E7%BB%93%E6%9E%84%E8%8E%B7%E5%8F%96%E6%95%B0%E6%8D%AE"><span class="toc-number">14.</span> <span class="toc-text">14. 递归树形结构获取数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#15-%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE"><span class="toc-number">15.</span> <span class="toc-text">15. 删除数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#16-%E8%8F%9C%E5%8D%95%E6%8B%96%E5%8A%A8"><span class="toc-number">16.</span> <span class="toc-text">16. 菜单拖动</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8B%96%E5%8A%A8%E8%8F%9C%E5%8D%95%E6%97%B6%E9%9C%80%E8%A6%81%E4%BF%AE%E6%94%B9%E9%A1%BA%E5%BA%8F%E5%92%8C%E7%BA%A7%E5%88%AB"><span class="toc-number">16.1.</span> <span class="toc-text">拖动菜单时需要修改顺序和级别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E8%8F%9C%E5%8D%95%E6%8B%96%E5%8A%A8%E5%BC%80%E5%85%B3"><span class="toc-number">16.2.</span> <span class="toc-text">设置菜单拖动开关</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%B9%E9%87%8F%E5%88%A0%E9%99%A4"><span class="toc-number">16.3.</span> <span class="toc-text">批量删除</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#17-%E5%93%81%E7%89%8C%E7%AE%A1%E7%90%86%E8%8F%9C%E5%8D%95"><span class="toc-number">17.</span> <span class="toc-text">17. 品牌管理菜单</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E2%80%9C%E6%98%BE%E7%A4%BA%E7%8A%B6%E6%80%81%E6%8C%89%E9%92%AE%E2%80%9D"><span class="toc-number">17.1.</span> <span class="toc-text">添加“显示状态按钮”</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E4%B8%8A%E4%BC%A0"><span class="toc-number">17.2.</span> <span class="toc-text">添加上传</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%EF%BC%89%E6%B7%BB%E5%8A%A0%E4%BE%9D%E8%B5%96%E5%8C%85"><span class="toc-number">17.2.1.</span> <span class="toc-text">1）添加依赖包</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%EF%BC%89%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6%E6%B5%81"><span class="toc-number">17.2.2.</span> <span class="toc-text">2）上传文件流</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E6%96%B9%E5%BC%8F"><span class="toc-number">17.3.</span> <span class="toc-text">其他方式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%EF%BC%89%E6%96%B0%E5%BB%BAgulimall-third-party"><span class="toc-number">17.3.1.</span> <span class="toc-text">1）新建gulimall-third-party</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%EF%BC%89%E6%B7%BB%E5%8A%A0%E4%BE%9D%E8%B5%96%EF%BC%8C%E5%B0%86%E5%8E%9F%E6%9D%A5gulimall-common%E4%B8%AD%E7%9A%84%E2%80%9Cspring-cloud-starter-alicloud-oss%E2%80%9D%E4%BE%9D%E8%B5%96%E7%A7%BB%E5%8A%A8%E5%88%B0%E8%AF%A5%E9%A1%B9%E7%9B%AE%E4%B8%AD"><span class="toc-number">17.3.2.</span> <span class="toc-text">2）添加依赖，将原来gulimall-common中的“spring-cloud-starter-alicloud-oss”依赖移动到该项目中</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3%EF%BC%89%E5%9C%A8%E4%B8%BB%E5%90%AF%E5%8A%A8%E7%B1%BB%E4%B8%AD%E5%BC%80%E5%90%AF%E6%9C%8D%E5%8A%A1%E7%9A%84%E6%B3%A8%E5%86%8C%E5%92%8C%E5%8F%91%E7%8E%B0"><span class="toc-number">17.3.3.</span> <span class="toc-text">3）在主启动类中开启服务的注册和发现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4%EF%BC%89%E5%9C%A8nacos%E4%B8%AD%E6%B3%A8%E5%86%8C"><span class="toc-number">17.3.4.</span> <span class="toc-text">4）在nacos中注册</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5%EF%BC%89%E7%BC%96%E5%86%99%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">17.3.5.</span> <span class="toc-text">5）编写配置文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6%EF%BC%89-%E7%BC%96%E5%86%99%E6%B5%8B%E8%AF%95%E7%B1%BB"><span class="toc-number">17.3.6.</span> <span class="toc-text">6） 编写测试类</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8A%E4%BC%A0%E7%BB%84%E4%BB%B6"><span class="toc-number">17.4.</span> <span class="toc-text">上传组件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#18-JSR303%E6%A0%A1%E9%AA%8C"><span class="toc-number">18.</span> <span class="toc-text">18. JSR303校验</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A41%EF%BC%9A%E4%BD%BF%E7%94%A8%E6%A0%A1%E9%AA%8C%E6%B3%A8%E8%A7%A3"><span class="toc-number">18.1.</span> <span class="toc-text">步骤1：使用校验注解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A42%EF%BC%9A%E5%9C%A8%E8%AF%B7%E6%B1%82%E6%96%B9%E6%B3%95%E7%A7%8D%EF%BC%8C%E4%BD%BF%E7%94%A8%E6%A0%A1%E9%AA%8C%E6%B3%A8%E8%A7%A3-Valid%EF%BC%8C%E5%BC%80%E5%90%AF%E6%A0%A1%E9%AA%8C%EF%BC%8C"><span class="toc-number">18.2.</span> <span class="toc-text">步骤2：在请求方法种，使用校验注解@Valid，开启校验，</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A43%EF%BC%9A%E7%BB%99%E6%A0%A1%E9%AA%8C%E7%9A%84Bean%E5%90%8E%EF%BC%8C%E7%B4%A7%E8%B7%9F%E4%B8%80%E4%B8%AABindResult%EF%BC%8C%E5%B0%B1%E5%8F%AF%E4%BB%A5%E8%8E%B7%E5%8F%96%E5%88%B0%E6%A0%A1%E9%AA%8C%E7%9A%84%E7%BB%93%E6%9E%9C%E3%80%82%E6%8B%BF%E5%88%B0%E6%A0%A1%E9%AA%8C%E7%9A%84%E7%BB%93%E6%9E%9C%EF%BC%8C%E5%B0%B1%E5%8F%AF%E4%BB%A5%E8%87%AA%E5%AE%9A%E4%B9%89%E7%9A%84%E5%B0%81%E8%A3%85%E3%80%82"><span class="toc-number">18.3.</span> <span class="toc-text">步骤3：给校验的Bean后，紧跟一个BindResult，就可以获取到校验的结果。拿到校验的结果，就可以自定义的封装。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A44%EF%BC%9A%E7%BB%9F%E4%B8%80%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86"><span class="toc-number">18.4.</span> <span class="toc-text">步骤4：统一异常处理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#19-%E5%88%86%E7%BB%84%E6%A0%A1%E9%AA%8C%E5%8A%9F%E8%83%BD%EF%BC%88%E5%AE%8C%E6%88%90%E5%A4%9A%E5%9C%BA%E6%99%AF%E7%9A%84%E5%A4%8D%E6%9D%82%E6%A0%A1%E9%AA%8C%EF%BC%89"><span class="toc-number">19.</span> <span class="toc-text">19. 分组校验功能（完成多场景的复杂校验）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E7%BB%99%E6%A0%A1%E9%AA%8C%E6%B3%A8%E8%A7%A3%EF%BC%8C%E6%A0%87%E6%B3%A8%E4%B8%8Agroups%EF%BC%8C%E6%8C%87%E5%AE%9A%E4%BB%80%E4%B9%88%E6%83%85%E5%86%B5%E4%B8%8B%E6%89%8D%E9%9C%80%E8%A6%81%E8%BF%9B%E8%A1%8C%E6%A0%A1%E9%AA%8C"><span class="toc-number">19.1.</span> <span class="toc-text">1、给校验注解，标注上groups，指定什么情况下才需要进行校验</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E4%B8%9A%E5%8A%A1%E6%96%B9%E6%B3%95%E5%8F%82%E6%95%B0%E4%B8%8A%E4%BD%BF%E7%94%A8-Validated%E6%B3%A8%E8%A7%A3"><span class="toc-number">19.2.</span> <span class="toc-text">2、业务方法参数上使用@Validated注解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E9%BB%98%E8%AE%A4%E6%83%85%E5%86%B5%E4%B8%8B%EF%BC%8C%E5%9C%A8%E5%88%86%E7%BB%84%E6%A0%A1%E9%AA%8C%E6%83%85%E5%86%B5%E4%B8%8B%EF%BC%8C%E6%B2%A1%E6%9C%89%E6%8C%87%E5%AE%9A%E6%8C%87%E5%AE%9A%E5%88%86%E7%BB%84%E7%9A%84%E6%A0%A1%E9%AA%8C%E6%B3%A8%E8%A7%A3%EF%BC%8C%E5%B0%86%E4%B8%8D%E4%BC%9A%E7%94%9F%E6%95%88%EF%BC%8C%E5%AE%83%E5%8F%AA%E4%BC%9A%E5%9C%A8%E4%B8%8D%E5%88%86%E7%BB%84%E7%9A%84%E6%83%85%E5%86%B5%E4%B8%8B%E7%94%9F%E6%95%88%E3%80%82"><span class="toc-number">19.3.</span> <span class="toc-text">3、默认情况下，在分组校验情况下，没有指定指定分组的校验注解，将不会生效，它只会在不分组的情况下生效。</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#20-%E8%87%AA%E5%AE%9A%E4%B9%89%E6%A0%A1%E9%AA%8C%E5%8A%9F%E8%83%BD"><span class="toc-number">20.</span> <span class="toc-text">20. 自定义校验功能</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E7%BC%96%E5%86%99%E4%B8%80%E4%B8%AA%E8%87%AA%E5%AE%9A%E4%B9%89%E7%9A%84%E6%A0%A1%E9%AA%8C%E6%B3%A8%E8%A7%A3"><span class="toc-number">20.1.</span> <span class="toc-text">1、编写一个自定义的校验注解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E7%BC%96%E5%86%99%E4%B8%80%E4%B8%AA%E8%87%AA%E5%AE%9A%E4%B9%89%E7%9A%84%E6%A0%A1%E9%AA%8C%E5%99%A8"><span class="toc-number">20.2.</span> <span class="toc-text">2、编写一个自定义的校验器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E5%85%B3%E8%81%94%E8%87%AA%E5%AE%9A%E4%B9%89%E7%9A%84%E6%A0%A1%E9%AA%8C%E5%99%A8%E5%92%8C%E8%87%AA%E5%AE%9A%E4%B9%89%E7%9A%84%E6%A0%A1%E9%AA%8C%E6%B3%A8%E8%A7%A3"><span class="toc-number">20.3.</span> <span class="toc-text">3、关联自定义的校验器和自定义的校验注解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81%E4%BD%BF%E7%94%A8%E5%AE%9E%E4%BE%8B"><span class="toc-number">20.4.</span> <span class="toc-text">4、使用实例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#21-%E5%95%86%E5%93%81SPU%E5%92%8CSKU%E7%AE%A1%E7%90%86"><span class="toc-number">21.</span> <span class="toc-text">21. 商品SPU和SKU管理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#22-%E7%82%B9%E5%87%BB%E5%AD%90%E7%BB%84%E4%BB%B6%EF%BC%8C%E7%88%B6%E7%BB%84%E4%BB%B6%E8%A7%A6%E5%8F%91%E4%BA%8B%E4%BB%B6"><span class="toc-number">22.</span> <span class="toc-text">22. 点击子组件，父组件触发事件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#23-%E8%A7%84%E6%A0%BC%E5%8F%82%E6%95%B0%E6%96%B0%E5%A2%9E%E4%B8%8EVO"><span class="toc-number">23.</span> <span class="toc-text">23. 规格参数新增与VO</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#24-%E6%9F%A5%E8%AF%A2%E5%88%86%E7%BB%84%E5%85%B3%E8%81%94%E5%B1%9E%E6%80%A7%E5%92%8C%E5%88%A0%E9%99%A4%E5%85%B3%E8%81%94"><span class="toc-number">24.</span> <span class="toc-text">24. 查询分组关联属性和删除关联</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#25-%E6%9F%A5%E8%AF%A2%E5%88%86%E7%BB%84%E6%9C%AA%E5%85%B3%E8%81%94%E7%9A%84%E5%B1%9E%E6%80%A7"><span class="toc-number">25.</span> <span class="toc-text">25. 查询分组未关联的属性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#26-%E6%B7%BB%E5%8A%A0%E5%B1%9E%E6%80%A7%E5%92%8C%E5%88%86%E7%BB%84%E7%9A%84%E5%85%B3%E8%81%94%E5%85%B3%E7%B3%BB"><span class="toc-number">26.</span> <span class="toc-text">26. 添加属性和分组的关联关系</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#27-%E5%8F%91%E5%B8%83%E5%95%86%E5%93%81"><span class="toc-number">27.</span> <span class="toc-text">27. 发布商品</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#28-%E5%95%86%E5%93%81%E7%AE%A1%E7%90%86"><span class="toc-number">28.</span> <span class="toc-text">28. 商品管理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#29-%E4%BB%93%E5%BA%93%E7%AE%A1%E7%90%86"><span class="toc-number">29.</span> <span class="toc-text">29. 仓库管理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#30-%E8%8E%B7%E5%8F%96spu%E8%A7%84%E6%A0%BC"><span class="toc-number">30.</span> <span class="toc-text">30. 获取spu规格</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#31-%E4%BF%AE%E6%94%B9%E5%95%86%E5%93%81%E8%A7%84%E6%A0%BC"><span class="toc-number">31.</span> <span class="toc-text">31. 修改商品规格</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%8F%E7%BB%93%EF%BC%9A"><span class="toc-number">32.</span> <span class="toc-text">小结：</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%9C%A8open-fen%E4%B8%AD%E4%BC%9A%E5%B0%86%E8%B0%83%E7%94%A8%E7%9A%84%E6%95%B0%E6%8D%AE%E8%BD%AC%E6%8D%A2%E4%B8%BAJSON%EF%BC%8C%E6%8E%A5%E6%94%B6%E6%96%B9%E6%8E%A5%E6%94%B6%E5%90%8E%EF%BC%8C%E5%B0%86JSON%E8%BD%AC%E6%8D%A2%E4%B8%BA%E5%AF%B9%E8%B1%A1%EF%BC%8C%E6%AD%A4%E6%97%B6%E8%B0%83%E7%94%A8%E6%96%B9%E5%92%8C%E8%A2%AB%E8%B0%83%E7%94%A8%E6%96%B9%E7%9A%84%E5%A4%84%E7%90%86JSON%E7%9A%84%E5%AF%B9%E8%B1%A1%E4%B8%8D%E4%B8%80%E5%AE%9A%E9%83%BD%E6%98%AF%E5%90%8C%E4%B8%80%E4%B8%AA%E7%B1%BB%EF%BC%8C%E5%8F%AA%E8%A6%81%E5%AE%83%E4%BB%AC%E7%9A%84%E5%AD%97%E6%AE%B5%E7%B1%BB%E5%9E%8B%E5%90%BB%E5%90%88%E5%8D%B3%E5%8F%AF%E3%80%82"><span class="toc-number">32.1.</span> <span class="toc-text">1.  在open fen中会将调用的数据转换为JSON，接收方接收后，将JSON转换为对象，此时调用方和被调用方的处理JSON的对象不一定都是同一个类，只要它们的字段类型吻合即可。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E4%BA%8B%E5%8A%A1%E7%A9%B6%E7%AB%9F%E8%A6%81%E5%A6%82%E4%BD%95%E5%8A%A0%E4%B8%8A%EF%BC%9F"><span class="toc-number">32.2.</span> <span class="toc-text">2. 事务究竟要如何加上？</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B6%E4%BB%96"><span class="toc-number">33.</span> <span class="toc-text">其他</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%96%87%E6%A1%A3%E5%8F%82%E8%80%83%E5%9C%B0%E5%9D%80"><span class="toc-number">33.1.</span> <span class="toc-text">1. 文档参考地址</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%BC%80%E6%9C%BA%E5%90%AF%E5%8A%A8docker"><span class="toc-number">33.2.</span> <span class="toc-text">2. 开机启动docker</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E6%9F%A5%E7%9C%8B%E5%91%BD%E4%BB%A4%E7%9A%84%E5%AE%89%E8%A3%85%E4%BD%8D%E7%BD%AE"><span class="toc-number">33.3.</span> <span class="toc-text">3. 查看命令的安装位置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-vscode%E4%B8%AD%E7%94%9F%E6%88%90%E4%BB%A3%E7%A0%81%E7%89%87%E6%AE%B5"><span class="toc-number">33.4.</span> <span class="toc-text">4. vscode中生成代码片段</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-vscode%E5%BF%AB%E6%8D%B7%E9%94%AE"><span class="toc-number">33.5.</span> <span class="toc-text">5. vscode快捷键</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%E5%85%B3%E9%97%ADeslint%E7%9A%84%E8%AF%AD%E6%B3%95%E6%A3%80%E6%9F%A5"><span class="toc-number">33.6.</span> <span class="toc-text">6.  关闭eslint的语法检查</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-%E5%AE%89%E8%A3%85mybatisx%E6%8F%92%E4%BB%B6"><span class="toc-number">33.7.</span> <span class="toc-text">7. 安装mybatisx插件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-mysql%E7%9A%84%E6%89%B9%E9%87%8F%E5%88%A0%E9%99%A4"><span class="toc-number">33.8.</span> <span class="toc-text">8. mysql的批量删除</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-String-join"><span class="toc-number">33.9.</span> <span class="toc-text">9. String.join</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-%E5%9C%A8Service%E4%B8%AD%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%AF%94%E8%BE%83%E5%A4%9A%E7%9A%84%E6%97%B6%E5%80%99%EF%BC%8C%E5%8F%AF%E4%BB%A5%E9%85%8D%E7%BD%AE%E5%B0%86%E4%B8%80%E4%BA%9B%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%94%BE%E7%BD%AE%E5%88%B0compound%E4%B8%AD%EF%BC%8C%E7%BB%84%E6%88%90%E4%B8%80%E4%B8%AA%E5%B0%8F%E7%BB%84"><span class="toc-number">33.10.</span> <span class="toc-text">10. 在Service中微服务比较多的时候，可以配置将一些微服务放置到compound中，组成一个小组</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-mysql%E7%9A%84dateTime%E5%92%8Ctimestamp%E7%9A%84%E5%8C%BA%E5%88%AB%EF%BC%9F"><span class="toc-number">33.11.</span> <span class="toc-text">11. mysql的dateTime和timestamp的区别？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12-SpringBoot%E4%B8%AD%E7%9A%84%E4%BA%8B%E5%8A%A1"><span class="toc-number">33.12.</span> <span class="toc-text">12. SpringBoot中的事务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13-IDEA-RESTFUll-clinet"><span class="toc-number">33.13.</span> <span class="toc-text">13. IDEA RESTFUll clinet</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-1"><span class="toc-number">33.14.</span> <span class="toc-text"></span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#FAQ"><span class="toc-number">34.</span> <span class="toc-text">FAQ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-TypeError-vm-previewHandle-is-not-a-function"><span class="toc-number">34.1.</span> <span class="toc-text">1. TypeError: _vm.previewHandle is not a function</span></a></li></ol></li></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/post/%E9%9D%A2%E8%AF%95/%E7%AE%97%E6%B3%95/Interview%2075.html" title="leetcode75"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cwrisingimage.oss-cn-beijing.aliyuncs.com/img/122641xazMi.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="leetcode75"></a><div class="content"><a class="title" href="/post/%E9%9D%A2%E8%AF%95/%E7%AE%97%E6%B3%95/Interview%2075.html" title="leetcode75">leetcode75</a><time datetime="2023-12-31T09:16:26.000Z" title="发表于 2023-12-31 17:16:26">2023-12-31</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/%E5%A4%A7%E5%AD%A6%E8%AF%BE%E7%A8%8B%E6%9C%9F%E6%9C%AB%E6%80%BB%E7%BB%93/%E5%A4%A7%E4%B8%89%E4%B8%8A-%E5%90%8E%E6%9C%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E8%AF%BE%E8%AE%BE.html" title="无题"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="无题"></a><div class="content"><a class="title" href="/post/%E5%A4%A7%E5%AD%A6%E8%AF%BE%E7%A8%8B%E6%9C%9F%E6%9C%AB%E6%80%BB%E7%BB%93/%E5%A4%A7%E4%B8%89%E4%B8%8A-%E5%90%8E%E6%9C%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E8%AF%BE%E8%AE%BE.html" title="无题">无题</a><time datetime="2023-12-25T09:24:17.991Z" title="发表于 2023-12-25 17:24:17">2023-12-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/%E9%9D%A2%E8%AF%95/%E7%AE%80%E5%8E%86%E4%B8%AD%E5%86%99%E7%9A%84%E4%B8%9C%E8%A5%BF.html" title="简历项目知识"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cwrisingimage.oss-cn-beijing.aliyuncs.com/img/105345QKMmx.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="简历项目知识"></a><div class="content"><a class="title" href="/post/%E9%9D%A2%E8%AF%95/%E7%AE%80%E5%8E%86%E4%B8%AD%E5%86%99%E7%9A%84%E4%B8%9C%E8%A5%BF.html" title="简历项目知识">简历项目知识</a><time datetime="2023-12-13T00:04:50.000Z" title="发表于 2023-12-13 08:04:50">2023-12-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/%E9%9D%A2%E8%AF%95/%E9%B1%BC%E7%9A%AE.html" title="鱼皮"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s2.loli.net/2023/11/22/Y65fK7QPnFLEzjs.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="鱼皮"></a><div class="content"><a class="title" href="/post/%E9%9D%A2%E8%AF%95/%E9%B1%BC%E7%9A%AE.html" title="鱼皮">鱼皮</a><time datetime="2023-12-12T00:04:50.000Z" title="发表于 2023-12-12 08:04:50">2023-12-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/%E5%A4%A7%E5%AD%A6%E8%AF%BE%E7%A8%8B%E6%9C%9F%E6%9C%AB%E6%80%BB%E7%BB%93/%E5%A4%A7%E4%B8%89%E4%B8%8A-%E5%90%8E%E6%9C%9F/%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80-%E5%AE%9E%E9%AA%8C.html" title="汇编语言-实验"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cwrisingimage.oss-cn-beijing.aliyuncs.com/img/110713myQte.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="汇编语言-实验"></a><div class="content"><a class="title" href="/post/%E5%A4%A7%E5%AD%A6%E8%AF%BE%E7%A8%8B%E6%9C%9F%E6%9C%AB%E6%80%BB%E7%BB%93/%E5%A4%A7%E4%B8%89%E4%B8%8A-%E5%90%8E%E6%9C%9F/%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80-%E5%AE%9E%E9%AA%8C.html" title="汇编语言-实验">汇编语言-实验</a><time datetime="2023-12-08T08:50:53.000Z" title="发表于 2023-12-08 16:50:53">2023-12-08</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">©2023 By fcw</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a><br>
<imgsrc="https: haiyong.site="" img="" icp.png"="">
<a href="https://beian.miit.gov.cn/#/Integrated/index" style="color:white" target="_blank">豫ICP备2023032527号</a></imgsrc="https:></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"></div></div><hr><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: '',
      appKey: '',
      avatar: 'monsterid',
      serverURLs: '',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !false) {
  if (false) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script><script>function loadDisqus () {
  var disqus_config = function () {
    this.page.url = 'https://risingrode.github.io/post/%E9%A1%B9%E7%9B%AE/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E2%80%94%E5%88%86%E5%B8%83%E5%BC%8F%E5%9F%BA%E7%A1%80.html'
    this.page.identifier = '/post/%E9%A1%B9%E7%9B%AE/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E2%80%94%E5%88%86%E5%B8%83%E5%BC%8F%E5%9F%BA%E7%A1%80.html'
    this.page.title = '谷粒商城-基础篇'
  };

  window.disqusReset = () => {
    DISQUS.reset({
      reload: true,
      config: disqus_config
    })
  }

  if (window.DISQUS) disqusReset()
  else {
    (function() { 
      var d = document, s = d.createElement('script');
      s.src = 'https://.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  }

  document.getElementById('darkmode').addEventListener('click', () => {
    setTimeout(() => window.disqusReset(), 200)
  })
}

if ('Valine' === 'Disqus' || !false) {
  if (false) btf.loadComment(document.getElementById('disqus_thread'), loadDisqus)
  else loadDisqus()
} else {
  function loadOtherComment () {
    loadDisqus()
  }
}
</script></div><link rel="stylesheet" href="/dist/APlayer.min.css"> <div id="aplayer"></div> <script type="text/javascript" src="/dist/APlayer.min.js"></script> <script type="text/javascript" src="/js/aplayer/music.js"></script><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/fireworks.min.js"></script><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zindex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-nest.min.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/metingjs/dist/Meting.min.js"></script><script async="" data-pjax="" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>